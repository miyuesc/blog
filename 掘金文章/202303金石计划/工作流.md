# å…³äºå·¥ä½œæµå¼€å‘å‰ç«¯é€‰å‹çš„ä¸€ç‚¹ä¸ªäººè§è§£ï¼ˆbpmn.jsä¸LogicFlowï¼‰

## å‰è¨€

é¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œæœ¬æ–‡çš„å‡ºå‘ç‚¹ **çº¯ç²¹æ˜¯é’ˆå¯¹å·¥ä½œæµå¼€å‘** çš„åœºæ™¯çš„é€‰å‹å¯¹æ¯”ï¼Œå…¶ä»–ä¸šåŠ¡åœºæ™¯ä¸‹å»ºè®®é‡æ–°è°ƒç ”ã€‚

### ä»€ä¹ˆæ˜¯å·¥ä½œæµï¼Ÿ

å·¥ä½œæµï¼Œå³ Workflowï¼Œæ˜¯å¯¹å·¥ä½œæµç¨‹åŠå…¶å„æ“ä½œæ­¥éª¤ä¹‹é—´ä¸šåŠ¡è§„åˆ™çš„æŠ½è±¡ã€æ¦‚æ‹¬æè¿°ã€‚å·¥ä½œæµå»ºæ¨¡ï¼Œå³å°†å·¥ä½œæµç¨‹ä¸­çš„å·¥ä½œå¦‚ä½•å‰åç»„ç»‡åœ¨ä¸€èµ·çš„é€»è¾‘å’Œè§„åˆ™ï¼Œåœ¨è®¡ç®—æœºä¸­ä»¥æ°å½“çš„æ¨¡å‹è¡¨è¾¾å¹¶å¯¹å…¶å®æ–½è®¡ç®—ã€‚å·¥ä½œæµè¦è§£å†³çš„ä¸»è¦é—®é¢˜æ˜¯ï¼šä¸ºå®ç°æŸä¸ªä¸šåŠ¡ç›®æ ‡ï¼Œåˆ©ç”¨è®¡ç®—æœºåœ¨å¤šä¸ªå‚ä¸è€…ä¹‹é—´æŒ‰æŸç§é¢„å®šè§„åˆ™è‡ªåŠ¨ä¼ é€’æ–‡æ¡£ã€ä¿¡æ¯æˆ–è€…ä»»åŠ¡ã€‚

ä»¥ä¸Šæ˜¯ç»´åŸºç™¾ç§‘å¯¹ **å·¥ä½œæµæŠ€æœ¯** çš„å®šä¹‰ã€‚ä¹‹æ‰€ä»¥ç§°ä¸º **æŠ€æœ¯**ï¼Œæ˜¯å› ä¸ºå…¶ä¸­åŒ…å«äº† ä¸šåŠ¡è§„åˆ™æŠ½è±¡ä¸è§„åˆ™æ¨¡å‹çš„åˆ›å»ºï¼Œå¹¶å¯ä»¥å°†å…¶ç”¨æ¥å®ç°ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–æ“ä½œã€‚é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªå·¥ä½œæµçš„å®šä¹‰ï¼ŒåŒ…å«è‡³å°‘ä¸€ä¸ª **è§¦å‘ç‚¹** ä¸ä¸€ä¸ª **ç»ˆæ­¢ç‚¹**ï¼Œå½“è¢«è§¦å‘åä¼šç”±è§¦å‘ç‚¹æ²¿ç€å®šä¹‰çš„è·¯å¾„å’Œæ¡ä»¶è‡ªåŠ¨æµè½¬ç›´åˆ°è¿›å…¥ç»ˆæ­¢ç‚¹ã€‚

æ‰€ä»¥å·¥ä½œæµå¸¸å¸¸ä¼šä¸ **è§„åˆ™å¼•æ“** ç»“åˆä½¿ç”¨ã€‚

è€Œä¸ºäº†ä½¿å¾—ä¸šåŠ¡äººå‘˜ä¹Ÿèƒ½å¿«é€Ÿç†è§£å’Œåˆ›å»ºä¸€å¥—ç¬¦åˆä¸šåŠ¡è§„èŒƒçš„å·¥ä½œæµï¼Œæœ€åç”± OMG å‘å¸ƒäº† **BPMN**ï¼ˆå…¨ç§° Business Process Model and Notationï¼Œä¸šåŠ¡æµç¨‹æ¨¡å‹å’Œæ ‡è®°æ³•ï¼‰è§„èŒƒï¼Œç”¨æ¥æ ‡å‡†åŒ–å’Œçº¦æŸå¯¹å·¥ä½œæµçš„å®šä¹‰ï¼Œå¹¶å®ç°ä¸šåŠ¡äººå‘˜ä¸å®é™…ç¨‹åºçš„è§£è€¦ï¼Œä¸¤è€…ç”± XML è¿›è¡Œä¿¡æ¯äº¤äº’ã€‚

æ—¢ç„¶æœ‰äº†å·¥ä½œæµï¼Œé‚£ä¹ˆå°±éœ€è¦åç«¯çš„å¯¹åº”çš„ **å·¥ä½œæµå¼•æ“** äº†ã€‚

### ä»€ä¹ˆæ˜¯å·¥ä½œæµå¼•æ“ï¼Ÿ

æ—¢ç„¶å®šä¹‰äº†ä¸€å¥—å·¥ä½œæµï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹åº”çš„åå°æœåŠ¡æ¥è§£æå’Œè¿è¡Œè¿™ä¸€å¥—å·¥ä½œæµå®šä¹‰ã€‚æ‰€ä»¥å·¥ä½œæµå¼•æ“å…¶å®å°±æ˜¯ **ä¸€å¥—ç”¨æ¥è§£æå·¥ä½œæµå®šä¹‰å¹¶æ ¹æ®æ ¹æ®å®šä¹‰é©±åŠ¨å·¥ä½œæµæ­£å¸¸æ‰§è¡Œå’Œæµè½¬çš„ç³»ç»Ÿ**ã€‚

å°±ç›®å‰æ¥è¯´ï¼Œå¸¸ç”¨çš„ä¸€èˆ¬æœ‰ `Camundaã€Activitiã€Flowableã€Jbpm`ï¼Œä¹Ÿæœ‰ä¸€äº›å›½å†…è‡ªç ”çš„å·¥ä½œæµå¹³å°ã€‚ä¸è¿‡ç›®å‰ä»ç„¶ä»¥æœ€å‰é¢çš„ä¸‰ä¸ªä½¿ç”¨æ›´ä¸ºå¹¿æ³›ã€‚

ä»¥è¿™ä¸‰ä¸ªå¹³å°ä¸ºä¾‹ï¼Œå®ƒä»¬åœ¨æ¥æ”¶ä¼ å…¥å·¥ä½œæµå®šä¹‰æ—¶ï¼Œéƒ½æ˜¯æ¥æ”¶ **ç¬¦åˆ BPMN2 è§„èŒƒçš„ XML å­—ç¬¦ä¸²**ï¼Œå½“ç„¶å¥½åƒä¹Ÿå¯ä»¥æ¥æ”¶ json å¯¹è±¡ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯éƒ½æ”¯æŒ jsonã€‚

> é‚£ä¹ˆåœ¨äº†è§£äº†å·¥ä½œæµçš„ç›¸å…³å†…å®¹ä¹‹åï¼Œå†è¿›å…¥æ­£é¢˜ã€‚

## bpmn.js

é¦–å…ˆï¼Œbpmn.js ç›®å‰ **æ²¡æœ‰** å®˜æ–¹çš„ä¸­è‹±æ–‡æ–‡æ¡£ï¼ŒTypeScript æ”¯æŒä¹Ÿä¾ç„¶ä¸è‰¯å¥½ï¼Œè®¨è®ºåŒºå½“å‰åªæœ‰å®˜æ–¹æä¾›çš„ä¸€ä¸ªå…¨è‹±æ–‡ç¤¾åŒºï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªæ‰å…¥å‰ç«¯ä¸ä¹…åˆéœ€è¦æè¿™ä¸ªçš„è¯ï¼Œå»ºè®®ä½ èµ¶ï¼ï¼ç´§ï¼ï¼ï¼è·‘ï¼ï¼ï¼ï¼ï¼

å¼€ä¸ªç©ç¬‘ï¼Œè¿™é‡Œå…ˆä»‹ç»ä¸€ä¸‹ bpmn.js çš„åŸºæœ¬æƒ…å†µ~

åœ¨ Camunda å¹³å°å‘å±•ä¸€æ®µæ—¶é—´ä¹‹åï¼Œç”± `camunda` å›¢é˜Ÿå†…éƒ¨ä»¥ nikko ä¸ºé¦–ç»„ç»‡äº†ä¸€ä¸ªå°å›¢é˜Ÿ `bpmn.io` ï¼Œå¼€å‘äº† `bpmn.js`ã€‚

åœ¨è¿›å…¥ bpmn.js ä»“åº“å°±å¯ä»¥çœ‹åˆ°ï¼š**bpmn-js - BPMN 2.0 for the web**ï¼Œä¹Ÿä¾§é¢ååº”äº†è¿™ä¸ªåº“å°±æ˜¯ **çº¯ç²¹çš„ä¸ºäº†åœ¨ web é¡µé¢ä¸Šå¤„ç† BPMN 2.0 è§„èŒƒå·¥ä½œæµçš„**ã€‚å®ƒçš„ä»‹ç»ä¹Ÿæ˜¯ï¼šView and edit BPMN 2.0 diagrams in the browserï¼Œå³åœ¨æµè§ˆå™¨æŸ¥çœ‹å’Œç¼–è¾‘ BPMN2.0 å›¾ã€‚

**bpmn.js åŸºäº SVG å®ç°ç½‘é¡µå·¥ä½œæµçš„å¯è§†åŒ–ç¼–è¾‘ï¼Œé€šè¿‡å†…éƒ¨é€»è¾‘å®ç° SVG ä¸ XML ä¹‹é—´çš„ç›¸äº’è½¬æ¢**ï¼Œæ‰€ä»¥è¦ä½¿ç”¨è¿™ä¸ªåº“èµ·ç ä½ çš„æµè§ˆå™¨éœ€è¦æ”¯æŒ SVGï¼ˆæ­»å»çš„ IE çªç„¶æ”»å‡»æˆ‘~ï¼‰

å†…éƒ¨ï¼Œbpmn.js ä¾èµ– `bpmn-moddle` ä¸ `moddle` ä¸¤ä¸ªåº“å®ç° JS å¯¹è±¡ä¸ `xml` çš„è½¬æ¢ï¼Œå†ç”± `bpmn-moddle` ä¸ `diagram.js` å®ç° JS å¯¹è±¡å’Œ SVG ä¹‹é—´ç»‘å®šä¸åˆ‡æ¢ã€‚

> `diagram.js` æä¾›äº†æœ€åŸºç¡€çš„ç»˜å›¾èƒ½åŠ›ä¸ js æ“æ§ï¼Œå¹¶æä¾›äº†åŸºç¡€çš„å·¥å…·èƒ½åŠ›æ¨¡å—ã€‚

å½“ç„¶ï¼Œç”±äº bpmn.js çš„å›¢é˜Ÿæœ¬èº«å°±å±äº camundaï¼Œæ‰€ä»¥åœ¨å¯¹ camunda çš„æ”¯æŒä¸Šæ˜¯ååˆ†ä¼˜ç§€çš„ã€‚

## LogicFlow

> ç”±äºç¬”è€…æ²¡æœ‰æ·±åº¦ä½¿ç”¨è¿‡ LogicFlowï¼Œæ‰€ä»¥å¦‚æœæœ‰ç‰‡é¢ä¹‹å¤„å¸Œæœ›å¤§å®¶èƒ½åŠæ—¶æŒ‡å‡ºã€‚

å¯¹äº LogicFlowï¼ˆåé¢ç®€ç§° LFï¼‰ï¼Œæ˜¯ç”± æ»´æ»´ çš„å›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾å›¾å½¢ç¼–è¾‘å·¥å…·ï¼Œå®˜æ–¹è‡ªå·±çš„å®šä¹‰æ˜¯ï¼š**ä¸€æ¬¾æµç¨‹å›¾ç¼–è¾‘æ¡†æ¶ï¼Œæä¾›äº†ä¸€ç³»åˆ—æµç¨‹å›¾äº¤äº’ã€ç¼–è¾‘æ‰€å¿…éœ€çš„åŠŸèƒ½å’Œç®€å•çµæ´»çš„èŠ‚ç‚¹è‡ªå®šä¹‰ã€æ’ä»¶ç­‰æ‹“å±•æœºåˆ¶ã€‚**

ä¸ bpmn.js ä¸€æ ·çš„æ˜¯ï¼ŒLF ä¸€æ ·ä¹Ÿé€‰æ‹©äº†ä½¿ç”¨ SVG æ¥è¿›è¡Œé¡µé¢äº¤äº’çš„ã€‚ä½†æ˜¯ä¸ bpmn.js ä¸åŒçš„æ˜¯ï¼ŒLF åˆ™æ˜¯ **ä¸“æ³¨äºæä¾›å¯ä»¥å¿«æ·æ‰©å±•çš„å›¾å½¢ç»˜åˆ¶èƒ½åŠ›**ï¼Œç”¨æ¥å–ä»£ bpmn.jsã€jsplumb æ‰©å±•èƒ½åŠ›ä¸è¶³ã€è‡ªå®šä¹‰æˆæœ¬é«˜çš„é—®é¢˜ã€‚

> å½“ç„¶æˆ‘ä¸ªäººè§‰å¾—è¿™é‡Œè¯´ bpmn.js æ‰©å±•èƒ½åŠ›ä¸è¶³ä¹Ÿåªæ˜¯å› ä¸ºå¯¹å…¶æ ¸å¿ƒå®ç°ä¸å¤Ÿäº†è§£ğŸ˜

è¿™é‡Œæˆªå–ä¸€æ®µæ»´æ»´å›¢é˜Ÿåœ¨æ˜é‡‘å‘å¸ƒçš„æ–‡ç«  [æ»´æ»´å¼€æº LogicFlowï¼šä¸“æ³¨æµç¨‹å¯è§†åŒ–çš„å‰ç«¯æ¡†æ¶](https://juejin.cn/post/6933413834682007560) ä¸­å…³äº LF å®šä½çš„è¯´æ˜ï¼š

> ![dingwei1](./docs-images/%E5%B7%A5%E4%BD%9C%E6%B5%81/a908f5a2c1104ff0be7ea5674744bfc7tplv-k3u1fbpfcp-zoom-in-crop-mark4536000.webp)
>
> - activiti ä½œä¸ºå·¥ä½œæµå¼•æ“æä¾›äº†å‰åç«¯çš„è§£å†³æ–¹æ¡ˆï¼Œç®€å•äºŒæ¬¡å¼€å‘å°±å¯ä»¥éƒ¨ç½²ä¸€å¥—ä¸šåŠ¡æµç¨‹çš„ç®¡ç†å¹³å°
> - Bpmn.jsï¼šåŸºäº BPMN2.0 è§„èŒƒï¼Œè®¾è®¡çš„æµç¨‹å›¾ç¼–è¾‘å™¨
> - G6ï¼šantv æ——ä¸‹ä¸“æ³¨å›¾å½¢å¯è§†åŒ–ï¼Œå„ç±»åˆ†æç±»å›¾è¡¨ã€‚æ¯”å¦‚ç”Ÿæ€æ ‘ã€è„‘å›¾ã€è¾å°„å›¾ã€ç¼©è¿›å›¾ç­‰ç­‰
> - X6ï¼šå›¾ç¼–è¾‘å¼•æ“ï¼Œæ ¸å¿ƒèƒ½åŠ›æ˜¯èŠ‚ç‚¹ã€è¿çº¿å’Œç”»å¸ƒã€‚ä¸ä»…æ”¯æŒäº†æµç¨‹å›¾ï¼Œè¿˜æœ‰ Dag å›¾ã€ER å›¾
>
> LogicFlow çš„å®šä½åœ¨ä¸Šå›¾çš„ Bpmn.js å’Œ X6 ä¹‹é—´ï¼Œå¡«è¡¥ä¸­é—´çš„ç©ºç™½ã€‚æ ¸å¿ƒæä¾›äº†æµç¨‹å›¾çš„ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”é€šè¿‡æ‹“å±•èƒ½åŠ›æ¥æ”¯æŒ BPMN ç­‰è§„èŒƒæ‰€éœ€çš„æµç¨‹èŠ‚ç‚¹å’Œæ•°æ®æ ¼å¼ï¼Œä»¥æ»¡è¶³å½“å‰ä¸šåŠ¡ä¸‹çš„ç°çŠ¶ã€‚

å¯ä»¥çœ‹åˆ° LF åœ¨ä¸­é—´è¿›è¡Œäº†ä¸€äº›å¹³è¡¡ï¼Œåœ¨ **ä¿ç•™å¯ä»¥é«˜åº¦æ‰©å±•ç»˜å›¾èƒ½åŠ›ç­‰æƒ…å†µä¸‹ï¼Œé€šè¿‡æ‰©å±•æ¥å®ç°ä¸ BPMN çš„é€‚é…**ã€‚

æœ¬èº«æŒ‰ç…§ LF çš„è¿™ç§è®¾è®¡å’Œè®¡åˆ’æ¥è¯´ï¼Œæ˜¯èƒ½å¤Ÿç»™å¼€å‘è€…å¸¦æ¥å¾ˆå¤§ä¾¿åˆ©çš„ï¼Œä½†æ˜¯ç›®å‰ LF **åœ¨å·¥ä½œæµä¸šåŠ¡åœºæ™¯ä¸‹ä»ç„¶ç¼ºä¹å¾ˆå¤§çš„å®Œæˆåº¦**ã€‚

## å·¥ä½œæµä¸šåŠ¡ä¸‹çš„é€‰å‹

ä¸Šé¢æåˆ°äº†ï¼ŒLF è¿™ä¸ªåº“çš„ç»“æ„è®¾è®¡æ˜¯å¯ä»¥ç»™å¼€å‘è€…å¸¦æ¥éå†çš„ï¼Œåªæ˜¯ç›®å‰åœ¨å·¥ä½œæµä¸šåŠ¡ä¸­ä¾ç„¶å­˜åœ¨å¾ˆå¤§ä¸è¶³ï¼›å¦å¤– bpmn.js çš„æ‰©å±•æ€§ä¹Ÿæ˜¯ååˆ†å¼ºå¤§çš„ï¼Œä¼šè®©äººè§‰å¾—éš¾ç”¨çš„æœ€å¤§åŸå› å°±æ˜¯ç¼ºä¹ç›¸å…³æ–‡æ¡£â€”â€”ç”šè‡³æ˜¯è‹±æ–‡æ–‡æ¡£ï¼ˆè‡³äºå…¨é‡å¼•å…¥é‚£ä¸ªæ˜¯æœ‰è¯¯è§£çš„ï¼Œå·²ç»æ›´æ¢ä¸º esm çš„æ¨¡å¼äº†ï¼‰ã€‚

> è¨€å¤–ä¹‹æ„å°±æ˜¯ï¼ŒæŒ‡å®šå·¥ä½œæµåœºæ™¯ä¸‹ä¾ç„¶å»ºè®®ä½¿ç”¨ bpmn.jsï¼›å½“ç„¶å¦‚æœéœ€æ±‚ç‰¹åˆ«ç®€å•ï¼Œä¹Ÿå¯ä»¥å°è¯• LFã€‚

è¿™é‡Œæ¯”è¾ƒä¸€ä¸‹ä»–ä»¬çš„ä¸€äº›å¸¸ç”¨åŠŸèƒ½ï¼Œå…³äº bpmn.js çš„åŸºç¡€åŸç†å¯ä»¥æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç«  [Bpmn.js è¿›é˜¶æŒ‡å—ä¹‹åŸç†åˆ†æä¸æ¨¡å—æ”¹é€ ](https://juejin.cn/post/7117481147277246500)

## å¸¸è§æ‰©å±•éœ€æ±‚/åŠŸèƒ½

### 1. Render

#### LogicFlow

è™½ç„¶ BPMN 2.0 è§„èŒƒä¸­å¯¹æ¯ä¸€ç§èŠ‚ç‚¹å›¾æ ‡éƒ½è¿›è¡Œäº†è¯¦ç»†çš„æ ‡æ³¨å’Œè¯´æ˜ï¼Œä½†æ˜¯é‚£ä¸ªé»‘ç™½åˆ†æ˜çš„çªç„¶è‚¯å®šä¸ç¬¦åˆç°åœ¨è€æ¿ä»¬çš„å®¡ç¾ï¼Œæ‰€ä»¥æœ€å¸¸è§çš„ä¸šåŠ¡éœ€æ±‚ä¹‹ä¸€å°±æ˜¯å¯¹æ˜¾ç¤ºæ•ˆæœè¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œçš„æ˜¾ç¤ºæ•ˆæœè‡ªç„¶æŒ‡çš„å°±æ˜¯ render éƒ¨åˆ†ã€‚

åœ¨ LF ä¸­ï¼Œå®ƒé»˜è®¤æä¾›äº†ä»¥ä¸‹ 7 ç§åŸºç¡€èŠ‚ç‚¹ï¼š

- `RectNode`ï¼šçŸ©å½¢
- `CircleNode`ï¼šåœ†å½¢
- `EllipseNode`ï¼šæ¤­åœ†
- `PolygonNode`ï¼šå¤šè¾¹å½¢
- `DiamondNode`ï¼šè±å½¢
- `TextNode`ï¼šæ–‡æœ¬
- `HtmlNode`ï¼šHTML

æ¯ç§åŸºç¡€èŠ‚ç‚¹éƒ½æœ‰å¯¹åº”çš„ `Model` ç±»å‹ï¼Œåˆ†åˆ«ç®¡ç† `View` æ˜¾ç¤ºæ§åˆ¶ä¸ `Model` å±æ€§æ§åˆ¶ï¼Œå¼€å‘è€…åˆ†åˆ«å¯ä»¥ç»§æ‰¿åŒä¸€ç§èŠ‚ç‚¹çš„ `View` å’Œ `Model` ç±»æ¥å®ç°è‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œä¾‹å¦‚ï¼š

```js
import { RectNode, RectNodeModel } from "@logicflow/core";
class UserTaskView extends RectNode {
  getShape() {
    const { model, graphModel } = this.props;
    const { x, y, width, height, radius } = model;
    const style = model.getNodeStyle();
    return h("g", {}, [
      h("rect", {
        ...style,
        x: x - width / 2,
        y: y - height / 2,
        rx: radius,
        ry: radius,
        width,
        height
      }),
      ''
    ]);
  }
}
class UserTaskModel extends RectNodeModel {
  getNodeStyle() {
    const style = super.getNodeStyle();
    style.stroke = "blue";
    style.strokeDasharray = "3 3";
    return style;
  }
}
export default {
  type: "UserTask",
  view: UserTaskView,
  model: UserTaskModel,
};
```

#### bpmn.js

è€Œåœ¨ bpmn.js ä¸­ï¼Œåˆ™æ˜¯æŒ‰ç…§åŸºç¡€æµç¨‹èŠ‚ç‚¹ç±»å‹æ¥ç»˜åˆ¶å…ƒç´ çš„ï¼Œä½†æ˜¯ä¸ LF ä¸åŒçš„æ˜¯ï¼Œå®ƒæ²¡æœ‰èŠ‚ç‚¹ç»§æ‰¿å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**ä¸€ä¸ªç±»å‹çš„èŠ‚ç‚¹æœ‰ä¸”åªæœ‰ä¸€ä¸ªå¯¹åº”çš„æ¸²æŸ“æ–¹æ³•**ï¼Œåªæ˜¯ **å¦‚æœè¿™ä¸ªèŠ‚ç‚¹å±äºæŸä¸€ç§åŸºç¡€èŠ‚ç‚¹çš„è¯ï¼Œä¼šåœ¨å®ƒçš„æ¸²æŸ“æ–¹æ³•å†…éƒ¨å»è°ƒç”¨å¯¹åº”åŸºç¡€èŠ‚ç‚¹çš„ç»˜åˆ¶æ–¹æ³•**ã€‚

é»˜è®¤çš„ Render æ–¹æ³•åœ¨ `bpmn-js/lib/draw/BpmnRednerer.js` ä¸­ï¼Œå¯ä»¥é€šè¿‡ `this.handlers` æ‰¾åˆ°ã€‚

å…¶ä¸­ `handlers` å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†æ¯ä¸ª **é¡µé¢å¯è§çš„ BPMN èŠ‚ç‚¹å¯¹åº”çš„ æ–¹æ³•**ã€‚

> å½“ç„¶ï¼Œä¸€äº›å…¬å…±çš„ SVG ç»˜åˆ¶æ–¹æ³•è¿˜æ˜¯æŠ½ç¦»å‡ºæ¥äº†ã€‚

ä¾‹å¦‚æˆ‘ä»¬ä»¥ `StartEvent` å¼€å§‹èŠ‚ç‚¹ä¸ºä¾‹ï¼Œå®ƒä¾èµ–ä¸ `Event` èŠ‚ç‚¹ï¼Œæ‰€ä»¥ï¼š

```js
this.handlers = {
    'bpmn:Event': function(parentGfx, element, attrs) {
      if (!('fillOpacity' in attrs)) {
        attrs.fillOpacity = DEFAULT_FILL_OPACITY;
      }
      return drawCircle(parentGfx, element.width, element.height, attrs);
    },
    'bpmn:StartEvent': function(parentGfx, element) {
      var attrs = {
        fill: getFillColor(element, defaultFillColor),
        stroke: getStrokeColor(element, defaultStrokeColor)
      };
      var semantic = getSemantic(element);
      if (!semantic.isInterrupting) {
        attrs = {
          strokeDasharray: '6',
          strokeLinecap: 'round',
          fill: getFillColor(element, defaultFillColor),
          stroke: getStrokeColor(element, defaultStrokeColor)
        };
      }
      var circle = renderer('bpmn:Event')(parentGfx, element, attrs);
      renderEventContent(element, parentGfx);
      return circle;
    }
  	// ...
  }
```

å¯è§ï¼Œ`handler` æ–¹æ³•å°±æ˜¯å¯¹æ¯ç§èŠ‚ç‚¹è¿›è¡Œæ¸²æŸ“å¹¶è¿”å›åˆ›å»ºçš„ SVG èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è‡ªå®šä¹‰çš„æ—¶å€™åªéœ€è¦ä¿®æ”¹ `handlers` å¯¹è±¡å³å¯ï¼Œä¾‹å¦‚æ–°å¢ä¸€ä¸ª `SqlTask` èŠ‚ç‚¹ï¼š

```js
this.handlers['miyue:SqlTask'] = function (parentGfx, element, attr) {
  // æ¸²æŸ“å¤–å±‚è¾¹æ¡†
  const attrs = {
    fill: getFillColor(element, defaultFillColor),
    fillOpacity: defaultTaskOpacity,
    stroke: getStrokeColor(element, defaultTaskColor)
  };
  renderer("bpmn:Activity")(parentGfx, element, attrs);
  // è‡ªå®šä¹‰èŠ‚ç‚¹
  const customIcon = svgCreate("image");
  svgAttr(customIcon, {
    ...(attr || {}),
    width: element.width,
    height: element.height,
    href: mysqlIcon
  });
  svgAppend(parentGfx, customIcon);
  return customIcon;
}
```

å› ä¸º `SqlTask` èŠ‚ç‚¹æ˜¯éœ€è¦ç»§æ‰¿ `Task` ç±»å‹èŠ‚ç‚¹çš„ï¼Œè€Œ `Task` æœ€ç»ˆåˆç»§æ‰¿ `Activity` èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è°ƒç”¨ `Activity` å³å¯ã€‚ç„¶ååœ¨ `parentGfx` ä¸­æ’å…¥æˆ‘ä»¬çš„è‡ªå®šä¹‰å†…å®¹ï¼ˆ`parentGfx` å³æ˜¯è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„ SVG èŠ‚ç‚¹ï¼‰ã€‚



