# ä¸ºäº†æ›´å¥½åœ°å®Œæˆæ˜é‡‘ä¸‹åˆèŒ¶ï¼Œæˆ‘ç‰¹åœ°æ•´äº†ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶

è‡ªä» 2022 å¹´å¹´åº•åŠ å…¥äº†èˆ¹é•¿ç»„ç»‡çš„æ˜é‡‘ä¸‹åˆèŒ¶å°åˆ†é˜Ÿä¹‹åï¼Œæ¯å¤©æˆ‘ä»¬å‡ ä¸ªå°ä¼™ä¼´éƒ½ä¼šåˆ†åˆ«æŸ¥æ‰¾å‰åç«¯åŠç§»åŠ¨ç«¯ä¸‰ä¸ªåˆ†ç±»ä¸‹çš„ä¼˜ç§€æ–‡ç« æ¥åˆ†äº«ç»™å„ä½æ˜å‹ã€‚

å½“åˆä¸ºäº†åˆ†æå„ä¸ªå¤§åˆ†ç±»ä¸‹ä¸åŒæ–‡ç« åœ¨æ˜å‹ä¹‹é—´çš„å—æ¬¢è¿ç¨‹åº¦ç­‰ä¸åŒçš„ç»´åº¦ä¿¡æ¯ï¼Œéœ€è¦å°†é€‰ä¸­çš„æ–‡ç« è¿›è¡Œä¸€æ¬¡çŸ­é“¾æ¥è½¬æ¢ï¼Œç„¶åé‡æ–°æ•´ç†æˆä¸‹åˆèŒ¶æ¶ˆæ¯ï¼Œå¹¶è®°å½•åˆ°é£ä¹¦æ–‡æ¡£ä¸­ã€‚

![image-20240507095420579](./docs-images/%E4%B8%BA%E4%BA%86%E6%9B%B4%E5%BF%AB%E6%8D%B7%E7%9A%84%E7%94%9F%E6%88%90%E6%8E%98%E9%87%91%E4%B8%8B%E5%8D%88%E8%8C%B6%EF%BC%8C%E6%88%91%E7%89%B9%E5%9C%B0%E6%95%B4%E4%BA%86%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/image-20240507095420579.png)

å½“æ—¶çŸ­é“¾ç”Ÿæˆå·¥å…·è¿˜æ”¯æŒ â€œæ‰¹é‡ç”Ÿæˆâ€ï¼Œåªéœ€è¦æ‰¾å¥½æ–‡ç« å°†åœ°å€å’Œæ–‡ç« æ ‡é¢˜è®°å½•ä¸‹æ¥ç»Ÿä¸€å¤åˆ¶åˆ°ç”Ÿæˆå·¥å…·ä¸­æ‰¹é‡ç”Ÿæˆå³å¯ï¼Œæ‰€ä»¥æ“ä½œå¤æ‚ç¨‹åº¦å¹¶ä¸é«˜ï¼Œé‚£ä¹ˆå°±ä¸€ç›´æ˜¯æ‰‹åŠ¨å®Œæˆçš„ã€‚

ä½†æ˜¯åæ¥è§‰å¾—ä¸€ç¯‡ä¸€ç¯‡çš„å¤åˆ¶ï¼Œå§‹ç»ˆä¹Ÿä¸æ˜¯ä¸ªåŠæ³•ï¼Œè¿˜æ˜¯å¾—å¤åˆ¶åæ¬¡å·¦å³ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½ç›´æ¥ä¸€æ¬¡æŠŠæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ç« çš„ä¿¡æ¯å…¨éƒ¨æå–å‡ºæ¥ä¸€æ¬¡æ€§ç›´æ¥å¤åˆ¶å®Œæˆå‘¢ï¼Ÿ

å°ç±³å¿ƒæƒ³ â€”â€” è¿™åº”è¯¥æ˜¯å¯ä»¥çš„å§ï¼Ÿ

## ç¬¬ä¸€ç‰ˆå°æ’ä»¶ - æ˜é‡‘æ–‡ç« æ ‡ç­¾é¡µæŸ¥è¯¢

åŸºäºè¿™ä¸ªæƒ³æ³•ï¼Œå°±æœ‰äº†æœ€åˆçš„ä¸€ä¸ªå°æ’ä»¶ â€”â€” æŸ¥è¯¢æ‰€æœ‰æ˜é‡‘æ–‡ç« æ ‡ç­¾é¡µï¼Œæå–æ ‡ç­¾é¡µ `title` å’Œ `url`ï¼Œæ¥ç»„åˆæˆä¸€ä¸ªå®Œæ•´ä¿¡æ¯ã€‚

ç”±äºåªéœ€è¦æ ‡ç­¾é¡µçš„ä¸¤ä¸ªå±æ€§ï¼Œå¹¶æ²¡æœ‰å…¶ä»–æ“ä½œï¼Œæ‰€ä»¥è¿™ä¸€ç‰ˆåªæœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š`manifest.json, popup.html, popup.js`ã€‚

å…¶ä¸­ `manifest.json` ä¸º Chrome æ‰©å±•ç¨‹åºçš„å¿…è¦æ–‡ä»¶ï¼Œç”¨æ¥æè¿°è¯¥æ‰©å±•ç¨‹åºçš„åŠŸèƒ½å’Œé…ç½®ï¼›`popup.html` ä¸ `popup.js` åˆ™æ˜¯ä½œä¸ºæ‰©å±•ç¨‹åºå¼¹å‡ºå¼çª—å£ä¸­çš„æ˜¾ç¤ºå†…å®¹å’Œè„šæœ¬æ–‡ä»¶ã€‚

å› ä¸ºè¯¥ç‰ˆæœ¬çš„åŠŸèƒ½è¿‡äºå•ä¸€å’Œç®€å•ï¼Œæ‰€ä»¥ç›¸å…³çš„å†…å®¹ä¹Ÿç‰¹åˆ«å°‘ï¼š

```json
// manifest.json
{
  "manifest_version": 3,
  "name": "Juejin Daily Tea Creator",
  "version": "1.0",
  "description": "æ˜é‡‘ä¸‹åˆèŒ¶åŠ©æ‰‹",
  "icons": {
    "16": "icon.png",
    "48": "icon.png",
    "128": "icon.png"
  },
  "permissions": [ "tabs" ],
  "action": {
    "default_icon": {
      "16": "icon.png",
      "48": "icon.png",
      "128": "icon.png"
    },
    "default_title": "æŸ¥è¯¢æ ‡ç­¾é¡µä¿¡æ¯",
    "default_popup": "popup.html"
  }
}
```

å…¶ä¸­ `permissions` æƒé™é…ç½®éƒ¨åˆ†ï¼Œéœ€è¦åŠ å…¥ `tabs` æ ‡ç­¾é¡µçš„è¯»å–æƒé™ï¼Œ`action` åˆ™æ˜¯æµè§ˆå™¨å³ä¾§çš„æ‰©å±•ç¨‹åº icon å¯¹åº”çš„ç‚¹å‡»æ˜¾ç¤ºå¼¹å‡ºå¼çª—å£ã€ä»¥åŠè¯¥çª—å£çš„æ ‡é¢˜å’Œå†…å®¹æ¥æºã€‚

```html
<!-- popup.html -->
<!DOCTYPE html>
<html lang="zh">
  <head>
    <title>æŸ¥è¯¢æ ‡ç­¾é¡µä¿¡æ¯</title>
    <meta charset="utf-8">
    <style type="text/css">
      body {
        width: 280px;
        height: 400px;
      }
      ol {
        margin: 0;
        padding: 0 0 0 24px;
      }
      li {
        line-height: 24px;
      }
    </style>
  </head>
  <body>
    <p>
      <button id="btn">æŸ¥è¯¢æ ‡ç­¾é¡µä¿¡æ¯</button>
    </p>
    <div id="output">
      <ol id="urls"></ol>
      <hr />
      <ol id="titles"></ol>
    </div>
  </body>
  <script src="popup.js"></script>
</html>
```

```js
<!-- popup.js -->
// è®°å½•æ•°ç»„
let selectedTabs = [];

function formatTabs(tabs) {
  let innerUrls = ''
  let innerTitles = ''
  tabs.forEach(function(tab) {
    const url = tab.url.split('#')[0]
    const title = tab.title.replace(' - æ˜é‡‘', '')

    innerUrls += `<li>${url}</li>`
    innerTitles += `<li>${title}</li>`

    selectedTabs.push({ url, title });
  });

  return { innerUrls, innerTitles }
}
// å½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶æŸ¥è¯¢æ ‡ç­¾é¡µä¿¡æ¯
document.getElementById('btn').addEventListener('click', function() {
  chrome.tabs.query(
    {
      url: ['https://juejin.cn/post/*']
    },
    function(tabs) {
      // åœ¨è¾“å‡ºåŒºåŸŸæ˜¾ç¤ºæ ‡ç­¾é¡µä¿¡æ¯
      var outputUrls = document.getElementById('urls');
      outputUrls.innerHTML = '';
      var outputTitles = document.getElementById('titles');
      outputTitles.innerHTML = '';

      // å¤„ç†æ ‡ç­¾é¡µ
      if (tabs && tabs.length) {
        const { innerUrls, innerTitles } = formatTabs(tabs)
        outputUrls.innerHTML = innerUrls
        outputTitles.innerHTML = innerTitles
      } else {
        outputUrls.innerHTML = '<p style="text-align: center;">æš‚æ— åŒ¹é…æ•°æ®</p>';
        selectedTabs = []
      }
    }
  );
});
```

è¿™éƒ¨åˆ†çš„é€»è¾‘å…¶å®å¾ˆç®€å•ï¼šç‚¹å‡»æ‰©å±•ç¨‹åºæŒ‰é’®çš„æ—¶å€™ä¼šå¼¹å‡ºè¿™ä¸ª `popup.html`ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª â€œæŸ¥è¯¢æ ‡ç­¾é¡µä¿¡æ¯â€ çš„æŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®æ—¶ä¼šæŸ¥è¯¢æ‰€æœ‰æ ‡ç­¾é¡µï¼ŒåŒ¹é…ä»¥ `https://juejin.cn/post/` ä½œä¸ºå‰ç¼€çš„æ ‡ç­¾é¡µï¼Œå¹¶å°†åŒ¹é…ç»“æœç»„åˆæˆä¸¤ä¸ªåˆ—è¡¨ï¼ˆå› ä¸ºçŸ­é“¾ç”Ÿæˆå·¥å…·è¦æ±‚æ˜¯è¿™æ ·çš„ï¼Œéœ€è¦å°†åç§°å’Œåœ°å€åˆ†å¼€ï¼‰ï¼Œç„¶åæ’å…¥åˆ°å¼¹å‡ºé¡µçš„æŒ‡å®šåŒºåŸŸã€‚

è¿™æ ·ï¼Œæˆ‘å°±å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°ç”Ÿæˆå·¥å…·ä¸­æ‰¹é‡ç”ŸæˆçŸ­é“¾å•¦~

![image-20240507102956045](./docs-images/%E4%B8%BA%E4%BA%86%E6%9B%B4%E5%BF%AB%E6%8D%B7%E7%9A%84%E7%94%9F%E6%88%90%E6%8E%98%E9%87%91%E4%B8%8B%E5%8D%88%E8%8C%B6%EF%BC%8C%E6%88%91%E7%89%B9%E5%9C%B0%E6%95%B4%E4%BA%86%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/image-20240507102956045.png)

äºæ˜¯æˆ‘åˆå¯ä»¥æ„‰å¿«åœ°æèŒ¶äº†ã€‚ã€‚ã€‚

## ä½†æ˜¯ï¼Œå¥½æ™¯ä¸é•¿ã€‚ã€‚ã€‚

æ²¡è¿‡å¤šä¹…ï¼Œç”±äºçŸ­é“¾ç”Ÿæˆå·¥å…·é‚£è¾¹çš„ä¸šåŠ¡è°ƒæ•´ï¼Œæˆ‘ä»¬ä¸‹åˆèŒ¶å›¢é˜Ÿçš„æ‰¹é‡ç”Ÿæˆé…é¢ä¸å¤Ÿç”¨å•¦ï¼ï¼ï¼

è¿™ä¸ªæ—¶å€™å°±åªèƒ½é€šè¿‡èˆ¹é•¿çš„å¯†é’¥å€ŸåŠ© `apifox` è¿™ç±»å·¥å…·æ¥æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªçš„åˆ›å»ºçŸ­é“¾ï¼Œè¿™å¯¹äºä¸€ä¸ªç¨‹åºå‘˜æ¥è¯´ç®€ç›´ä¸èƒ½å¿ï¼èƒ½å¤šç‚¹å‡ æ¬¡æŒ‰é’®å°±å·²ç»æ˜¯æˆ‘æœ€å¤§çš„è®©æ­¥å•¦ï¼ï¼ï¼

æ‰€ä»¥ï¼Œç°åœ¨æ€¥éœ€å®Œå–„è¿™ä¸ªæ‰©å±•ç¨‹åºï¼Œè‡ªåŠ¨ç»™æˆ‘æŠŠæ¯ä¸ªæ–‡ç« ç”Ÿæˆå¯¹åº”çŸ­é“¾æ¥å¹¶ä¸”ç»„åˆæˆä¸€ä¸ªä¸‹åˆèŒ¶æ¶ˆæ¯ã€‚

> ps: ä¹‹å‰ç¬¬ä¸€ç‰ˆæ¯å¤©çš„ä¸‹åˆèŒ¶æ¶ˆæ¯ä¹Ÿä¾ç„¶æ˜¯æ‰‹åŠ¨ç¼–è¾‘çš„ï¼ŒçœŸæ˜¯ç´¯åäº†ğŸ˜

## å…ˆçœ‹çœ‹æ•ˆæœ

åœ¨è¿›è¡Œäº†ä¸€ç³»åˆ—å®Œå–„ä¹‹åï¼Œæˆ‘å¾—åˆ°äº†ä¸‹åˆèŒ¶ç”Ÿæˆå·¥å…·çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œå…ˆç»™å¤§å®¶çœ‹çœ‹æ•ˆæœå§~

![image-20240507105557158](./docs-images/%E4%B8%BA%E4%BA%86%E6%9B%B4%E5%BF%AB%E6%8D%B7%E7%9A%84%E7%94%9F%E6%88%90%E6%8E%98%E9%87%91%E4%B8%8B%E5%8D%88%E8%8C%B6%EF%BC%8C%E6%88%91%E7%89%B9%E5%9C%B0%E6%95%B4%E4%BA%86%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/image-20240507105557158.png)

![image-20240507105605272](./docs-images/%E4%B8%BA%E4%BA%86%E6%9B%B4%E5%BF%AB%E6%8D%B7%E7%9A%84%E7%94%9F%E6%88%90%E6%8E%98%E9%87%91%E4%B8%8B%E5%8D%88%E8%8C%B6%EF%BC%8C%E6%88%91%E7%89%B9%E5%9C%B0%E6%95%B4%E4%BA%86%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/image-20240507105605272.png)

ä»æ“ä½œè¿‡ç¨‹æ¥è®²ï¼Œå°†ä¹‹å‰çš„å¼¹å‡ºå¼èœå•æ”¹æˆäº†é¡µé¢æ’å…¥ã€‚

ç‚¹å‡»æ‰©å±•ç¨‹åºæŒ‰é’®æ—¶ï¼Œä¼šåœ¨å½“å‰é¡µå³ä¾§å¼¹å‡ºä¸€ä¸ªä¾§è¾¹æ ï¼Œæ”¯æŒé€‰æ‹©ä¸‹åˆèŒ¶çš„åˆ†ç±»ï¼Œå¹¶æä¾›æŸ¥è¯¢æ‰€æœ‰æ˜é‡‘æ–‡ç« æ ‡ç­¾é¡µçš„åŠŸèƒ½ã€‚

æ ‡ç­¾é¡µä¿¡æ¯æŸ¥å‡ºæ¥ä¹‹åï¼Œå¯ä»¥é‡æ–°ç‚¹å‡» â€œæŸ¥è¯¢æ–‡ç« æ ‡ç­¾é¡µâ€ æŒ‰é’®æ¥æ›´æ–°æ–‡ç« åˆ—è¡¨å†…å®¹ï¼Œæˆ–è€…ç‚¹å‡» â€œç”ŸæˆçŸ­é“¾â€ æŒ‰é’®æ¥ä¸ºæ‰€æœ‰å·²é€‰æ–‡ç« ç”ŸæˆçŸ­é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºåœ¨æ–‡ç« åˆ—è¡¨ä¸‹æ–¹ã€‚

ç„¶åä¼šæä¾› â€œç”Ÿæˆä¸‹åˆèŒ¶æ¶ˆæ¯â€ çš„æŒ‰é’®ï¼Œç”¨æ¥æ‰“å¼€ä¸‹åˆèŒ¶æ¶ˆæ¯çš„é¢„è§ˆå¼¹çª—ã€‚æ¶ˆæ¯ä¸­æ”¯æŒæ’å…¥ä¸ŠæœŸæ¯æ—¥æ˜é‡‘æ–‡ç« ä»¥åŠè¿‘æœŸæ´»åŠ¨ï¼ˆå½“ç„¶ã€æ–‡ç« åªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯æ´»åŠ¨å¯ä»¥æœ‰å¤šæ¡ï¼‰ï¼Œå¹¶ä¸”éçŸ­é“¾å¹³å°çš„åœ°å€å‰ç¼€è¿˜ä¼šè°ƒç”¨çŸ­é“¾ç”Ÿæˆå·¥å…·çš„æ¥å£æ¥ç”Ÿæˆå¯¹åº”çš„çŸ­é“¾åœ°å€ï¼Œç„¶åå†æ’å…¥åˆ°ä¸‹åˆèŒ¶æ¶ˆæ¯ä¸­ã€‚

åç»­å¯ä»¥ç›´æ¥å¤åˆ¶ç”Ÿæˆçš„æ–‡æœ¬ä¿¡æ¯ç”¨æ¥å‘é€ä¸‹åˆèŒ¶æ¶ˆæ¯ï¼Œæˆ–è€…å¤åˆ¶ä¸ºè¡¨æ ¼ä¿¡æ¯åˆ°é£ä¹¦æ–‡æ¡£ä¸­ã€‚

æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° **æœ¬åœ°ç¼“å­˜ã€ç½‘ç»œè¯·æ±‚ã€æ ‡ç­¾é¡µæŸ¥è¯¢ã€å…ƒç´ æ’å…¥** ç­‰å†…å®¹ã€‚

ç”±äºè°·æ­Œæ‰©å±•ç¨‹åºçš„å®‰å…¨è®¾è®¡ï¼Œéƒ¨åˆ†æ¨¡å—æ— æ³•ç›´æ¥å‘é€éåŒæºçš„ç½‘ç»œè¯·æ±‚ï¼Œæ‰€ä»¥è¿™ä¸ªç‰ˆæœ¬å°†å†…å®¹åˆ†æˆäº† `content` ä¸ `background` ä¸¤ä¸ªéƒ¨åˆ†ã€‚

`background` ç”¨æ¥æŸ¥è¯¢æ ‡ç­¾ä¿¡æ¯ï¼Œå‘é€è¯·æ±‚ç”ŸæˆçŸ­é“¾æ¥ç­‰å·¥ä½œï¼›è€Œ `content` åˆ™çº¯ç²¹å®ç°ç”¨æˆ·äº¤äº’éƒ¨åˆ†çš„å†…å®¹ã€‚

ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ Chrome æ’ä»¶çš„ç›¸å…³æ¦‚å¿µå’Œé€šä¿¡æ–¹å¼ã€‚

## å›é¡¾ä¸€ä¸‹ Chrome æ’ä»¶

### manifest.json

è¯¥æ–‡ä»¶åœ¨ [Chrome for Developers å¼€å‘è€…æ–‡æ¡£](https://developer.chrome.com/docs/extensions/reference/manifest?hl=zh-cn) ä¸­è¢«ç§°ä¸º â€œæ¸…å•æ–‡ä»¶â€ï¼Œæ¯ä¸ªæ‰©å±•ç¨‹åºçš„æ ¹ç›®å½•ä¸­éƒ½å¿…é¡»åŒ…å«ä¸€ä¸ª `manifest.json` æ–‡ä»¶ï¼Œå…¶ä¸­ä¼šåˆ—å‡ºæœ‰å…³è¯¥æ‰©å±•ç¨‹åºçš„ç»“æ„å’Œè¡Œä¸ºçš„é‡è¦ä¿¡æ¯ã€‚

å…¶ä¸­å¿…è¦å†…å®¹æœ‰ï¼š

- `manifest_version` æ¸…å•æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬ï¼Œç›®å‰å”¯ä¸€æŒ‡å®šå€¼æ˜¯ `3`ã€‚
- `name`ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºåœ¨ [Chrome åº”ç”¨å•†åº—](https://chrome.google.com/webstore?hl=zh-cn)ã€å®‰è£…å¯¹è¯æ¡†å’Œç”¨æˆ·çš„ Chrome æ‰©å±•ç¨‹åºé¡µé¢ (`chrome://extensions`) ä¸­æ ‡è¯†æ‰©å±•ç¨‹åºã€‚é•¿åº¦ä¸Šé™ä¸º 75 ä¸ªå­—ç¬¦ã€‚
- `version` ç”¨äºæ ‡è¯†æ‰©å±•ç¨‹åºç‰ˆæœ¬å·çš„å­—ç¬¦ä¸²ã€‚
- `description` ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºæè¿° Chrome åº”ç”¨å•†åº—å’Œç”¨æˆ·æ‰©å±•ç¨‹åºç®¡ç†é¡µé¢ä¸Šçš„æ‰©å±•ç¨‹åºã€‚é•¿åº¦ä¸Šé™ä¸º 132 ä¸ªå­—ç¬¦ã€‚
- `icons` ä»£è¡¨æ‰©å±•ç¨‹åºçš„ä¸€ä¸ªæˆ–å¤šä¸ªå›¾æ ‡ã€‚

å¸¸ç”¨å†…å®¹ï¼š

- `author` æŒ‡å®šç”¨äºåˆ›å»ºæ‰©å±•ç¨‹åºçš„å¸å·çš„ç”µå­é‚®ä»¶åœ°å€ã€‚

- `action` å®šä¹‰æ‰©å±•ç¨‹åºå›¾æ ‡åœ¨ Chrome å·¥å…·æ ä¸­çš„ **å¤–è§‚å’Œè¡Œä¸º**ã€‚
- `background` æŒ‡å®šåŒ…å«æ‰©å±•ç¨‹åº Service Worker çš„ JavaScript æ–‡ä»¶ï¼Œè¯¥ Service Worker å……å½“ **äº‹ä»¶å¤„ç†è„šæœ¬**ã€‚
- `content_scripts` æŒ‡å®šåœ¨ç”¨æˆ·æ‰“å¼€ **æŸäº›** ç½‘é¡µæ—¶è¦ä½¿ç”¨çš„ JavaScript æˆ– CSS æ–‡ä»¶ã€‚
- `devtools_page` å®šä¹‰ä½¿ç”¨ [DevTools](https://developer.chrome.com/docs/extensions/how-to/devtools/extend-devtools?hl=zh-cn) API çš„é¡µé¢ã€‚
- `side_panel` æ ‡è¯†è¦åœ¨ [sidePanel](https://developer.chrome.com/docs/extensions/reference/api/sidePanel?hl=zh-cn) ä¸­æ˜¾ç¤ºçš„ HTML æ–‡ä»¶ã€‚
- `chrome_url_overrides` å®šä¹‰é»˜è®¤ Chrome ç½‘é¡µçš„æ›¿æ¢é¡µé¢ã€‚
- `web_accessible_resources` å®šä¹‰æ‰©å±•ç¨‹åºä¸­å¯ç”±ç½‘é¡µæˆ–å…¶ä»–æ‰©å±•ç¨‹åºè®¿é—®çš„æ–‡ä»¶ã€‚
- `permissions` å…è®¸ä½¿ç”¨ç‰¹å®šçš„æ‰©å±•ç¨‹åº APIã€‚
- `host_permissions` åˆ—å‡ºå…è®¸æ‚¨çš„æ‰©å±•ç¨‹åºä¸ä¹‹äº’åŠ¨çš„ç½‘é¡µï¼Œä½¿ç”¨ç½‘å€åŒ¹é…æ¨¡å¼å®šä¹‰ã€‚ç³»ç»Ÿä¼šåœ¨å®‰è£…åº”ç”¨æ—¶è¯·æ±‚è¿™äº›ç½‘ç«™çš„ç”¨æˆ·æƒé™ã€‚
- `commands` å®šä¹‰æ‰©å±•ç¨‹åºä¸­çš„é”®ç›˜å¿«æ·é”®ã€‚

 å…¶ä¸­ï¼Œ`background` ä¸»è¦ä½œä¸ºæ•´ä¸ªæ‰©å±•ç¨‹åºçš„äº‹ä»¶å¤„ç†ä¸­å¿ƒå’Œé€»è¾‘æ‰§è¡Œä¸­å¿ƒï¼Œ`content_scripts` ç”¨äºæ’å…¥ç½‘é¡µå†…å®¹åŒºè¿›è¡Œ dom æ“ä½œï¼Œ`devtools_page` ç”¨æ¥æ‰©å±•å¼€å‘è€…ç•Œé¢ tab é¡µï¼Œ`side_panel` åˆ™æ˜¯æ§åˆ¶ Chrome çš„ä¾§è¾¹æ çš„æ˜¾ç¤ºå†…å®¹ã€‚

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`side_panel` è¿˜éœ€è¦é…åˆ `permissions` ä¸­çš„ `"sidePanel"` æƒé™ã€‚

ç”±äºå½“å‰çš„éœ€æ±‚æˆ‘ä»¬åªéœ€è¦æ˜¾ç¤ºæ ‡ç­¾é¡µä¿¡æ¯ä»¥åŠå‘é€çŸ­é“¾ç”Ÿæˆè¯·æ±‚ï¼Œæ‰€ä»¥è¯¥æ’ä»¶ç›®å‰åªä½¿ç”¨äº† `content_scripts` ä¸ `background` ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼›å½“ç„¶ï¼Œä¸ºäº†ä¿æŒæ’å…¥å†…å®¹çš„æ ·å¼ï¼Œè¿˜éœ€è¦è®¾ç½® `web_accessible_resources` æ¥ç¡®ä¿æ ·å¼å†…å®¹èƒ½å¤Ÿå¼•å…¥ã€‚

### ä¸»è¦ç»„æˆ

![image-20240507145116580](./docs-images/%E4%B8%BA%E4%BA%86%E6%9B%B4%E5%BF%AB%E6%8D%B7%E7%9A%84%E7%94%9F%E6%88%90%E6%8E%98%E9%87%91%E4%B8%8B%E5%8D%88%E8%8C%B6%EF%BC%8C%E6%88%91%E7%89%B9%E5%9C%B0%E6%95%B4%E4%BA%86%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/image-20240507145116580.png)

> æ–°æ ‡ç­¾é¡µåˆå§‹å†…å®¹ç­‰é€šè¿‡ä¸Šè¿°çš„æŒ‡å®šé…ç½®å®Œæˆã€‚

å…¶ä¸­ï¼Œ`actions icons` éƒ¨åˆ†ä¸ºæ‰€æœ‰ **å·²å®‰è£…å¹¶ä¸”å›ºå®š** çš„æ‰©å±•ç¨‹åºä¸­ `manifest` æŒ‡å®šçš„ `action` é…ç½®ä¸‹ `default_icon` é…ç½®çš„å›¾æ ‡ç»„æˆçš„åˆ—è¡¨ï¼Œå¯ä»¥ **æ‰“å¼€ `popup` å¼¹å‡ºé¡µé¢æˆ–è€…è§¦å‘ `chrome.action.onClicked` æ‰€ç»‘å®šçš„äº‹ä»¶**ï¼ˆä¸¤è€…å­˜åœ¨å†²çªï¼Œä¸èƒ½å…±å­˜ï¼‰ã€‚

`devtools page` åˆ™æ˜¯æŒ‡å®šçš„å¼€å‘è€…å·¥å…·é¡µé¢å†…å®¹ï¼Œå¯ä»¥é€šè¿‡ `manifest` ä¸­çš„ `devtools_page` é¡¹é…ç½®ï¼Œå¯å•ç‹¬æ–°å¢å·¥å…·æ æ ‡ç­¾é¡µï¼Œä¹Ÿå¯ä»¥æ’å…¥å·²æœ‰ï¼ˆä¾‹å¦‚ `Elements` å…ƒç´ æ ‡ç­¾ï¼‰æ ‡ç­¾ä¸­ã€‚æ¯ä¸ªé¢æ¿ä¹Ÿéƒ½æ˜¯ä¸€ä¸ª `html` é¡µé¢ï¼Œå¯ä»¥åŒ…å«å…¶ä»–èµ„æºæ–‡ä»¶ã€‚

`popup` å¼¹å‡ºé¡µé¢ä¸ `side panel` ä¾§è¾¹æ é¡µé¢éƒ½æ˜¯å®Œæ•´çš„ html é¡µé¢ï¼Œä½†æ˜¯ `popup` éœ€è¦åœ¨æ¸…å•æ–‡ä»¶çš„ `action` ä¸­æŒ‡å®š `default_popup` é»˜è®¤å±•å¼€é¡µé¢æ–‡ä»¶çš„è·¯å¾„ï¼Œè€Œ `side panel` å¯ä»¥é€šè¿‡åœ¨æ¸…å•æ–‡ä»¶ä¸­çš„ `side_panel` é…ç½®é¡¹ä¸­æŒ‡å®šé»˜è®¤ä¾§è¾¹æ å†…å®¹é¡µé¢è·¯å¾„ï¼ˆ`default_path` é…ç½®ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åœ¨ `background` ä¸­ç›‘å¬æ ‡ç­¾é¡µæ”¹å˜æ¥ä¸ºæŒ‡å®šç½‘ç«™æ‰“å¼€ä¾§è¾¹æ ï¼Œå…·ä½“é…ç½®è§ï¼š[æ–‡æ¡£/sidePanel](https://developer.chrome.com/docs/extensions/reference/api/sidePanel?hl=zh-cn)

è‡³äº `content scripts` å†…å®¹è„šæœ¬ï¼Œåˆ™æ˜¯ **æ³¨å…¥åˆ°ç½‘ç«™ä¸»ä½“ä¸­æ‰§è¡Œçš„è„šæœ¬å†…å®¹**ï¼Œå¯ä»¥åŒ…å« JavaScript æ–‡ä»¶ä»¥åŠ CSS æ–‡ä»¶ï¼Œå¯ä»¥åœ¨æ¸…å•æ–‡ä»¶ä¸­çš„ `content_scripts` ä¸­é™æ€å£°æ˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `chrome.scripting.registerContentScripts` æˆ–è€… `chrome.scripting.updateContentScripts` ï¼Œæˆ–è€… `chrome.scripting.executeScript` åŠ¨æ€æ³¨å…¥ã€‚ 

> ğŸš¨ è¯·æ³¨æ„ï¼Œæ³¨å…¥çš„å‡½æ•°æ˜¯ `chrome.scripting.executeScript()` è°ƒç”¨ä¸­å¼•ç”¨çš„å‡½æ•°çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯åŸå§‹å‡½æ•°æœ¬èº«ã€‚å› æ­¤ï¼Œå‡½æ•°çš„æ­£æ–‡å¿…é¡»æ˜¯è‡ªåŒ…å«ï¼›å¦‚æœå¼•ç”¨å‡½æ•°å¤–éƒ¨çš„å˜é‡ï¼Œä¼šå¯¼è‡´å†…å®¹è„šæœ¬æŠ›å‡º [`ReferenceError`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/ReferenceError)ã€‚

### æ¶ˆæ¯ä¼ é€’ï¼ˆé€šä¿¡æ–¹å¼ï¼‰

ç”±äº `context scripts` ä¸­çš„å†…å®¹ä¼šå—åŒæºç­–ç•¥çš„å½±å“ï¼Œå¹¶ä¸” `popup` ä¸æ³¨å…¥è„šæœ¬ä¹Ÿæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šæ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚å’Œç›¸äº’é€šä¿¡éƒ½ä¼šé€šè¿‡ `background` æ¥å¤„ç†ã€‚

Chrome æ‰©å±•ç¨‹åºä¸­çš„é€šä¿¡æ–¹å¼ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š

1. ä¸€æ¬¡æ€§è¯·æ±‚
2. é•¿è¿æ¥

### ä¸€æ¬¡æ€§è¯·æ±‚

**ä¸€æ¬¡æ€§è¯·æ±‚** ä¸æˆ‘ä»¬å¸¸è¯´çš„ **å‘å¸ƒè®¢é˜…** æ¨¡å¼çš„æ¦‚å¿µä¸€è‡´ã€‚

é€šè¿‡ `addListener` æ³¨å†Œäº‹ä»¶ç›‘å¬å¤„ç†ç¨‹åºï¼Œé€šè¿‡ `sendMessage` å‘å¸ƒäº‹ä»¶æ¶ˆæ¯ã€‚

**æ³¨å†Œç›‘å¬ç¨‹åº** å¸¸ç”¨çš„æ–¹å¼ä¸ºï¼š

```js
chrome.runtime.onMessage.addListener(
  callback: (message: any, sender: MessageSender, sendResponse: function) => boolean â”ƒ undefined,
)
```

è€Œ **å‘é€äº‹ä»¶æ¶ˆæ¯**ï¼Œåˆ™æœ‰ä¸¤ç§å¸¸è§æ–¹å¼ï¼š

```js
// message: any = {}

// æ–¹å¼ 1
// declare
chrome.runtime.sendMessage(
  extensionId?: string,
  message: any,
  options?: object,
  callback?: function,
)
// example
(async () => {
  const response = await chrome.runtime.sendMessage(message);
  // do something with response here, not outside the function
  console.log(response);
})();

// æ–¹å¼ 2
// declare
chrome.tabs.sendMessage(
  tabId: number,
  message: any,
  options?: object,
  callback?: function,
)
// example
(async () => {
  const [tab] = await chrome.tabs.query({ active: true, lastFocusedWindow: true });
  const response = await chrome.tabs.sendMessage(tab.id, message);
  // do something with response here, not outside the function
  console.log(response);
})();
```

å…¶ä¸­ï¼Œæ–¹å¼ 1 å¸¸ç”¨äº `content scripts` å¯¹å¤–å‘é€æ¶ˆæ¯ï¼Œè€Œå‘ `content scripts` å‘é€æ¶ˆæ¯ï¼Œåˆ™é€šå¸¸éœ€è¦æŒ‡å®šè¿™ä¸ªæ¶ˆæ¯è¯·æ±‚ **åº”ç”¨äºå“ªä¸ªé¡µé¢**ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ `tabs.query({ active: true, lastFocusedWindow: true })` æŸ¥è¯¢å½“å‰æ¿€æ´»æ ‡ç­¾é¡µï¼Œç„¶åå‘é€æ¶ˆæ¯ã€‚

> ğŸš¨ å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šä¸¤ç§æ–¹å¼çš„ **ç¤ºä¾‹** éƒ½æ˜¯é‡‡ç”¨çš„åŒæ­¥è°ƒç”¨çš„æ–¹å¼ï¼Œå¦‚æœä½¿ç”¨ `callback` å›è°ƒå‡½æ•°ï¼Œåˆ™è¡¨ç¤ºå¼‚æ­¥ä½¿ç”¨ï¼Œéœ€è¦å°† `return true` æ·»åŠ åˆ° `sendMessage` çš„å›è°ƒå‡½æ•°ä¸­ã€‚
>
> ```js
> // æ–¹å¼ 1
> (() => {
>   chrome.runtime.sendMessage(message, (response) => {
>     // do something with response here, not outside the function
>     console.log(response);
>     return true
>   });
> })();
> // æ–¹å¼ 2
> (() => {
>   chrome.tabs.query({ active: true, lastFocusedWindow: true }, ([tab]) => {
>     chrome.tabs.sendMessage(tab.id, message, (response) => {
>       // do something with response here, not outside the function
>       console.log(response);
>       return true
>     }) 
>   })
> })();
> ```

### é•¿è¿æ¥

ä¸€æ¬¡æ€§è¯·æ±‚é€šè¿‡æ‰‹åŠ¨æ‰§è¡Œ `sendMessage` æ¥ç‹¬ç«‹å‘é€ä¸€æ¬¡æ¶ˆæ¯ï¼Œè§¦å‘ç›‘å¬å‡½æ•°æ‰§è¡Œï¼Œè€Œé•¿è¿æ¥åˆ™æ˜¯å»ºç«‹ä¸€ä¸ªé•¿æœŸå­˜åœ¨ã€å¯é‡å¤ä½¿ç”¨çš„æ¶ˆæ¯ä¼ é€’é€šé“ã€‚

å¯ä»¥é€šè¿‡ `chrome.runtime.connect({ name: string }): Port` æˆ–è€… `chrome.tabs.connect({ name: string }): Port` æ¥åˆ›å»ºä¸€ä¸ªæŒ‡å®šé¢‘é“åç§°çš„æ¶ˆæ¯é€šé“å®ä¾‹ã€‚

ç„¶åé€šè¿‡è¯¥é€šé“å®ä¾‹çš„ `onMessage.addListener` æ–¹æ³•æ³¨å†Œæ¶ˆæ¯ç›‘å¬å‡½æ•°ï¼Œé€šè¿‡ `postMessage` å‘é€é€šé“æ¶ˆæ¯ã€‚

ä¾‹å¦‚ **åœ¨æ³¨å…¥è„šæœ¬** ä¸­ï¼š

```js
// content-script.js
var port = chrome.runtime.connect({ name: "knockknock" });
port.postMessage({ joke: "Knock knock" });
port.onMessage.addListener(function(msg) {
  if (msg.question === "Who's there?")
    port.postMessage({ answer: "Madame" });
  else if (msg.question === "Madame who?")
    port.postMessage({ answer: "Madame... Bovary" });
});
```

è€Œå¦‚æœæˆ‘ä»¬è¦åœ¨ **æ‰©å±•ç¨‹åº**ï¼ˆä¾‹å¦‚ `popup` éƒ¨åˆ†ï¼‰ ä¸­åˆ›å»ºæ¶ˆæ¯é€šé“ï¼Œåˆ™éœ€è¦æ›¿æ¢ä¸º `chrome.tabs.connect({ name: string }): Port`ï¼Œå…¶ä½™éƒ¨åˆ†ä¸å˜ã€‚

å½“æ¶ˆæ¯é€šé“åˆ›å»ºå®Œæ¯•ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨ **éæ¶ˆæ¯é€šé“åˆ›å»ºéƒ¨åˆ†** çš„å…¶ä»–åœ°æ–¹ä½¿ç”¨è¿™ä¸ªæ¶ˆæ¯é€šé“å†…çš„æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥é€šè¿‡ `chrome.runtime.onConnect.addListener((port: Port) => void)` æ¥æ³¨å†Œ **æ¶ˆæ¯é€šé“å»ºç«‹äº‹ä»¶** çš„ç›‘å¬æ–¹æ³•ã€‚

ç„¶ååœ¨è¿™ä¸ªç›‘å¬æ–¹æ³•ä¸­ï¼Œåˆ¤æ–­ `port` çš„ `name` å±æ€§æ¥æ‰¾åˆ°éœ€è¦çš„æ¶ˆæ¯é€šé“ï¼Œç„¶åå°±å¯ä»¥æŒ‰ç…§ä¸Šè¿°çš„æ–¹å¼ä¸€æ ·ä½¿ç”¨ `port` é€šé“å®ä¾‹äº†ã€‚

```js
chrome.runtime.onConnect.addListener(function (port) {
  console.assert(port.name === "knockknock");
  port.onMessage.addListener(function (msg) {
    if (msg.joke === "Knock knock")
      port.postMessage({ question: "Who's there?" });
    else if (msg.answer === "Madame")
      port.postMessage({ question: "Madame who?" });
    else if (msg.answer === "Madame... Bovary")
      port.postMessage({ question: "I don't get it." });
  });
});
```



åœ¨æˆ‘ä»¬è¿™ä¸ªæ’ä»¶ä¸­ï¼Œä¸»è¦ä½¿ç”¨çš„è¿˜æ˜¯ä¸€æ¬¡æ€§è¯·æ±‚ã€‚

## ç€æ‰‹æ’ä»¶å¼€å‘

åœ¨å¼€å‘ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦ç¡®å®šçš„è‡ªç„¶å°±æ˜¯æŠ€æœ¯é€‰å‹äº†ã€‚

ç”±äºæ¶‰åŠåˆ°ç¨å¾®å¤æ‚çš„é¡µé¢æ ·å¼å’Œäº¤äº’ï¼ˆè¯´ç™½äº†å°±æ˜¯ä¸æƒ³è‡ªå·±å†™ã€‚ã€‚ã€‚ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨ `vite` + `Vue 3` ä½œä¸ºåŸºç¡€ï¼Œä½¿ç”¨ `arco-design` ä½œä¸º UI åº“ã€‚

è€Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºäº† **å®ç°åŠ¨æ€ç¼–è¯‘å’Œåˆ·æ–°æ’ä»¶çŠ¶æ€**ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªæ’ä»¶ â€”â€” [Jervis2049/vite-plugin-crx-mv3](https://github.com/Jervis2049/vite-plugin-crx-mv3)ã€‚

> è¿™ä¸ªæ’ä»¶çš„ä½¿ç”¨æ–¹å¼è¿™é‡Œå°±ä¸åšèµ˜è¿°äº†ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯ **æ ¹æ® `manifest.json` ä¸­çš„å†…å®¹é…ç½®ï¼Œç¼–è¯‘å¯¹åº”çš„æ–‡ä»¶ï¼Œå¹¶å»ºç«‹å¼€å‘æœåŠ¡å™¨ä¸æµè§ˆå™¨ä¹‹é—´çš„ WS é€šä¿¡æ¥åŠ¨æ€æ›´æ–°æ’ä»¶**ã€‚

æœ€ç»ˆçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
./
â”£â” src
â”ƒ  â”£â” app
â”ƒ  â”ƒ	â”£â” components
â”ƒ  â”ƒ  â”—â” App.vue
â”ƒ  â”£â” assets
â”ƒ  â”£â” background
â”ƒ  â”ƒ	â”—â” worker.ts
â”ƒ  â”£â” content-scripts
â”ƒ  â”ƒ  â”—â” content.ts
â”ƒ  â”£â” core
â”ƒ  â”ƒ  â”£â” requests
â”ƒ  â”ƒ  â”£â” store
â”ƒ  â”ƒ  â”—â” utils
â”ƒ  â”£â” types
â”ƒ  â”—â” manifest.json
â”£â” LICENSE
â”£â” package.json
â”£â” pnpm-lock.yaml
â”£â” README.md
â”£â” tsconfig.json
â”£â” tsconfig.node.json
â”—â” vite.config.ts
```

å…¶ä¸­ï¼Œ`app` ä¸ºä¸»è¦çš„ Vue ç»„ä»¶éƒ¨åˆ†ï¼Œ`assets` ä¸ºé™æ€æ ·å¼èµ„æºä¸å›¾æ ‡æ–‡ä»¶ï¼Œ`core` ä¸ºæ ¸å¿ƒçš„è¯·æ±‚æ–¹æ³•ã€å·¥å…·å‡½æ•°ç­‰ä¸»è¦æ‰§è¡Œé€»è¾‘ï¼›`background` ä¸ `context-scripts` å¯¹åº” `manifest` æ¸…å•æ–‡ä»¶ä¸­çš„ `background` ä¸ `content-scripts` æŒ‡å®šçš„å…¥å£æ–‡ä»¶ã€‚

ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ `manifest.json` æ–‡ä»¶ï¼Œé…ç½®æ’ä»¶å¯¹åº”çš„æƒé™ä¸å†…å®¹ï¼š

```json
{
  "name": "æ¯æ—¥æ˜é‡‘å°åŠ©æ‰‹",
  "description": "A Chrome extension for daily-juejin-tea helper.",
  "version": "1.0.0",
  "icons": {
    "16": "assets/icons/icon16.png",
    "48": "assets/icons/icon48.png",
    "128": "assets/icons/icon128.png"
  },
  "action": {},
  "background": {
    "service_worker": "./background/worker.ts",
    "type": "module"
  },
  "content_scripts": [{
    "matches": ["https://juejin.cn/**"],
    "js": [ "content-scripts/content.ts"]
  }],
  "web_accessible_resources": [{
    "matches": ["https://juejin.cn/*"],
    "resources": ["assets/*"]
  }],
  "permissions": ["tabs", "webRequest", "clipboardWrite", "storage"],
  "host_permissions": [
    "https://api.xiaomark.com/*"
  ],
  "manifest_version": 3
}
```

åœ¨é…ç½®ä¸­ï¼Œéœ€è¦åœ¨ `permissions` ä¸­å¼€æ”¾ `"tabs", "webRequest", "clipboardWrite", "storage"` å››ä¸ªæƒé™ï¼Œåˆ†åˆ«ç”¨äº **è¯»å–æ ‡ç­¾é¡µä¿¡æ¯ã€å‘èµ·çŸ­é“¾è½¬æ¢è¯·æ±‚ã€å†™å…¥å‰ªåˆ‡æ¿å†…å®¹ã€è¯»å–/å†™å…¥ä¸‹åˆèŒ¶é»˜è®¤åˆ†ç±»**ã€‚

ç”±äºçŸ­é“¾è¯·æ±‚æœ‰åˆ«äºæ˜é‡‘æ¥æºï¼Œæ‰€ä»¥éœ€è¦åœ¨ `host_permissions` ä¸­é…ç½® `https://api.xiaomark.com/*` å…è®¸å‘èµ·çŸ­é“¾è½¬æ¢è¯·æ±‚ã€‚

è€Œ `web_accessible_resources` åˆ™æ˜¯æ ‡è¯†éœ€è¦æ³¨å…¥çš„æ ·å¼ç­‰é™æ€èµ„æºç›®å½•ã€‚

å½“ç„¶è¿™åªæ˜¯å¼€å‘æ—¶ç¼–å†™çš„å†…å®¹ï¼Œåç»­ä¼šç»è¿‡æ’ä»¶è½¬æ¢ä¸ºå®é™…ä½¿ç”¨çš„æ¸…å•æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š

```json
{
  "name": "æ¯æ—¥æ˜é‡‘å°åŠ©æ‰‹",
  "description": "A Chrome extension for daily-juejin-tea helper.",
  "version": "1.0.0",
  "icons": {
    "16": "assets/icons/icon16.png",
    "48": "assets/icons/icon48.png",
    "128": "assets/icons/icon128.png"
  },
  "action": {},
  "background": {
    "service_worker": "assets/worker-40451f67.js",
    "type": "module"
  },
  "content_scripts": [
    {
      "matches": [
        "https://juejin.cn/**"
      ],
      "js": [
        "contentscript-loader-content-6c2f6608.js"
      ],
      "css": [
        "assets/content-2f830ff4.css"
      ]
    }
  ],
  "web_accessible_resources": [
    {
      "matches": [
        "https://juejin.cn/*"
      ],
      "resources": [
        "assets/*"
      ]
    },
    {
      "matches": [
        "<all_urls>"
      ],
      "resources": [
        "http://www.w3.org/2000/svg",
        "assets/content-6c2f6608.js"
      ],
      "use_dynamic_url": true
    }
  ],
  "permissions": [
    "tabs",
    "webRequest",
    "clipboardWrite",
    "storage"
  ],
  "host_permissions": [
    "https://api.xiaomark.com/*"
  ],
  "manifest_version": 3
}
```

## å®Œå–„æ¶ˆæ¯é€šä¿¡

åœ¨ä¸Šæ–‡æ¶ˆæ¯ä¼ é€’ä¸­ï¼Œæˆ‘ä»¬ç¡®å®šäº†è¯¥æ’ä»¶ä¸­ä¸»è¦ä½¿ç”¨ **ä¸€æ¬¡æ€§è¯·æ±‚** çš„é€šä¿¡æ–¹å¼ã€‚

ä½†æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘å‘ç°ï¼ŒChrome ä¸­çš„å‘å¸ƒè®¢é˜…ä¸æˆ‘ä»¬å¸¸ç”¨çš„å‘å¸ƒè®¢é˜…æ¨¡å¼ä¾ç„¶å­˜åœ¨åŒºåˆ«ï¼Œå³ **æ²¡æœ‰æ˜æ˜¾çš„è®¢é˜…æ”¶é›†è¿‡ç¨‹**ã€‚

ä¾‹å¦‚ï¼š

```js
// background.js
chrome.runtime?.onMessage.addListener((message, sender, sendResponse) => console.log(1));
chrome.runtime?.onMessage.addListener((message, sender, sendResponse) => console.log(2));
chrome.runtime?.onMessage.addListener((message, sender, sendResponse) => console.log(3));
chrome.runtime?.onMessage.addListener((message, sender, sendResponse) => console.log(4));

// Service worker console:
// 1
// 2
// 3
// 4
```

è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤ä¸”é¢‘ç¹çš„æ³¨å†Œç›‘å¬å‡½æ•°ï¼Œå¹¶ä¸”æ‰€æœ‰å‡½æ•°åœ¨æ¥æ”¶ï¼ˆæ¶ˆæ¯è¢«å‘é€ï¼‰åˆ°æ¶ˆæ¯æ—¶éƒ½ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ **åªèƒ½åœ¨ç›‘å¬å‡½æ•°å†…éƒ¨æ ¹æ®æ¶ˆæ¯å‚æ•° `message` çš„å†…å®¹æ¥è¿›è¡Œåˆ¤æ–­ï¼Œä»¥æ‰§è¡Œä¸åŒçš„å¤„ç†é€»è¾‘**ã€‚

å¹¶ä¸”è¿™ç§æ–¹å¼åœ¨æŸäº›ç›‘å¬å‡½æ•°è®¾ç½®ä¸å½“ï¼ˆä¾‹å¦‚å¼‚æ­¥æ“ä½œæ²¡æœ‰è¿›è¡ŒåŒæ­¥è½¬æ¢ï¼‰æ—¶è¿˜ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå½±å“æ’ä»¶çš„æ­£å¸¸è¿è¡Œã€‚

æ‰€ä»¥è¿™ç§æ–¹å¼å¯¹å¼€å‘è€…æ¥è¯´æ˜¯éå¸¸ä¸å‹å¥½çš„ï¼

æœ¬èº«ä¼ ç»Ÿçš„å‘å¸ƒè®¢é˜…æ¨¡å¼å·²ç»éš¾ä»¥ç®¡ç†äº†ï¼Œè¿™ç§ä½¿ç”¨æ–¹å¼è‚¯å®šæ›´åŠ éš¾ä»¥å‘ç°é—®é¢˜ã€‚

æ‰€ä»¥ï¼Œè¿™é‡Œå¯¹å…¶è¿›è¡Œäº†ä¸€éƒ¨åˆ†æ”¹é€ ï¼Œå‘ä¾¿äºç®¡ç†ä¸”å¯æ§åˆ¶çš„æ–¹å‘é æ‹¢ã€‚

æˆ‘ä»¬æ–°å»ºä¸€ä¸ª `messageBus` æ–‡ä»¶ï¼š

```typescript
// src/core/utils/messageBus.ts
export type MsgListener = (
  message: RuntimeMsg,
  sender: chrome.runtime.MessageSender,
  sendResponse: (response?: any) => void,
) => void;

export const runtimeListenersMap: Record<string, MsgListener> = {};
export type RuntimeMsg = {
  action: keyof typeof runtimeListenersMap;
  body?: unknown;
};

export const addRuntimeMsgListener = (
  action: string,
  listener: MsgListener,
  override?: boolean,
) => {
  if (!runtimeListenersMap[action]) {
    runtimeListenersMap[action] = listener;
    return;
  }
  override && (runtimeListenersMap[action] = listener);
};
export const fireRuntimeMsgListener = async <T>(
  action: RuntimeMsg["action"],
  body: RuntimeMsg["body"],
  callback?: (res: T) => void,
) => {
  if (!chrome?.runtime?.sendMessage) return;
  const response = await chrome.runtime.sendMessage({ action, body });
  callback?.(response);
};
export const removeRuntimeMsgListener = (action: string) => {
  if (!runtimeListenersMap[action]) return;
  delete runtimeListenersMap[action];
};

export type ActionClickListener = (
  tab: chrome.tabs.Tab,
) => Promise<unknown> | undefined;
export const ActionClickListeners: ActionClickListener[] = [];
export const addActionClickListener = (listener: ActionClickListener) => {
  ActionClickListeners.push(listener);
};

export const initMessageBus = () => {
  chrome.runtime?.onMessage.addListener(
    (message: RuntimeMsg, sender, sendResponse) => {
      if (runtimeListenersMap[message.action]) {
        runtimeListenersMap[message.action]?.(message, sender, sendResponse);
      } else {
        sendResponse(null);
      }
      return true;
    },
  );
  chrome.action?.onClicked.addListener((tab) => {
    ActionClickListeners.forEach(async (fc) => await fc(tab));
    return true;
  });
};
```

æ ¹æ®å¸¸ç”¨çš„ä¸€æ¬¡æ€§è¯·æ±‚çš„ä½¿ç”¨æ–¹å¼ï¼Œè¿™é‡ŒæŒ‰ç…§ `Runtime`ã€`Tabs`ã€`Action` å‡ ä¸ªéƒ¨åˆ†è¿›è¡Œäº†åˆ†ç±»ï¼ˆ`tabs` çš„ç›‘å¬ç±»ä¼¼ï¼Œä½†æ˜¯ç”±äºæ²¡æ€ä¹ˆç”¨ï¼Œè¿™é‡Œå°±æ²¡æœ‰å†™ï¼‰ã€‚

é€šè¿‡ `initMessageBus` æ¥åˆå§‹åŒ–ä¸€ä¸ªç›‘å¬å¤„ç†å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨è¿›è¡Œåˆ¤æ–­ï¼Œæ¥æ‰§è¡Œå·²æ³¨å†Œçš„ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚

åœ¨ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦ **åœ¨å„ä¸ªéœ€è¦ä½¿ç”¨æ¶ˆæ¯ä¼ é€’çš„æ’ä»¶ç»„æˆéƒ¨åˆ†ä¸­å¼•ç”¨å¹¶æ‰§è¡Œ `initMessageBus` æ–¹æ³•ï¼Œå³å¯å®Œæˆæ‰€æœ‰çš„æ¶ˆæ¯äº‹ä»¶è®¢é˜…å¤„ç†**ã€‚

> ç”±äºä¸åŒçš„æ’ä»¶ç»„æˆï¼Œæ‰€èƒ½è®¿é—®çš„æƒé™ä¹Ÿä¸ä¸€æ ·ï¼Œæ‰€ä»¥åœ¨ `initMessageBus` è¿™ä¸ªæ–¹æ³•ä¸­å¯ä»¥ç›´æ¥é€šè¿‡å¯é€‰é“¾çš„æ–¹å¼æ¥ç»Ÿä¸€å†™å…¥æ‰€æœ‰çš„ `addListener` å®ç°ã€‚

è€Œç›‘å¬å‡½æ•°æ³¨å†Œï¼Œåªéœ€è¦é€šè¿‡ `addRuntimeMsgListener` å’Œ `addActionClickListener` è¿™ç±»æ–¹æ³•å³å¯å®Œæˆè®¢é˜…å‡½æ•°çš„æ³¨å†Œã€‚

å½“ç„¶ï¼Œç”±äºä¸¤è€…æ€§è´¨æœ‰äº›åŒºåˆ«ï¼Œ`chrome.action?.onClicked.addListener` çš„ç›‘å¬å›è°ƒåªæœ‰å½“å‰ `tab` è¿™ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥é‡‡ç”¨çš„æ˜¯æ•°ç»„çš„æ–¹å¼ï¼Œåç»­ä¾ç„¶å¯ä»¥ä¿®æ”¹ä¸ºå¯¹è±¡å½¢å¼ï¼Œæ–¹ä¾¿ç®¡ç†å’Œç§»é™¤ç›‘å¬å‡½æ•°ã€‚

ç»è¿‡è¿™æ ·çš„æ”¹åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `action` æ“ä½œåç§°æ¥æŸ¥æ‰¾å·²æ³¨å†Œçš„ç›‘å¬å‡½æ•°ï¼Œå¹¶ä¸”å‡å°‘äº†ç›‘å¬å‡½æ•°çš„å®é™…æ‰§è¡Œä¸ªæ•°ã€‚

## ç¼–å†™äº¤äº’ç»„ä»¶

ç”±äºå½“æ—¶æ²¡æœ‰å¤ªå¤šæ—¶é—´æ¥æ•´ç†é¡¹ç›®ç»“æ„ï¼Œæ‰€ä»¥å®é™…ä¸Šçš„ä¸šåŠ¡å…¨éƒ¨éƒ½åœ¨ `App.vue` å’Œ `content-scripts/content.ts, background/worker.ts` ä¸­ã€‚

çœç•¥éƒ¨åˆ†éå¿…è¦ä»£ç åï¼Œå¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š

App.vue:

```html
<template>
  <div class="crx-jj-mask" @click="closePanel">
    <div class="crx-jj-container" @click.stop>
      <spin :loading="onLoading" dot style="width: 100%">
        <page-header
          title="æ¯æ—¥æ˜é‡‘"
          subtitle="æ˜é‡‘é…±çš„ä¸‹åˆèŒ¶"
          @back="closePanel"
        />
        <form :model="jjForm" class="jj-tea-form">
          <form-item label="åˆ†ç±»">
            <radio-group v-model="jjForm.type" type="button" @update="changeStorage">
              <radio v-for="op in typeOps" :key="op.value" :value="op.value">{{ op.label }}</radio>
            </radio-group>
          </form-item>
          <form-item label="é“¾æ¥">
            <list style="width: 100%" size="small">
              <list-item v-for="(link, idx) in jjForm.links" :key="idx">
                <list-item-meta :title="link.title" :description="link.link" />
                <template #actions>
                  <icon-delete @click="removeLinkItem(idx)" />
                </template>
              </list-item>
              <template #footer>
                <div class="a-button a-button-long" @click="getTabsInfo">
                  æŸ¥è¯¢æ–‡ç« æ ‡ç­¾é¡µ
                </div>
                <div v-show="jjForm.links.length" class="a-button a-button-long" @click="generateShortLink" >
                  ç”ŸæˆçŸ­é“¾
                </div>
              </template>
            </list>
          </form-item>
          <form-item v-if="hasSuccess" label="çŸ­é“¾">
            <list style="width: 100%" size="small">
              <list-item v-for="(link, idx) in jjForm.links" :key="idx">
                <list-item-meta :title="link.title" :description="link.shortLink" />
              </list-item>
              <template #footer>
                <div v-if="hasSuccess" class="a-button a-button-long" @click="generatorTeaContent">
                  ç”Ÿæˆä¸‹åˆèŒ¶æ¶ˆæ¯
                </div>
              </template>
            </list>
          </form-item>
        </form>
      </spin>

      <modal
        v-model:visible="modelVisible"
        title="ä¸‹åˆèŒ¶"
        :footer="false"
        :render-to-body="false"
      >
        <pre>{{ afternoonTeaContent.header }}</pre>
        <pre v-if="afternoonTeaContent.post">{{`ã€æ¯æ—¥æ˜é‡‘ã€‘\n${afternoonTeaContent.post}`}}</pre>
        <div v-else>
          <a-button type="text" @click="openFormModel('post')">æ’å…¥æ¯æ—¥æ˜é‡‘æ–‡ç« </a-button>
        </div>
        <pre v-if="afternoonTeaContent.activities && afternoonTeaContent.activities.length">{{
            `ã€è¿‘æœŸæ´»åŠ¨ã€‘\n${(afternoonTeaContent.activities || []).join("\n")}`
          }}</pre
        >
        <div>
          <a-button type="text" @click="openFormModel('activity')">æ’å…¥æ´»åŠ¨æ¶ˆæ¯</a-button>
        </div>
        <pre>{{ afternoonTeaContent.body }}</pre>
        <div class="form-footer align-right">
          <div class="a-button" @click="copyToClipboard('text')">å¤åˆ¶æ–‡æœ¬ä¿¡æ¯</div>
          <div class="a-button" @click="copyToClipboard('table')">å¤åˆ¶åˆ°é£ä¹¦</div>
        </div>
      </modal>

      <modal
        v-model:visible="modelFormVisible"
        title="æ’å…¥ä¿¡æ¯"
        :render-to-body="false"
        :footer="false"
      >
        <spin :loading="onFormLoading" dot style="width: 100%">
          <form :model="modelForm" class="jj-tea-form">
            <form-item label="å†…å®¹">
              <a-textarea v-model="modelForm.content" allow-clear />
            </form-item>
            <form-item label="é“¾æ¥">
              <a-textarea v-model="modelForm.link" allow-clear />
            </form-item>
          </form>
          <div class="form-footer align-right">
            <div class="a-button" @click="submitForm">ç¡®è®¤</div>
          </div>
        </spin>
      </modal>
    </div>
  </div>
</template>

<script lang="ts" setup>
import { toggle } from "@/content-scripts/content";
import { fireRuntimeMsgListener } from "@/core/utils/messageBus";
import {
  messageBody,
  messageGenerator,
  messageHeader,
  tableContentGenerator,
} from "@/core/utils/template";
import { setClipboardText } from "@/core/utils/tools";

const typeOps = [
  { label: "å‰ç«¯", value: "frontend" },
  { label: "åç«¯", value: "backend" },
  { label: "ç§»åŠ¨ç«¯", value: "mobileend" },
  { label: "äººå·¥æ™ºèƒ½", value: "ai" },
];

const jjForm = ref<JJForm>({
  type: "frontend",
  links: [],
});
const onLoading = ref(false);
const hasSuccess = ref(false);
const modelVisible = ref(false);
const modelFormVisible = ref(false);
const onFormLoading = ref(false);
const afternoonTeaContent = ref<JJTeaContent>({
  header: "",
  body: "",
  activities: [],
  post: "",
});
const modelForm = ref<Record<"link" | "content" | "type", string>>({
  type: "post",
  link: "",
  content: "",
});

const getTabsInfo = () => {
  hasSuccess.value = false;
  onLoading.value = true;
  fireRuntimeMsgListener("getTabsInfo", "", (res: ProcessTabsResult) => {
    jjForm.value.links = res.links;
    onLoading.value = false;
  });
};

const removeLinkItem = (idx: number) => {
  Modal.warning({
    title: "åˆ é™¤è¯¥é“¾æ¥ï¼Ÿ",
    content: "åˆ é™¤åæ— æ³•æ¢å¤ï¼Œå¯ä»¥é€šè¿‡â€œæŸ¥è¯¢æ ‡ç­¾é¡µâ€é‡ç½®è¯¥åˆ—è¡¨",
    onOk: () => jjForm.value.links.splice(idx, 1),
  });
};

const changeStorage = (value: string) => {
  fireRuntimeMsgListener("setStorage", { "message-type": value });
};

fireRuntimeMsgListener("getStorage", { key: "message-type" }, (res: any) => {
  jjForm.value.type = res || "frontend";
});

const generateShortLink = async () => {
  try {
    onLoading.value = true;
    fireRuntimeMsgListener(
      "generateShortLink",
      jjForm.value.links,
      (res: any[]) => {
        onLoading.value = false;
        if (!res || !res.length) {
          return Notification.error("è¯·æ±‚å¼‚å¸¸");
        }
        for (let i = 0; i < res.length; i++) {
          const data = res[i];
          if (data && data.code === 0) {
            jjForm.value.links[i].shortLink = data.data?.link?.url ?? "";
          }
        }
        hasSuccess.value = true;
      },
    );
  } catch (e) {
    console.error(e);
    hasSuccess.value = false;
    onLoading.value = false;
  }
};

const generatorTeaContent = () => {
  const { type, links } = jjForm.value;
  afternoonTeaContent.value.header = messageHeader(type);
  afternoonTeaContent.value.body = messageBody(links as Required<LinkItem>[]);
  modelVisible.value = true;
};

const openFormModel = (type: string) => {
  modelForm.value = { link: "", content: "", type };
  modelFormVisible.value = true;
};
const submitForm = () => {
  if (!modelForm.value.content || !modelForm.value.link) {
    return Notification.error("ä¿¡æ¯ä¸å®Œæ•´");
  }
  onFormLoading.value = true;
  if (!modelForm.value.link.includes("sourl.co")) {
    fireRuntimeMsgListener(
      "generateShortLink",
      [{ link: modelForm.value.link }],
      (res: any[]) => {
        onLoading.value = false;
        if (!res || !res.length) {
          return Notification.error("è¯·æ±‚å¼‚å¸¸");
        }
        modelForm.value.link = res[0].data?.link?.url ?? modelForm.value.link;
        setMessagePart();
      },
    );
  } else {
    setMessagePart();
  }
};
const setMessagePart = () => {
  if (modelForm.value.type === "post") {
    afternoonTeaContent.value.post = `${modelForm.value.content}\n${modelForm.value.link}`;
  } else {
    if (!afternoonTeaContent.value.activities) {
      afternoonTeaContent.value.activities = [];
    }
    afternoonTeaContent.value.activities.push(
      `${modelForm.value.content}\n${modelForm.value.link}`,
    );
  }
  onFormLoading.value = false;
  modelFormVisible.value = false;
};

const copyToClipboard = async (type: "text" | "table") => {
  const { header, activities, post, body } = afternoonTeaContent.value;
  let text = "";
  if (type === "table") {
    text = tableContentGenerator(jjForm.value.links as Required<LinkItem>[]);
  }
  if (type === "text") {
    text = `${header}\n`;
    post && (text += `ã€æ¯æ—¥æ˜é‡‘ã€‘\n${post}\n`);
    activities &&
      activities.length &&
      (text += `ã€è¿‘æœŸæ´»åŠ¨ã€‘\n${(activities || []).join("\n")}\n`);
    text += body;
  }

  await setClipboardText(text);

  if (type === "table") {
    window.open("https://bytedance.feishu.cn/sheets/****", "__blank");
  }
};

const closePanel = () => {
  toggle(false);
};
</script>

```

content.ts:

```typescript
import { createApp, App } from "vue";
import appVue from "../app/App.vue";
import { setPanelStatus } from "@/core/store";
import "@/assets/styles/app.scss";
import { addRuntimeMsgListener, initMessageBus } from "@/core/utils/messageBus";

let app: null | App = null;

export const toggle = (visible: boolean) => {
  if (!visible) {
    app && app.unmount();
    app = null;
    document.body.style.overflowY = "scroll";
  } else {
    const parent = document.querySelector("#__crx-app");
    if (!parent) {
      const juejinContent = document.querySelector("#__nuxt");
      juejinContent?.insertAdjacentHTML(
        "beforebegin",
        '<div id="__crx-app" class="__crx-app"></div>',
      );
    }
    app = createApp(appVue);
    app.mount("#__crx-app");
    document.body.style.overflowY = "hidden";
  }
  setPanelStatus(visible);
};

const toggleListener = (request: any) => {
  // if (request.action === "toggle") {
  //   toggle(request.body);
  // }
  toggle(request.body);
};

addRuntimeMsgListener("toggle", toggleListener);

initMessageBus();
```

worker.ts:

```typescript
import {
  addActionClickListener,
  addRuntimeMsgListener,
  initMessageBus,
} from "@/core/utils/messageBus";
import {
  getStorage,
  setStorage,
  processJuejinPostTabs,
  processShortLink,
} from "@/core/utils/functions";
import { getPanelStatus, setPanelStatus } from "@/core/store";

// /////////// ä¾§è¾¹æ æ˜¾ç¤ºæ§åˆ¶
const toggleTab = async (tab?: chrome.tabs.Tab) => {
  const newStatus = !getPanelStatus();
  await chrome.tabs?.sendMessage(tab!.id!, {
    action: "toggle",
    body: newStatus,
  });
  setPanelStatus(newStatus);
};
addActionClickListener(toggleTab);

// ///////////////////////// æ¶ˆæ¯äº‹ä»¶
addRuntimeMsgListener("getTabsInfo", (request, sender, sendResponse) => {
  processJuejinPostTabs(sendResponse);
});

addRuntimeMsgListener("generateShortLink", (request, sender, sendResponse) => {
  processShortLink(request, sendResponse);
});

addRuntimeMsgListener("getStorage", (request, sender, sendResponse) => {
  getStorage(request, sendResponse);
});

addRuntimeMsgListener("setStorage", (request, sender, sendResponse) => {
  setStorage(request, sendResponse);
});

// æ³¨å†Œ worker ç›¸å…³çš„äº‹ä»¶ç›‘å¬å™¨
initMessageBus();
```

å…¶ä¸­ï¼Œ`App.vue` ä¸­å‡ ä¸ªæŒ‰é’®çš„ä½œç”¨å°±æ˜¯ **å¯¹å¤–å‘é€æŒ‡å®šçš„æ¶ˆæ¯ï¼Œè§¦å‘æŒ‡å®šçš„é€»è¾‘å¤„ç†å‡½æ•°**ã€‚

ç„¶åå°†æ¶ˆæ¯ä¼ é€’ç»™ `background/worker` ä¸­ï¼Œæ‰§è¡Œå®é™…çš„ç½‘ç»œè¯·æ±‚ä»¥åŠæ•°æ®å¤„ç†ç­‰ã€‚

> å®Œæ•´ä»£ç è§ï¼š[miyuesc/daily-juejin-tea-extension](https://github.com/miyuesc/daily-juejin-tea-extension)

## å®Œç»“æ’’èŠ±~

è‡³æ­¤ï¼Œè¿™ä¸ªæ’ä»¶çš„å¤§æ¦‚å†…å®¹å°±å·®ä¸å¤šäº†ã€‚

å¯èƒ½éƒ¨åˆ†åŒå­¦ä¼šè§‰å¾—å®é™…ä¸Šçš„æ’ä»¶éƒ¨åˆ†å¹¶æ²¡æœ‰è®²å¤ªå¤šå†…å®¹ï¼Œä½†è¯¥æ’ä»¶çš„æ ¸å¿ƒå…¶å®å°±æ˜¯ **æ¶ˆæ¯ä¼ é€’** éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„å±äºåŸºç¡€çš„ Vue ç»„ä»¶ç¼–å†™å’Œç½‘ç»œè¯·æ±‚å¤„ç†ã€ä»¥åŠå­—ç¬¦ä¸²æ“ä½œç­‰ã€‚

æ•´ä¸ªæ’ä»¶ï¼Œé€šè¿‡ `action` ç‚¹å‡»äº‹ä»¶ï¼Œè§¦å‘ `content-scripts` ä¸­çš„è„šæœ¬æ‰§è¡Œï¼Œæ¥åˆ‡æ¢æ³¨å…¥å†…å®¹çš„æ˜¾ç¤ºä¸éšè—ã€‚

åœ¨ `content` æ³¨å…¥å†…å®¹ä¸­ï¼Œåˆ™å€¼æä¾›æ•°æ®æ˜¾ç¤ºä¸æ•°æ®å½•å…¥ï¼Œé€šè¿‡æ¶ˆæ¯å°†å‰å°å†…å®¹ä¼ é€’ç»™ `background` è¿›è¡Œå¤„ç†ï¼Œç„¶åæ‹¿åˆ°å¤„ç†ç»“æœè¿›è¡Œåç»­é€»è¾‘ã€‚

ç†è§£äº†æ’ä»¶çš„æ¶ˆæ¯ä¼ é€’ä¹‹åï¼Œå†å¼€å‘è¿™ç±»æ’ä»¶å°±éå¸¸ç®€å•äº†ï¼ˆå½“ç„¶åƒ Vue Devtools è¿™ç§å¤æ‚æ’ä»¶å°±å½“æˆ‘æ²¡è¯´ï¼Œï¼Œï¼Œï¼‰

åç»­éšç€æ˜é‡‘ä¸‹åˆèŒ¶çš„ç»§ç»­å‘æ‰¬å…‰å¤§ï¼Œè¿™ä¸ªæ’ä»¶ä¹Ÿå¯èƒ½ä¼šå†æ¬¡è¿›è¡Œè¿­ä»£ï¼Œä¸ºæ¯æ—¥æ˜é‡‘çš„å„ä¸ªå°ä¼™ä¼´æä¾›æ›´åŠ æ–¹ä¾¿çš„åŠŸèƒ½ã€‚

## æœ€å

æœ¬æ–‡åˆ°è¿™é‡Œå°±ç»“æŸå•¦~å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¸Œæœ›ä½ èƒ½ç‚¹èµæ”¶è—ï¼›å¦‚æœæ–‡ä¸­æœ‰ä¸å½“ä¹‹å¤„ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½åœ¨è¯„è®ºé‡ŒåŠæ—¶æŒ‡å‡ºï¼Œå¤§å®¶çš„æ”¯æŒä¹Ÿæ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›~~

å¦‚æœæƒ³è¦å…³æ³¨æ›´å¤šçš„å‰ç«¯å†…å®¹ï¼Œå¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š [MiyueFE çš„å‰ç«¯åœˆ](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d6027b7efc244b8af5ee9c5df81e9a4~tplv-k3u1fbpfcp-zoom-1.image)ï¼Œæˆ–è€…åœ¨ [FrontendAskMeAnything](https://github.com/miyuesc/FrontendAskMeAnything/issues) ä¸­æå‡ºç–‘é—®æˆ–è€…å‚ä¸è®¨è®º~

ååˆ†æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼

