## Single SPA

### 1. 介绍

`Single SPA` 作为做早且最知名的微前端框架，目前已经更新到了第五个大版本，当前版本为 `v5.9.4`。

在 `Single SPA` 中定义了三种微前端实现方式，也可以称为“微前端类型”

1. `Applications` 应用程序：需要有对应的“路由匹配规则”，并且包含完整的 `SIngle SPA API` 和渲染部分，由 `Single SPA` 来管理应用生命周期。如果是按照路由来拆分应用的话，这种模式是最合适的一种
2. `Parcels` 沙箱：与路由完全无关，类似一个第三方库。并且与当前使用的技术栈也没有关联，可以由任意应用来挂载或者卸载。每个沙箱模块需要自己实现生命周期函数对应的处理过程，必须包含 `bootstrap` 初始化、`mount` 挂载、`unmount` 卸载方法。
3. `Common Modules` 通用模块：这个就和名字一样，给微应用共同使用的公共模块，不依赖路由，没有声明周期和渲染方式，仅作为一个公共依赖库使用，通常用来保存工具函数等内容

> 通常拆分一个“巨石应用”的方式，就是使用 `Application` 将每个业务功能模块进行拆分，针对全局共享的 UI 组件（比如用户信息弹窗、全局消息通知组件）等作为 `Parcel` 沙箱，最后将 `Utils` 和 `Styles` 等公共依赖模块放置到 `Common Module` 中进行共享。

### 2. 微应用拆分和管理

虽然将“巨石应用”拆分之后对各个微应用的管理更加便捷，也可以降低开发者的心智负担。但是，如何将所有微应用整合到一起呢？

`Single SPA` 团队在这个问题上给出了三个建议：

1. 公用一个仓库和一套打包配置（`Monorepo`），对于每个微应用打包之后都在根目录下的 `index.html` 文件中插入一个 `script` 标签用来引入微应用。
2. 采用 `NPM dependencies` 管理的方式，这样每个微应用都可以有自己的代码仓库和打包配置，并且互不影响；整体打包统一由根应用来安装微应用依赖并打包成整体。
3. 动态加载微应用模块，这样可以让子应用单独部署，由根应用控制加载对应的微应用。这里提供了两种版本控制的方式：
   1. 修改 Web 服务器，添加对应的版本控制脚本，这样不需要修改其他应用配置
   2. 使用 `System.js` 这样的浏览器模块加载方式，通过控制对应版本的微应用 `Url` 来实现应用控制

三种方式的优缺点对比如下：

| 拆分方式                     | 优点                                                                                                      | 缺点                                                                                                      |
|--------------------------|---------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|
| `Monorepo`               | 1. 拆分简单<br/> 2. 方便整体管理                                                                                  | 1. 项目一样会越来越大<br/> 2. 公用打包配置，灵活性不够，受技术栈影响<br/> 3. 微应用不能独立构建和部署 4. 公用 `package.json`，依赖限制较大，项目安装依赖和启动都不便利 |
| `NPM dependencies`       | 1. 每个应用可独立开发，各自的依赖版本与打包配置不受影响<br/>2. 仓库独立，心智负担小，各应用管理更加便捷<br/>3. 通过根应用的 `package.json` 管理微应用版本，版本管理更加清晰 | 1. 完整应用发布依然受微应用版本限制，不能分开发布和部署<br/>2. 项目初始拆分的难度稍大<br/>3. 通常是公司或者产品组内部项目，需要独立的 `NPM` 包管理服务或者 `Git` 配置     |
| `Dynamic Module Loading` | 1. 微应用**完全独立**，心智负担小<br/>2. 通过配置文件或者脚本进行版本管理，更加便捷                                                       | 1. 首次应用拆分最为困难<br/>2.                                                                                    |

