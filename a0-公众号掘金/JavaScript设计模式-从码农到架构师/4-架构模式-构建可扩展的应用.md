# æ¶æ„æ¨¡å¼ï¼šæ„å»ºå¯æ‰©å±•çš„åº”ç”¨

> ä»å•ä½“åº”ç”¨åˆ°å¾®å‰ç«¯ï¼Œä»MVCåˆ°MVVMï¼Œæ¶æ„æ¨¡å¼å†³å®šäº†åº”ç”¨çš„ç”Ÿå‘½åŠ›ã€‚å¥½çš„æ¶æ„å°±åƒåŸå¸‚è§„åˆ’ï¼Œæ—¢è¦æ»¡è¶³å½“å‰éœ€æ±‚ï¼Œåˆè¦ä¸ºæœªæ¥å‘å±•ç•™è¶³ç©ºé—´ã€‚

## ä¸€ã€MVCæ¨¡å¼ï¼šç»å…¸çš„ä¸‰å±‚æ¶æ„

### 1.1 ä»€ä¹ˆæ˜¯MVCï¼Ÿ

MVCï¼ˆModel-View-Controllerï¼‰æ˜¯æœ€ç»å…¸çš„æ¶æ„æ¨¡å¼ä¹‹ä¸€ï¼Œå°†åº”ç”¨åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š
- **Modelï¼ˆæ¨¡å‹ï¼‰**ï¼šè´Ÿè´£æ•°æ®ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘
- **Viewï¼ˆè§†å›¾ï¼‰**ï¼šè´Ÿè´£ç”¨æˆ·ç•Œé¢å±•ç¤º
- **Controllerï¼ˆæ§åˆ¶å™¨ï¼‰**ï¼šè´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œåè°ƒModelå’ŒView

å°±åƒä¸€ä¸ªé¤å…ï¼šå¨å¸ˆï¼ˆModelï¼‰è´Ÿè´£åšèœï¼ŒæœåŠ¡å‘˜ï¼ˆControllerï¼‰è´Ÿè´£æ¥å•å’Œä¼ èœï¼Œé¤æ¡Œï¼ˆViewï¼‰è´Ÿè´£å±•ç¤ºç¾é£Ÿã€‚

### 1.2 JavaScriptä¸­çš„MVCå®ç°

```javascript
// Modelå±‚ - æ•°æ®æ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘
class TodoModel {
  constructor() {
    this.todos = [];
    this.observers = [];
    this.currentId = 1;
  }
  
  // è§‚å¯Ÿè€…æ¨¡å¼ï¼Œé€šçŸ¥è§†å›¾æ›´æ–°
  addObserver(observer) {
    this.observers.push(observer);
  }
  
  removeObserver(observer) {
    this.observers = this.observers.filter(obs => obs !== observer);
  }
  
  notifyObservers(action, data) {
    this.observers.forEach(observer => {
      if (typeof observer.update === 'function') {
        observer.update(action, data);
      }
    });
  }
  
  // ä¸šåŠ¡é€»è¾‘æ–¹æ³•
  addTodo(text, priority = 'medium') {
    if (!text || text.trim().length === 0) {
      throw new Error('Todoæ–‡æœ¬ä¸èƒ½ä¸ºç©º');
    }
    
    const todo = {
      id: this.currentId++,
      text: text.trim(),
      completed: false,
      priority: priority,
      createdAt: new Date(),
      updatedAt: new Date()
    };
    
    this.todos.push(todo);
    this.notifyObservers('add', todo);
    
    return todo;
  }
  
  removeTodo(id) {
    const index = this.todos.findIndex(todo => todo.id === id);
    if (index === -1) {
      throw new Error(`Todo with id ${id} not found`);
    }
    
    const removedTodo = this.todos.splice(index, 1)[0];
    this.notifyObservers('remove', removedTodo);
    
    return removedTodo;
  }
  
  updateTodo(id, updates) {
    const todo = this.todos.find(todo => todo.id === id);
    if (!todo) {
      throw new Error(`Todo with id ${id} not found`);
    }
    
    const oldTodo = { ...todo };
    Object.assign(todo, updates, { updatedAt: new Date() });
    
    this.notifyObservers('update', { old: oldTodo, new: todo });
    
    return todo;
  }
  
  toggleTodo(id) {
    const todo = this.todos.find(todo => todo.id === id);
    if (!todo) {
      throw new Error(`Todo with id ${id} not found`);
    }
    
    return this.updateTodo(id, { completed: !todo.completed });
  }
  
  getTodos(filter = 'all') {
    switch (filter) {
      case 'active':
        return this.todos.filter(todo => !todo.completed);
      case 'completed':
        return this.todos.filter(todo => todo.completed);
      case 'high':
      case 'medium':
      case 'low':
        return this.todos.filter(todo => todo.priority === filter);
      default:
        return [...this.todos];
    }
  }
  
  getStats() {
    const total = this.todos.length;
    const completed = this.todos.filter(todo => todo.completed).length;
    const active = total - completed;
    
    const priorityStats = this.todos.reduce((stats, todo) => {
      stats[todo.priority] = (stats[todo.priority] || 0) + 1;
      return stats;
    }, {});
    
    return {
      total,
      completed,
      active,
      completionRate: total > 0 ? (completed / total * 100).toFixed(1) : 0,
      priorityStats
    };
  }
  
  // æ•°æ®æŒä¹…åŒ–
  save() {
    try {
      localStorage.setItem('todos', JSON.stringify(this.todos));
      localStorage.setItem('currentId', this.currentId.toString());
      return true;
    } catch (error) {
      console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
      return false;
    }
  }
  
  load() {
    try {
      const todosData = localStorage.getItem('todos');
      const currentIdData = localStorage.getItem('currentId');
      
      if (todosData) {
        this.todos = JSON.parse(todosData).map(todo => ({
          ...todo,
          createdAt: new Date(todo.createdAt),
          updatedAt: new Date(todo.updatedAt)
        }));
      }
      
      if (currentIdData) {
        this.currentId = parseInt(currentIdData, 10);
      }
      
      this.notifyObservers('load', this.todos);
      return true;
    } catch (error) {
      console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
      return false;
    }
  }
}

// Viewå±‚ - ç”¨æˆ·ç•Œé¢
class TodoView {
  constructor(containerId) {
    this.container = document.getElementById(containerId);
    if (!this.container) {
      throw new Error(`Container with id '${containerId}' not found`);
    }
    
    this.currentFilter = 'all';
    this.init();
  }
  
  init() {
    this.container.innerHTML = `
      <div class="todo-app">
        <header class="todo-header">
          <h1>ğŸ“ Todo MVC</h1>
          <div class="todo-stats" id="todoStats"></div>
        </header>
        
        <div class="todo-input-section">
          <input 
            type="text" 
            id="todoInput" 
            placeholder="æ·»åŠ æ–°çš„å¾…åŠäº‹é¡¹..." 
            class="todo-input"
          >
          <select id="prioritySelect" class="priority-select">
            <option value="low">ä½ä¼˜å…ˆçº§</option>
            <option value="medium" selected>ä¸­ä¼˜å…ˆçº§</option>
            <option value="high">é«˜ä¼˜å…ˆçº§</option>
          </select>
          <button id="addBtn" class="add-btn">æ·»åŠ </button>
        </div>
        
        <div class="todo-filters">
          <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
          <button class="filter-btn" data-filter="active">æœªå®Œæˆ</button>
          <button class="filter-btn" data-filter="completed">å·²å®Œæˆ</button>
          <button class="filter-btn" data-filter="high">é«˜ä¼˜å…ˆçº§</button>
          <button class="filter-btn" data-filter="medium">ä¸­ä¼˜å…ˆçº§</button>
          <button class="filter-btn" data-filter="low">ä½ä¼˜å…ˆçº§</button>
        </div>
        
        <div class="todo-list" id="todoList"></div>
        
        <div class="todo-actions">
          <button id="clearCompleted" class="action-btn">æ¸…é™¤å·²å®Œæˆ</button>
          <button id="saveData" class="action-btn">ä¿å­˜æ•°æ®</button>
          <button id="loadData" class="action-btn">åŠ è½½æ•°æ®</button>
        </div>
      </div>
    `;
    
    this.addStyles();
  }
  
  addStyles() {
    const style = document.createElement('style');
    style.textContent = `
      .todo-app {
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f8f9fa;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      
      .todo-header {
        text-align: center;
        margin-bottom: 20px;
      }
      
      .todo-header h1 {
        color: #2c3e50;
        margin: 0 0 10px 0;
      }
      
      .todo-stats {
        background: #e9ecef;
        padding: 10px;
        border-radius: 8px;
        font-size: 14px;
        color: #6c757d;
      }
      
      .todo-input-section {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      
      .todo-input {
        flex: 1;
        padding: 12px;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        font-size: 16px;
        outline: none;
        transition: border-color 0.3s;
      }
      
      .todo-input:focus {
        border-color: #007bff;
      }
      
      .priority-select {
        padding: 12px;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        background: white;
        cursor: pointer;
      }
      
      .add-btn {
        padding: 12px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.3s;
      }
      
      .add-btn:hover {
        background: #0056b3;
      }
      
      .todo-filters {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      
      .filter-btn {
        padding: 8px 16px;
        border: 2px solid #dee2e6;
        background: white;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
      }
      
      .filter-btn.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
      }
      
      .filter-btn:hover:not(.active) {
        background: #f8f9fa;
        border-color: #adb5bd;
      }
      
      .todo-list {
        min-height: 200px;
        margin-bottom: 20px;
      }
      
      .todo-item {
        display: flex;
        align-items: center;
        padding: 12px;
        margin-bottom: 8px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
      }
      
      .todo-item:hover {
        transform: translateY(-1px);
      }
      
      .todo-item.completed {
        opacity: 0.7;
      }
      
      .todo-checkbox {
        margin-right: 12px;
        transform: scale(1.2);
        cursor: pointer;
      }
      
      .todo-text {
        flex: 1;
        font-size: 16px;
        transition: all 0.3s;
      }
      
      .todo-text.completed {
        text-decoration: line-through;
        color: #6c757d;
      }
      
      .todo-priority {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
        margin-right: 8px;
      }
      
      .priority-high {
        background: #dc3545;
        color: white;
      }
      
      .priority-medium {
        background: #ffc107;
        color: #212529;
      }
      
      .priority-low {
        background: #28a745;
        color: white;
      }
      
      .todo-meta {
        font-size: 12px;
        color: #6c757d;
        margin-right: 8px;
      }
      
      .todo-delete {
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 6px 10px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s;
      }
      
      .todo-delete:hover {
        background: #c82333;
      }
      
      .todo-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .action-btn {
        padding: 10px 16px;
        border: 2px solid #6c757d;
        background: white;
        color: #6c757d;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }
      
      .action-btn:hover {
        background: #6c757d;
        color: white;
      }
      
      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
      }
      
      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
    `;
    
    document.head.appendChild(style);
  }
  
  // æ¸²æŸ“å¾…åŠäº‹é¡¹åˆ—è¡¨
  renderTodos(todos) {
    const todoList = document.getElementById('todoList');
    
    if (todos.length === 0) {
      todoList.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ“</div>
          <p>æš‚æ— å¾…åŠäº‹é¡¹</p>
          <p>æ·»åŠ ä¸€ä¸ªæ–°çš„ä»»åŠ¡å¼€å§‹å§ï¼</p>
        </div>
      `;
      return;
    }
    
    todoList.innerHTML = todos.map(todo => `
      <div class="todo-item ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
        <input 
          type="checkbox" 
          class="todo-checkbox" 
          ${todo.completed ? 'checked' : ''}
          data-id="${todo.id}"
        >
        <span class="todo-text ${todo.completed ? 'completed' : ''}">${this.escapeHtml(todo.text)}</span>
        <span class="todo-priority priority-${todo.priority}">${this.getPriorityText(todo.priority)}</span>
        <span class="todo-meta">${this.formatDate(todo.createdAt)}</span>
        <button class="todo-delete" data-id="${todo.id}">åˆ é™¤</button>
      </div>
    `).join('');
  }
  
  // æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯
  renderStats(stats) {
    const statsElement = document.getElementById('todoStats');
    const priorityStatsText = Object.entries(stats.priorityStats)
      .map(([priority, count]) => `${this.getPriorityText(priority)}: ${count}`)
      .join(' | ');
    
    statsElement.innerHTML = `
      æ€»è®¡: ${stats.total} | 
      å·²å®Œæˆ: ${stats.completed} | 
      æœªå®Œæˆ: ${stats.active} | 
      å®Œæˆç‡: ${stats.completionRate}%
      ${priorityStatsText ? '<br>' + priorityStatsText : ''}
    `;
  }
  
  // æ›´æ–°è¿‡æ»¤å™¨çŠ¶æ€
  updateFilter(filter) {
    this.currentFilter = filter;
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.classList.remove('active');
      if (btn.dataset.filter === filter) {
        btn.classList.add('active');
      }
    });
  }
  
  // è·å–ç”¨æˆ·è¾“å…¥
  getTodoInput() {
    const input = document.getElementById('todoInput');
    const priority = document.getElementById('prioritySelect');
    
    return {
      text: input.value.trim(),
      priority: priority.value
    };
  }
  
  // æ¸…ç©ºè¾“å…¥æ¡†
  clearInput() {
    document.getElementById('todoInput').value = '';
    document.getElementById('prioritySelect').value = 'medium';
  }
  
  // æ˜¾ç¤ºæ¶ˆæ¯
  showMessage(message, type = 'info') {
    // ç®€å•çš„æ¶ˆæ¯æç¤ºå®ç°
    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;
    messageDiv.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      background: ${type === 'error' ? '#dc3545' : '#28a745'};
      color: white;
      border-radius: 8px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
      messageDiv.remove();
    }, 3000);
  }
  
  // å·¥å…·æ–¹æ³•
  escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  getPriorityText(priority) {
    const priorityMap = {
      high: 'é«˜',
      medium: 'ä¸­',
      low: 'ä½'
    };
    return priorityMap[priority] || priority;
  }
  
  formatDate(date) {
    const now = new Date();
    const diff = now - date;
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    const days = Math.floor(diff / 86400000);
    
    if (minutes < 1) return 'åˆšåˆš';
    if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
    if (hours < 24) return `${hours}å°æ—¶å‰`;
    if (days < 7) return `${days}å¤©å‰`;
    
    return date.toLocaleDateString('zh-CN');
  }
  
  // è§‚å¯Ÿè€…æ¨¡å¼æ¥å£
  update(action, data) {
    console.log(`View received update: ${action}`, data);
    // è¿™é‡Œå¯ä»¥æ ¹æ®ä¸åŒçš„actionåšä¸åŒçš„UIæ›´æ–°
    // å®é™…çš„æ›´æ–°ä¼šé€šè¿‡Controlleræ¥åè°ƒ
  }
}

// Controllerå±‚ - æ§åˆ¶é€»è¾‘
class TodoController {
  constructor(model, view) {
    this.model = model;
    this.view = view;
    
    // è®©Viewè§‚å¯ŸModelçš„å˜åŒ–
    this.model.addObserver(this);
    
    this.init();
  }
  
  init() {
    this.bindEvents();
    this.loadData();
    this.updateView();
  }
  
  // ç»‘å®šäº‹ä»¶
  bindEvents() {
    const container = this.view.container;
    
    // æ·»åŠ å¾…åŠäº‹é¡¹
    container.addEventListener('click', (e) => {
      if (e.target.id === 'addBtn') {
        this.handleAddTodo();
      }
    });
    
    // å›è½¦æ·»åŠ 
    container.addEventListener('keypress', (e) => {
      if (e.target.id === 'todoInput' && e.key === 'Enter') {
        this.handleAddTodo();
      }
    });
    
    // åˆ‡æ¢å®ŒæˆçŠ¶æ€
    container.addEventListener('change', (e) => {
      if (e.target.classList.contains('todo-checkbox')) {
        const id = parseInt(e.target.dataset.id);
        this.handleToggleTodo(id);
      }
    });
    
    // åˆ é™¤å¾…åŠäº‹é¡¹
    container.addEventListener('click', (e) => {
      if (e.target.classList.contains('todo-delete')) {
        const id = parseInt(e.target.dataset.id);
        this.handleDeleteTodo(id);
      }
    });
    
    // è¿‡æ»¤å™¨
    container.addEventListener('click', (e) => {
      if (e.target.classList.contains('filter-btn')) {
        const filter = e.target.dataset.filter;
        this.handleFilterChange(filter);
      }
    });
    
    // æ“ä½œæŒ‰é’®
    container.addEventListener('click', (e) => {
      switch (e.target.id) {
        case 'clearCompleted':
          this.handleClearCompleted();
          break;
        case 'saveData':
          this.handleSaveData();
          break;
        case 'loadData':
          this.handleLoadData();
          break;
      }
    });
  }
  
  // å¤„ç†æ·»åŠ å¾…åŠäº‹é¡¹
  handleAddTodo() {
    try {
      const input = this.view.getTodoInput();
      
      if (!input.text) {
        this.view.showMessage('è¯·è¾“å…¥å¾…åŠäº‹é¡¹å†…å®¹', 'error');
        return;
      }
      
      this.model.addTodo(input.text, input.priority);
      this.view.clearInput();
      this.view.showMessage('æ·»åŠ æˆåŠŸï¼');
      
    } catch (error) {
      this.view.showMessage(error.message, 'error');
    }
  }
  
  // å¤„ç†åˆ‡æ¢å®ŒæˆçŠ¶æ€
  handleToggleTodo(id) {
    try {
      this.model.toggleTodo(id);
    } catch (error) {
      this.view.showMessage(error.message, 'error');
    }
  }
  
  // å¤„ç†åˆ é™¤å¾…åŠäº‹é¡¹
  handleDeleteTodo(id) {
    try {
      this.model.removeTodo(id);
      this.view.showMessage('åˆ é™¤æˆåŠŸï¼');
    } catch (error) {
      this.view.showMessage(error.message, 'error');
    }
  }
  
  // å¤„ç†è¿‡æ»¤å™¨å˜åŒ–
  handleFilterChange(filter) {
    this.view.updateFilter(filter);
    this.updateView();
  }
  
  // å¤„ç†æ¸…é™¤å·²å®Œæˆ
  handleClearCompleted() {
    try {
      const completedTodos = this.model.getTodos('completed');
      
      if (completedTodos.length === 0) {
        this.view.showMessage('æ²¡æœ‰å·²å®Œæˆçš„å¾…åŠäº‹é¡¹', 'error');
        return;
      }
      
      completedTodos.forEach(todo => {
        this.model.removeTodo(todo.id);
      });
      
      this.view.showMessage(`æ¸…é™¤äº† ${completedTodos.length} ä¸ªå·²å®Œæˆçš„å¾…åŠäº‹é¡¹`);
      
    } catch (error) {
      this.view.showMessage(error.message, 'error');
    }
  }
  
  // å¤„ç†ä¿å­˜æ•°æ®
  handleSaveData() {
    if (this.model.save()) {
      this.view.showMessage('æ•°æ®ä¿å­˜æˆåŠŸï¼');
    } else {
      this.view.showMessage('æ•°æ®ä¿å­˜å¤±è´¥', 'error');
    }
  }
  
  // å¤„ç†åŠ è½½æ•°æ®
  handleLoadData() {
    if (this.model.load()) {
      this.view.showMessage('æ•°æ®åŠ è½½æˆåŠŸï¼');
      this.updateView();
    } else {
      this.view.showMessage('æ•°æ®åŠ è½½å¤±è´¥', 'error');
    }
  }
  
  // åŠ è½½åˆå§‹æ•°æ®
  loadData() {
    this.model.load();
  }
  
  // æ›´æ–°è§†å›¾
  updateView() {
    const todos = this.model.getTodos(this.view.currentFilter);
    const stats = this.model.getStats();
    
    this.view.renderTodos(todos);
    this.view.renderStats(stats);
  }
  
  // è§‚å¯Ÿè€…æ¨¡å¼æ¥å£ - å“åº”Modelå˜åŒ–
  update(action, data) {
    console.log(`Controller received update: ${action}`, data);
    
    // æ ¹æ®ä¸åŒçš„æ“ä½œç±»å‹ï¼Œå†³å®šæ˜¯å¦éœ€è¦æ›´æ–°è§†å›¾
    switch (action) {
      case 'add':
      case 'remove':
      case 'update':
      case 'load':
        this.updateView();
        break;
      default:
        console.log(`Unknown action: ${action}`);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function mvcDemo() {
  console.log('=== MVCæ¨¡å¼Todoåº”ç”¨ç¤ºä¾‹ ===');
  
  // åˆ›å»ºHTMLå®¹å™¨
  if (!document.getElementById('todoApp')) {
    const container = document.createElement('div');
    container.id = 'todoApp';
    document.body.appendChild(container);
  }
  
  // åˆå§‹åŒ–MVCç»„ä»¶
  const model = new TodoModel();
  const view = new TodoView('todoApp');
  const controller = new TodoController(model, view);
  
  // æ·»åŠ ä¸€äº›ç¤ºä¾‹æ•°æ®
  setTimeout(() => {
    try {
      model.addTodo('å­¦ä¹ JavaScriptè®¾è®¡æ¨¡å¼', 'high');
      model.addTodo('å®Œæˆé¡¹ç›®æ–‡æ¡£', 'medium');
      model.addTodo('ä»£ç é‡æ„', 'low');
      
      console.log('âœ… MVC Todoåº”ç”¨åˆå§‹åŒ–å®Œæˆï¼');
      console.log('ğŸ“Š å½“å‰ç»Ÿè®¡:', model.getStats());
    } catch (error) {
      console.error('åˆå§‹åŒ–æ•°æ®å¤±è´¥:', error);
    }
  }, 100);
  
  return { model, view, controller };
}

// å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œè‡ªåŠ¨è¿è¡Œç¤ºä¾‹
if (typeof window !== 'undefined' && typeof document !== 'undefined') {
  // ç­‰å¾…DOMåŠ è½½å®Œæˆ
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', mvcDemo);
  } else {
    mvcDemo();
  }
}
```

## äºŒã€MVVMæ¨¡å¼ï¼šæ•°æ®é©±åŠ¨çš„ç°ä»£æ¶æ„

### 2.1 MVVM vs MVC

MVVMï¼ˆModel-View-ViewModelï¼‰æ˜¯MVCçš„è¿›åŒ–ç‰ˆæœ¬ï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼š
- **ViewModel**ï¼šæ›¿ä»£Controllerï¼Œè´Ÿè´£æ•°æ®ç»‘å®šå’Œä¸šåŠ¡é€»è¾‘
- **åŒå‘æ•°æ®ç»‘å®š**ï¼šViewå’ŒViewModelä¹‹é—´è‡ªåŠ¨åŒæ­¥
- **æ›´å°‘çš„æ ·æ¿ä»£ç **ï¼šæ¡†æ¶å¤„ç†å¤§éƒ¨åˆ†UIæ›´æ–°é€»è¾‘

### 2.2 ç®€åŒ–ç‰ˆMVVMå®ç°

```javascript
// ç®€å•çš„å“åº”å¼ç³»ç»Ÿ
class ReactiveSystem {
  constructor() {
    this.dependencies = new Map();
    this.currentEffect = null;
  }
  
  // ä¾èµ–æ”¶é›†
  track(target, key) {
    if (!this.currentEffect) return;
    
    if (!this.dependencies.has(target)) {
      this.dependencies.set(target, new Map());
    }
    
    const depsMap = this.dependencies.get(target);
    if (!depsMap.has(key)) {
      depsMap.set(key, new Set());
    }
    
    depsMap.get(key).add(this.currentEffect);
  }
  
  // è§¦å‘æ›´æ–°
  trigger(target, key) {
    const depsMap = this.dependencies.get(target);
    if (!depsMap) return;
    
    const effects = depsMap.get(key);
    if (effects) {
      effects.forEach(effect => effect());
    }
  }
  
  // åˆ›å»ºå“åº”å¼å¯¹è±¡
  reactive(obj) {
    return new Proxy(obj, {
      get: (target, key) => {
        this.track(target, key);
        return target[key];
      },
      set: (target, key, value) => {
        target[key] = value;
        this.trigger(target, key);
        return true;
      }
    });
  }
  
  // åˆ›å»ºè®¡ç®—å±æ€§
  computed(fn) {
    let value;
    let dirty = true;
    
    const effect = () => {
      if (dirty) {
        value = fn();
        dirty = false;
      }
    };
    
    const computedRef = {
      get value() {
        if (dirty) {
          const prevEffect = reactiveSystem.currentEffect;
          reactiveSystem.currentEffect = effect;
          value = fn();
          dirty = false;
          reactiveSystem.currentEffect = prevEffect;
        }
        reactiveSystem.track(computedRef, 'value');
        return value;
      }
    };
    
    // æ ‡è®°ä¸ºè„æ•°æ®çš„effect
    const dirtyEffect = () => {
      dirty = true;
      reactiveSystem.trigger(computedRef, 'value');
    };
    
    this.currentEffect = dirtyEffect;
    fn(); // åˆå§‹æ”¶é›†ä¾èµ–
    this.currentEffect = null;
    
    return computedRef;
  }
  
  // ç›‘å¬å™¨
  watch(source, callback) {
    let oldValue;
    
    const effect = () => {
      const newValue = typeof source === 'function' ? source() : source.value;
      if (newValue !== oldValue) {
        callback(newValue, oldValue);
        oldValue = newValue;
      }
    };
    
    this.currentEffect = effect;
    oldValue = typeof source === 'function' ? source() : source.value;
    this.currentEffect = null;
    
    // è®¾ç½®ç›‘å¬
    this.currentEffect = effect;
    if (typeof source === 'function') {
      source();
    }
    this.currentEffect = null;
  }
  
  // å‰¯ä½œç”¨å‡½æ•°
  effect(fn) {
    this.currentEffect = fn;
    fn();
    this.currentEffect = null;
  }
}

// å…¨å±€å“åº”å¼ç³»ç»Ÿå®ä¾‹
const reactiveSystem = new ReactiveSystem();

// ViewModelåŸºç±»
class ViewModel {
  constructor(data = {}) {
    // åˆ›å»ºå“åº”å¼æ•°æ®
    this.data = reactiveSystem.reactive(data);
    this.computedCache = new Map();
    this.watchers = [];
    
    // ç»‘å®šæ–¹æ³•
    this.bindMethods();
  }
  
  // ç»‘å®šæ–¹æ³•åˆ°å®ä¾‹
  bindMethods() {
    const proto = Object.getPrototypeOf(this);
    const methodNames = Object.getOwnPropertyNames(proto)
      .filter(name => name !== 'constructor' && typeof this[name] === 'function');
    
    methodNames.forEach(name => {
      this[name] = this[name].bind(this);
    });
  }
  
  // åˆ›å»ºè®¡ç®—å±æ€§
  computed(key, fn) {
    if (this.computedCache.has(key)) {
      return this.computedCache.get(key);
    }
    
    const computedRef = reactiveSystem.computed(() => fn.call(this));
    this.computedCache.set(key, computedRef);
    
    // åœ¨å®ä¾‹ä¸Šåˆ›å»ºgetter
    Object.defineProperty(this, key, {
      get() {
        return computedRef.value;
      },
      configurable: true
    });
    
    return computedRef;
  }
  
  // åˆ›å»ºç›‘å¬å™¨
  watch(source, callback) {
    const watcher = reactiveSystem.watch(
      typeof source === 'string' ? () => this.data[source] : source,
      callback
    );
    this.watchers.push(watcher);
    return watcher;
  }
  
  // æ›´æ–°æ•°æ®
  updateData(updates) {
    Object.assign(this.data, updates);
  }
  
  // è·å–æ•°æ®
  getData() {
    return { ...this.data };
  }
}

// å…·ä½“çš„ViewModelå®ç°
class UserProfileViewModel extends ViewModel {
  constructor() {
    super({
      firstName: '',
      lastName: '',
      email: '',
      age: 0,
      avatar: '',
      bio: '',
      skills: [],
      isEditing: false,
      errors: {}
    });
    
    this.setupComputed();
    this.setupWatchers();
  }
  
  setupComputed() {
    // è®¡ç®—å…¨å
    this.computed('fullName', () => {
      const { firstName, lastName } = this.data;
      return `${firstName} ${lastName}`.trim();
    });
    
    // è®¡ç®—å¹´é¾„ç»„
    this.computed('ageGroup', () => {
      const age = this.data.age;
      if (age < 18) return 'æœªæˆå¹´';
      if (age < 30) return 'é’å¹´';
      if (age < 50) return 'ä¸­å¹´';
      return 'è€å¹´';
    });
    
    // è®¡ç®—æŠ€èƒ½æ ‡ç­¾
    this.computed('skillTags', () => {
      return this.data.skills.map(skill => `#${skill}`).join(' ');
    });
    
    // è®¡ç®—è¡¨å•éªŒè¯çŠ¶æ€
    this.computed('isValid', () => {
      const errors = this.validateForm();
      return Object.keys(errors).length === 0;
    });
    
    // è®¡ç®—ä¸ªäººèµ„æ–™å®Œæ•´åº¦
    this.computed('profileCompleteness', () => {
      const { firstName, lastName, email, age, bio } = this.data;
      const fields = [firstName, lastName, email, age > 0, bio];
      const completedFields = fields.filter(Boolean).length;
      return Math.round((completedFields / fields.length) * 100);
    });
  }
  
  setupWatchers() {
    // ç›‘å¬é‚®ç®±å˜åŒ–ï¼Œè‡ªåŠ¨éªŒè¯
    this.watch('email', (newEmail) => {
      if (newEmail) {
        this.validateEmail(newEmail);
      }
    });
    
    // ç›‘å¬å¹´é¾„å˜åŒ–
    this.watch('age', (newAge, oldAge) => {
      console.log(`å¹´é¾„ä» ${oldAge} å˜æ›´ä¸º ${newAge}`);
      if (newAge < 0) {
        this.data.age = 0;
      } else if (newAge > 150) {
        this.data.age = 150;
      }
    });
    
    // ç›‘å¬ç¼–è¾‘çŠ¶æ€å˜åŒ–
    this.watch('isEditing', (isEditing) => {
      if (isEditing) {
        console.log('è¿›å…¥ç¼–è¾‘æ¨¡å¼');
        this.backupData = { ...this.data };
      } else {
        console.log('é€€å‡ºç¼–è¾‘æ¨¡å¼');
      }
    });
  }
  
  // è¡¨å•éªŒè¯
  validateForm() {
    const errors = {};
    const { firstName, lastName, email, age } = this.data;
    
    if (!firstName.trim()) {
      errors.firstName = 'è¯·è¾“å…¥åå­—';
    }
    
    if (!lastName.trim()) {
      errors.lastName = 'è¯·è¾“å…¥å§“æ°';
    }
    
    if (!email.trim()) {
      errors.email = 'è¯·è¾“å…¥é‚®ç®±';
    } else if (!this.isValidEmail(email)) {
      errors.email = 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®';
    }
    
    if (age <= 0) {
      errors.age = 'è¯·è¾“å…¥æœ‰æ•ˆå¹´é¾„';
    }
    
    this.data.errors = errors;
    return errors;
  }
  
  validateEmail(email) {
    const isValid = this.isValidEmail(email);
    if (!isValid) {
      this.data.errors = {
        ...this.data.errors,
        email: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'
      };
    } else {
      const { email: emailError, ...otherErrors } = this.data.errors;
      this.data.errors = otherErrors;
    }
    return isValid;
  }
  
  isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }
  
  // ä¸šåŠ¡æ–¹æ³•
  startEditing() {
    this.data.isEditing = true;
  }
  
  cancelEditing() {
    if (this.backupData) {
      Object.assign(this.data, this.backupData);
      delete this.backupData;
    }
    this.data.isEditing = false;
  }
  
  saveProfile() {
    const errors = this.validateForm();
    if (Object.keys(errors).length > 0) {
      console.error('è¡¨å•éªŒè¯å¤±è´¥:', errors);
      return false;
    }
    
    // æ¨¡æ‹Ÿä¿å­˜åˆ°æœåŠ¡å™¨
    console.log('ä¿å­˜ç”¨æˆ·èµ„æ–™:', this.getData());
    this.data.isEditing = false;
    delete this.backupData;
    return true;
  }
  
  addSkill(skill) {
    if (skill && !this.data.skills.includes(skill)) {
      this.data.skills.push(skill);
    }
  }
  
  removeSkill(skill) {
    const index = this.data.skills.indexOf(skill);
    if (index > -1) {
      this.data.skills.splice(index, 1);
    }
  }
  
  updateField(field, value) {
    this.data[field] = value;
  }
  
  resetProfile() {
    this.updateData({
      firstName: '',
      lastName: '',
      email: '',
      age: 0,
      avatar: '',
      bio: '',
      skills: [],
      isEditing: false,
      errors: {}
    });
  }
  
  loadProfile(profileData) {
    this.updateData({
      ...profileData,
      isEditing: false,
      errors: {}
    });
  }
}

// Viewå±‚ - ä½¿ç”¨ViewModel
class UserProfileView {
  constructor(containerId, viewModel) {
    this.container = document.getElementById(containerId);
    this.viewModel = viewModel;
    
    if (!this.container) {
      throw new Error(`Container with id '${containerId}' not found`);
    }
    
    this.init();
    this.bindData();
  }
  
  init() {
    this.container.innerHTML = `
      <div class="user-profile">
        <div class="profile-header">
          <h2>ğŸ‘¤ ç”¨æˆ·èµ„æ–™</h2>
          <div class="profile-actions">
            <button id="editBtn" class="btn btn-primary">ç¼–è¾‘</button>
            <button id="saveBtn" class="btn btn-success" style="display: none;">ä¿å­˜</button>
            <button id="cancelBtn" class="btn btn-secondary" style="display: none;">å–æ¶ˆ</button>
          </div>
        </div>
        
        <div class="profile-content">
          <div class="profile-basic">
            <div class="form-group">
              <label>åå­—:</label>
              <input type="text" id="firstName" class="form-control" readonly>
              <div class="error-message" id="firstNameError"></div>
            </div>
            
            <div class="form-group">
              <label>å§“æ°:</label>
              <input type="text" id="lastName" class="form-control" readonly>
              <div class="error-message" id="lastNameError"></div>
            </div>
            
            <div class="form-group">
              <label>é‚®ç®±:</label>
              <input type="email" id="email" class="form-control" readonly>
              <div class="error-message" id="emailError"></div>
            </div>
            
            <div class="form-group">
              <label>å¹´é¾„:</label>
              <input type="number" id="age" class="form-control" readonly>
              <div class="error-message" id="ageError"></div>
            </div>
            
            <div class="form-group">
              <label>ä¸ªäººç®€ä»‹:</label>
              <textarea id="bio" class="form-control" readonly rows="3"></textarea>
            </div>
          </div>
          
          <div class="profile-computed">
            <div class="computed-field">
              <label>å…¨å:</label>
              <span id="fullName" class="computed-value"></span>
            </div>
            
            <div class="computed-field">
              <label>å¹´é¾„ç»„:</label>
              <span id="ageGroup" class="computed-value"></span>
            </div>
            
            <div class="computed-field">
              <label>èµ„æ–™å®Œæ•´åº¦:</label>
              <div class="progress">
                <div id="progressBar" class="progress-bar"></div>
                <span id="completeness" class="progress-text"></span>
              </div>
            </div>
          </div>
          
          <div class="profile-skills">
            <label>æŠ€èƒ½:</label>
            <div class="skills-container">
              <div id="skillsList" class="skills-list"></div>
              <div id="skillInput" class="skill-input" style="display: none;">
                <input type="text" id="newSkill" placeholder="æ·»åŠ æŠ€èƒ½">
                <button id="addSkillBtn" class="btn btn-sm">æ·»åŠ </button>
              </div>
            </div>
            <div id="skillTags" class="skill-tags"></div>
          </div>
        </div>
        
        <div class="profile-actions-bottom">
          <button id="resetBtn" class="btn btn-warning">é‡ç½®</button>
          <button id="loadSampleBtn" class="btn btn-info">åŠ è½½ç¤ºä¾‹æ•°æ®</button>
        </div>
      </div>
    `;
    
    this.addStyles();
    this.bindEvents();
  }
  
  addStyles() {
    const style = document.createElement('style');
    style.textContent = `
      .user-profile {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f8f9fa;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      
      .profile-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #dee2e6;
      }
      
      .profile-header h2 {
        margin: 0;
        color: #2c3e50;
      }
      
      .profile-actions {
        display: flex;
        gap: 10px;
      }
      
      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
      }
      
      .btn-primary {
        background: #007bff;
        color: white;
      }
      
      .btn-primary:hover {
        background: #0056b3;
      }
      
      .btn-success {
        background: #28a745;
        color: white;
      }
      
      .btn-success:hover {
        background: #1e7e34;
      }
      
      .btn-secondary {
        background: #6c757d;
        color: white;
      }
      
      .btn-secondary:hover {
        background: #545b62;
      }
      
      .btn-warning {
        background: #ffc107;
        color: #212529;
      }
      
      .btn-warning:hover {
        background: #e0a800;
      }
      
      .btn-info {
        background: #17a2b8;
        color: white;
      }
      
      .btn-info:hover {
        background: #117a8b;
      }
      
      .btn-sm {
        padding: 4px 8px;
        font-size: 12px;
      }
      
      .profile-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }
      
      .profile-basic {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .profile-computed {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .form-group {
        margin-bottom: 15px;
      }
      
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #495057;
      }
      
      .form-control {
        width: 100%;
        padding: 8px 12px;
        border: 2px solid #dee2e6;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s;
        box-sizing: border-box;
      }
      
      .form-control:focus {
        outline: none;
        border-color: #007bff;
      }
      
      .form-control[readonly] {
        background: #f8f9fa;
        cursor: not-allowed;
      }
      
      .error-message {
        color: #dc3545;
        font-size: 12px;
        margin-top: 4px;
        min-height: 16px;
      }
      
      .computed-field {
        margin-bottom: 15px;
      }
      
      .computed-field label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #495057;
      }
      
      .computed-value {
        display: block;
        padding: 8px 12px;
        background: #e9ecef;
        border-radius: 6px;
        font-size: 14px;
        color: #495057;
      }
      
      .progress {
        position: relative;
        height: 24px;
        background: #e9ecef;
        border-radius: 12px;
        overflow: hidden;
      }
      
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #28a745, #20c997);
        transition: width 0.3s ease;
        border-radius: 12px;
      }
      
      .progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 12px;
        font-weight: bold;
        color: #495057;
      }
      
      .profile-skills {
        grid-column: 1 / -1;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .skills-container {
        margin-bottom: 10px;
      }
      
      .skills-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 10px;
      }
      
      .skill-item {
        display: flex;
        align-items: center;
        padding: 4px 8px;
        background: #007bff;
        color: white;
        border-radius: 16px;
        font-size: 12px;
      }
      
      .skill-remove {
        margin-left: 6px;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 14px;
        line-height: 1;
      }
      
      .skill-input {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      
      .skill-input input {
        flex: 1;
        padding: 6px 10px;
        border: 2px solid #dee2e6;
        border-radius: 4px;
        font-size: 12px;
      }
      
      .skill-tags {
        color: #6c757d;
        font-style: italic;
        font-size: 14px;
      }
      
      .profile-actions-bottom {
        display: flex;
        gap: 10px;
        justify-content: center;
        padding-top: 15px;
        border-top: 2px solid #dee2e6;
      }
      
      @media (max-width: 768px) {
        .profile-content {
          grid-template-columns: 1fr;
        }
      }
    `;
    
    document.head.appendChild(style);
  }
  
  bindEvents() {
    const container = this.container;
    
    // ç¼–è¾‘æŒ‰é’®
    container.addEventListener('click', (e) => {
      switch (e.target.id) {
        case 'editBtn':
          this.viewModel.startEditing();
          break;
        case 'saveBtn':
          this.viewModel.saveProfile();
          break;
        case 'cancelBtn':
          this.viewModel.cancelEditing();
          break;
        case 'resetBtn':
          this.viewModel.resetProfile();
          break;
        case 'loadSampleBtn':
          this.loadSampleData();
          break;
        case 'addSkillBtn':
          this.addSkill();
          break;
      }
    });
    
    // åˆ é™¤æŠ€èƒ½
    container.addEventListener('click', (e) => {
      if (e.target.classList.contains('skill-remove')) {
        const skill = e.target.dataset.skill;
        this.viewModel.removeSkill(skill);
      }
    });
    
    // è¾“å…¥æ¡†å˜åŒ–
    container.addEventListener('input', (e) => {
      const field = e.target.id;
      const value = e.target.type === 'number' ? parseInt(e.target.value) || 0 : e.target.value;
      
      if (['firstName', 'lastName', 'email', 'age', 'bio'].includes(field)) {
        this.viewModel.updateField(field, value);
      }
    });
    
    // å›è½¦æ·»åŠ æŠ€èƒ½
    container.addEventListener('keypress', (e) => {
      if (e.target.id === 'newSkill' && e.key === 'Enter') {
        this.addSkill();
      }
    });
  }
  
  bindData() {
    // ç»‘å®šåŸºç¡€æ•°æ®
    reactiveSystem.effect(() => {
      document.getElementById('firstName').value = this.viewModel.data.firstName;
    });
    
    reactiveSystem.effect(() => {
      document.getElementById('lastName').value = this.viewModel.data.lastName;
    });
    
    reactiveSystem.effect(() => {
      document.getElementById('email').value = this.viewModel.data.email;
    });
    
    reactiveSystem.effect(() => {
      document.getElementById('age').value = this.viewModel.data.age;
    });
    
    reactiveSystem.effect(() => {
      document.getElementById('bio').value = this.viewModel.data.bio;
    });
    
    // ç»‘å®šè®¡ç®—å±æ€§
    reactiveSystem.effect(() => {
      document.getElementById('fullName').textContent = this.viewModel.fullName;
    });
    
    reactiveSystem.effect(() => {
      document.getElementById('ageGroup').textContent = this.viewModel.ageGroup;
    });
    
    reactiveSystem.effect(() => {
      const completeness = this.viewModel.profileCompleteness;
      document.getElementById('progressBar').style.width = `${completeness}%`;
      document.getElementById('completeness').textContent = `${completeness}%`;
    });
    
    reactiveSystem.effect(() => {
      document.getElementById('skillTags').textContent = this.viewModel.skillTags;
    });
    
    // ç»‘å®šç¼–è¾‘çŠ¶æ€
    reactiveSystem.effect(() => {
      const isEditing = this.viewModel.data.isEditing;
      const inputs = this.container.querySelectorAll('.form-control');
      
      inputs.forEach(input => {
        input.readOnly = !isEditing;
      });
      
      document.getElementById('editBtn').style.display = isEditing ? 'none' : 'inline-block';
      document.getElementById('saveBtn').style.display = isEditing ? 'inline-block' : 'none';
      document.getElementById('cancelBtn').style.display = isEditing ? 'inline-block' : 'none';
      document.getElementById('skillInput').style.display = isEditing ? 'flex' : 'none';
    });
    
    // ç»‘å®šæŠ€èƒ½åˆ—è¡¨
    reactiveSystem.effect(() => {
      this.renderSkills();
    });
    
    // ç»‘å®šé”™è¯¯ä¿¡æ¯
    reactiveSystem.effect(() => {
      this.renderErrors();
    });
  }
  
  renderSkills() {
    const skillsList = document.getElementById('skillsList');
    const skills = this.viewModel.data.skills;
    const isEditing = this.viewModel.data.isEditing;
    
    skillsList.innerHTML = skills.map(skill => `
      <div class="skill-item">
        ${skill}
        ${isEditing ? `<button class="skill-remove" data-skill="${skill}">Ã—</button>` : ''}
      </div>
    `).join('');
  }
  
  renderErrors() {
    const errors = this.viewModel.data.errors;
    
    ['firstName', 'lastName', 'email', 'age'].forEach(field => {
      const errorElement = document.getElementById(`${field}Error`);
      if (errorElement) {
        errorElement.textContent = errors[field] || '';
      }
    });
  }
  
  addSkill() {
    const input = document.getElementById('newSkill');
    const skill = input.value.trim();
    
    if (skill) {
      this.viewModel.addSkill(skill);
      input.value = '';
    }
  }
  
  loadSampleData() {
    this.viewModel.loadProfile({
      firstName: 'å¼ ',
      lastName: 'ä¸‰',
      email: 'zhangsan@example.com',
      age: 28,
      bio: 'çƒ­çˆ±ç¼–ç¨‹çš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºç”¨æˆ·ä½“éªŒå’Œä»£ç è´¨é‡ã€‚',
      skills: ['JavaScript', 'Vue.js', 'React', 'Node.js', 'TypeScript']
    });
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function mvvmDemo() {
  console.log('=== MVVMæ¨¡å¼ç”¨æˆ·èµ„æ–™ç¤ºä¾‹ ===');
  
  // åˆ›å»ºHTMLå®¹å™¨
  if (!document.getElementById('userProfileApp')) {
    const container = document.createElement('div');
    container.id = 'userProfileApp';
    document.body.appendChild(container);
  }
  
  // åˆå§‹åŒ–MVVMç»„ä»¶
  const viewModel = new UserProfileViewModel();
  const view = new UserProfileView('userProfileApp', viewModel);
  
  console.log('âœ… MVVMç”¨æˆ·èµ„æ–™åº”ç”¨åˆå§‹åŒ–å®Œæˆï¼');
  
  // æ¼”ç¤ºå“åº”å¼ç‰¹æ€§
  setTimeout(() => {
    console.log('ğŸ”„ æ¼”ç¤ºå“åº”å¼æ•°æ®ç»‘å®š...');
    
    viewModel.updateData({
      firstName: 'John',
      lastName: 'Doe',
      email: 'john.doe@example.com',
      age: 25
    });
    
    console.log('ğŸ“Š å½“å‰è®¡ç®—å±æ€§:');
    console.log('- å…¨å:', viewModel.fullName);
    console.log('- å¹´é¾„ç»„:', viewModel.ageGroup);
    console.log('- èµ„æ–™å®Œæ•´åº¦:', viewModel.profileCompleteness + '%');
  }, 1000);
  
  return { viewModel, view };
}

// å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œè‡ªåŠ¨è¿è¡Œç¤ºä¾‹
if (typeof window !== 'undefined' && typeof document !== 'undefined') {
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', mvvmDemo);
  } else {
    mvvmDemo();
  }
}
```

## ä¸‰ã€å¾®å‰ç«¯æ¶æ„ï¼šå¤§å‹åº”ç”¨çš„æ¨¡å—åŒ–è§£å†³æ–¹æ¡ˆ

### 3.1 ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ

å¾®å‰ç«¯æ˜¯ä¸€ç§å°†å¤§å‹å‰ç«¯åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªå°å‹ã€ç‹¬ç«‹çš„å‰ç«¯åº”ç”¨çš„æ¶æ„æ¨¡å¼ã€‚æ¯ä¸ªå¾®å‰ç«¯åº”ç”¨å¯ä»¥ï¼š
- ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆ
- ç”±ä¸åŒçš„å›¢é˜Ÿç»´æŠ¤
- åœ¨è¿è¡Œæ—¶ç»„åˆæˆå®Œæ•´åº”ç”¨

### 3.2 å¾®å‰ç«¯æ¶æ„å®ç°

```javascript
// å¾®å‰ç«¯æ³¨å†Œä¸­å¿ƒ
class MicroFrontendRegistry {
  constructor() {
    this.apps = new Map();
    this.loadedApps = new Map();
    this.mountedApps = new Set();
    this.globalEventBus = new EventTarget();
    this.sharedDependencies = new Map();
  }
  
  // æ³¨å†Œå¾®å‰ç«¯åº”ç”¨
  registerApp(config) {
    const {
      name,
      entry,
      container,
      activeWhen,
      props = {},
      dependencies = []
    } = config;
    
    if (this.apps.has(name)) {
      throw new Error(`App ${name} is already registered`);
    }
    
    const app = {
      name,
      entry,
      container,
      activeWhen: typeof activeWhen === 'function' ? activeWhen : () => activeWhen,
      props,
      dependencies,
      status: 'NOT_LOADED',
      loadPromise: null,
      mountPromise: null,
      unmountPromise: null
    };
    
    this.apps.set(name, app);
    console.log(`ğŸ“¦ æ³¨å†Œå¾®å‰ç«¯åº”ç”¨: ${name}`);
    
    return app;
  }
  
  // åŠ è½½åº”ç”¨
  async loadApp(name) {
    const app = this.apps.get(name);
    if (!app) {
      throw new Error(`App ${name} is not registered`);
    }
    
    if (app.status === 'LOADED' || app.status === 'MOUNTED') {
      return app;
    }
    
    if (app.loadPromise) {
      return app.loadPromise;
    }
    
    app.loadPromise = this._loadApp(app);
    return app.loadPromise;
  }
  
  async _loadApp(app) {
    try {
      console.log(`ğŸ”„ åŠ è½½åº”ç”¨: ${app.name}`);
      app.status = 'LOADING';
      
      // åŠ è½½ä¾èµ–
      await this.loadDependencies(app.dependencies);
      
      // åŠ è½½åº”ç”¨ä»£ç 
      const appModule = await this.loadAppModule(app.entry);
      
      // éªŒè¯åº”ç”¨æ¥å£
      this.validateAppModule(appModule, app.name);
      
      app.module = appModule;
      app.status = 'LOADED';
      
      console.log(`âœ… åº”ç”¨åŠ è½½å®Œæˆ: ${app.name}`);
      
      this.globalEventBus.dispatchEvent(new CustomEvent('app-loaded', {
        detail: { app }
      }));
      
      return app;
      
    } catch (error) {
      app.status = 'LOAD_ERROR';
      console.error(`âŒ åº”ç”¨åŠ è½½å¤±è´¥: ${app.name}`, error);
      throw error;
    }
  }
  
  // æŒ‚è½½åº”ç”¨
  async mountApp(name) {
    const app = await this.loadApp(name);
    
    if (app.status === 'MOUNTED') {
      return app;
    }
    
    if (app.mountPromise) {
      return app.mountPromise;
    }
    
    app.mountPromise = this._mountApp(app);
    return app.mountPromise;
  }
  
  async _mountApp(app) {
    try {
      console.log(`ğŸ”§ æŒ‚è½½åº”ç”¨: ${app.name}`);
      app.status = 'MOUNTING';
      
      // å‡†å¤‡å®¹å™¨
      const container = this.prepareContainer(app.container);
      
      // å‡†å¤‡åº”ç”¨å±æ€§
      const appProps = {
        ...app.props,
        container,
        eventBus: this.globalEventBus,
        sharedDependencies: this.sharedDependencies,
        registry: this
      };
      
      // è°ƒç”¨åº”ç”¨çš„mountæ–¹æ³•
      await app.module.mount(appProps);
      
      app.status = 'MOUNTED';
      this.mountedApps.add(app.name);
      
      console.log(`âœ… åº”ç”¨æŒ‚è½½å®Œæˆ: ${app.name}`);
      
      this.globalEventBus.dispatchEvent(new CustomEvent('app-mounted', {
        detail: { app }
      }));
      
      return app;
      
    } catch (error) {
      app.status = 'MOUNT_ERROR';
      console.error(`âŒ åº”ç”¨æŒ‚è½½å¤±è´¥: ${app.name}`, error);
      throw error;
    }
  }
  
  // å¸è½½åº”ç”¨
  async unmountApp(name) {
    const app = this.apps.get(name);
    if (!app || app.status !== 'MOUNTED') {
      return;
    }
    
    if (app.unmountPromise) {
      return app.unmountPromise;
    }
    
    app.unmountPromise = this._unmountApp(app);
    return app.unmountPromise;
  }
  
  async _unmountApp(app) {
    try {
      console.log(`ğŸ”„ å¸è½½åº”ç”¨: ${app.name}`);
      app.status = 'UNMOUNTING';
      
      // è°ƒç”¨åº”ç”¨çš„unmountæ–¹æ³•
      if (app.module && typeof app.module.unmount === 'function') {
        await app.module.unmount();
      }
      
      // æ¸…ç†å®¹å™¨
      this.cleanupContainer(app.container);
      
      app.status = 'LOADED';
      this.mountedApps.delete(app.name);
      
      console.log(`âœ… åº”ç”¨å¸è½½å®Œæˆ: ${app.name}`);
      
      this.globalEventBus.dispatchEvent(new CustomEvent('app-unmounted', {
        detail: { app }
      }));
      
    } catch (error) {
      app.status = 'UNMOUNT_ERROR';
      console.error(`âŒ åº”ç”¨å¸è½½å¤±è´¥: ${app.name}`, error);
      throw error;
    }
  }
  
  // è·¯ç”±å˜åŒ–æ—¶æ£€æŸ¥åº”ç”¨çŠ¶æ€
  async checkApps(location = window.location) {
    const appsToMount = [];
    const appsToUnmount = [];
    
    for (const [name, app] of this.apps) {
      const shouldBeActive = app.activeWhen(location);
      const isActive = this.mountedApps.has(name);
      
      if (shouldBeActive && !isActive) {
        appsToMount.push(name);
      } else if (!shouldBeActive && isActive) {
        appsToUnmount.push(name);
      }
    }
    
    // å¹¶è¡Œå¤„ç†æŒ‚è½½å’Œå¸è½½
    const unmountPromises = appsToUnmount.map(name => this.unmountApp(name));
    const mountPromises = appsToMount.map(name => this.mountApp(name));
    
    await Promise.all([...unmountPromises, ...mountPromises]);
  }
  
  // åŠ è½½åº”ç”¨æ¨¡å—
  async loadAppModule(entry) {
    if (typeof entry === 'string') {
      // åŠ¨æ€å¯¼å…¥
      if (entry.startsWith('http')) {
        return await this.loadRemoteModule(entry);
      } else {
        return await import(entry);
      }
    } else if (typeof entry === 'function') {
      return await entry();
    } else {
      return entry;
    }
  }
  
  // åŠ è½½è¿œç¨‹æ¨¡å—
  async loadRemoteModule(url) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = url;
      script.type = 'module';
      
      script.onload = () => {
        // å‡è®¾è¿œç¨‹æ¨¡å—ä¼šåœ¨å…¨å±€æ³¨å†Œ
        const moduleName = this.extractModuleName(url);
        const module = window[moduleName];
        
        if (module) {
          resolve(module);
        } else {
          reject(new Error(`Module ${moduleName} not found after loading ${url}`));
        }
      };
      
      script.onerror = () => {
        reject(new Error(`Failed to load script: ${url}`));
      };
      
      document.head.appendChild(script);
    });
  }
  
  extractModuleName(url) {
    return url.split('/').pop().replace('.js', '');
  }
  
  // éªŒè¯åº”ç”¨æ¨¡å—
  validateAppModule(module, appName) {
    if (!module || typeof module !== 'object') {
      throw new Error(`App ${appName} must export an object`);
    }
    
    if (typeof module.mount !== 'function') {
      throw new Error(`App ${appName} must export a mount function`);
    }
    
    if (module.unmount && typeof module.unmount !== 'function') {
      throw new Error(`App ${appName} unmount must be a function`);
    }
  }
  
  // å‡†å¤‡å®¹å™¨
  prepareContainer(containerSelector) {
    let container;
    
    if (typeof containerSelector === 'string') {
      container = document.querySelector(containerSelector);
      if (!container) {
        throw new Error(`Container ${containerSelector} not found`);
      }
    } else if (containerSelector instanceof HTMLElement) {
      container = containerSelector;
    } else {
      throw new Error('Invalid container selector');
    }
    
    // æ¸…ç©ºå®¹å™¨
    container.innerHTML = '';
    
    return container;
  }
  
  // æ¸…ç†å®¹å™¨
  cleanupContainer(containerSelector) {
    const container = typeof containerSelector === 'string' 
      ? document.querySelector(containerSelector)
      : containerSelector;
    
    if (container) {
      container.innerHTML = '';
    }
  }
  
  // åŠ è½½ä¾èµ–
  async loadDependencies(dependencies) {
    const loadPromises = dependencies.map(dep => this.loadDependency(dep));
    await Promise.all(loadPromises);
  }
  
  async loadDependency(dependency) {
    if (this.sharedDependencies.has(dependency.name)) {
      return this.sharedDependencies.get(dependency.name);
    }
    
    console.log(`ğŸ“š åŠ è½½å…±äº«ä¾èµ–: ${dependency.name}`);
    
    let module;
    if (dependency.url) {
      module = await this.loadRemoteModule(dependency.url);
    } else if (dependency.module) {
      module = dependency.module;
    } else {
      throw new Error(`Invalid dependency configuration: ${dependency.name}`);
    }
    
    this.sharedDependencies.set(dependency.name, module);
    return module;
  }
  
  // è·å–åº”ç”¨çŠ¶æ€
  getAppStatus(name) {
    const app = this.apps.get(name);
    return app ? app.status : 'NOT_REGISTERED';
  }
  
  // è·å–æ‰€æœ‰åº”ç”¨
  getAllApps() {
    return Array.from(this.apps.values());
  }
  
  // è·å–å·²æŒ‚è½½çš„åº”ç”¨
  getMountedApps() {
    return Array.from(this.mountedApps);
  }
}

// è·¯ç”±ç®¡ç†å™¨
class MicroFrontendRouter {
  constructor(registry) {
    this.registry = registry;
    this.isStarted = false;
    
    this.handlePopState = this.handlePopState.bind(this);
    this.handleHashChange = this.handleHashChange.bind(this);
  }
  
  start() {
    if (this.isStarted) {
      return;
    }
    
    this.isStarted = true;
    
    // ç›‘å¬è·¯ç”±å˜åŒ–
    window.addEventListener('popstate', this.handlePopState);
    window.addEventListener('hashchange', this.handleHashChange);
    
    // åŠ«æŒpushStateå’ŒreplaceState
    this.hijackHistory();
    
    // åˆå§‹æ£€æŸ¥
    this.registry.checkApps();
    
    console.log('ğŸš€ å¾®å‰ç«¯è·¯ç”±å™¨å¯åŠ¨');
  }
  
  stop() {
    if (!this.isStarted) {
      return;
    }
    
    this.isStarted = false;
    
    window.removeEventListener('popstate', this.handlePopState);
    window.removeEventListener('hashchange', this.handleHashChange);
    
    console.log('ğŸ›‘ å¾®å‰ç«¯è·¯ç”±å™¨åœæ­¢');
  }
  
  handlePopState() {
    this.registry.checkApps();
  }
  
  handleHashChange() {
    this.registry.checkApps();
  }
  
  hijackHistory() {
    const originalPushState = history.pushState;
    const originalReplaceState = history.replaceState;
    
    history.pushState = (...args) => {
      originalPushState.apply(history, args);
      this.registry.checkApps();
    };
    
    history.replaceState = (...args) => {
      originalReplaceState.apply(history, args);
      this.registry.checkApps();
    };
  }
  
  // å¯¼èˆªåˆ°æŒ‡å®šè·¯å¾„
  navigate(path) {
    history.pushState(null, '', path);
    this.registry.checkApps();
  }
}

// ç¤ºä¾‹å¾®å‰ç«¯åº”ç”¨
class HeaderApp {
  constructor() {
    this.container = null;
    this.eventBus = null;
  }
  
  async mount({ container, eventBus, sharedDependencies }) {
    this.container = container;
    this.eventBus = eventBus;
    
    this.render();
    this.bindEvents();
    
    console.log('ğŸ¯ Headeråº”ç”¨å·²æŒ‚è½½');
  }
  
  async unmount() {
    if (this.container) {
      this.container.innerHTML = '';
    }
    
    console.log('ğŸ¯ Headeråº”ç”¨å·²å¸è½½');
  }
  
  render() {
    this.container.innerHTML = `
      <header class="micro-header">
        <div class="header-content">
          <h1>ğŸ¢ å¾®å‰ç«¯åº”ç”¨</h1>
          <nav class="header-nav">
            <a href="#/home" class="nav-link">é¦–é¡µ</a>
            <a href="#/dashboard" class="nav-link">ä»ªè¡¨æ¿</a>
            <a href="#/profile" class="nav-link">ä¸ªäººèµ„æ–™</a>
            <a href="#/settings" class="nav-link">è®¾ç½®</a>
          </nav>
          <div class="header-actions">
            <button id="notifyBtn" class="action-btn">å‘é€é€šçŸ¥</button>
            <span id="userInfo" class="user-info">ç”¨æˆ·: Admin</span>
          </div>
        </div>
      </header>
    `;
    
    this.addStyles();
  }
  
  addStyles() {
    const style = document.createElement('style');
    style.textContent = `
      .micro-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .header-content h1 {
        margin: 0;
        font-size: 1.5rem;
      }
      
      .header-nav {
        display: flex;
        gap: 2rem;
      }
      
      .nav-link {
        color: white;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        transition: background-color 0.3s;
      }
      
      .nav-link:hover {
        background-color: rgba(255,255,255,0.2);
      }
      
      .header-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      
      .action-btn {
        background: rgba(255,255,255,0.2);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
      }
      
      .action-btn:hover {
        background: rgba(255,255,255,0.3);
      }
      
      .user-info {
        font-size: 0.9rem;
        opacity: 0.9;
      }
    `;
    
    document.head.appendChild(style);
  }
  
  bindEvents() {
    const notifyBtn = this.container.querySelector('#notifyBtn');
    notifyBtn.addEventListener('click', () => {
      this.eventBus.dispatchEvent(new CustomEvent('global-notification', {
        detail: {
          message: 'è¿™æ˜¯æ¥è‡ªHeaderåº”ç”¨çš„å…¨å±€é€šçŸ¥ï¼',
          type: 'info'
        }
      }));
    });
  }
}

class DashboardApp {
  constructor() {
    this.container = null;
    this.eventBus = null;
    this.charts = [];
  }
  
  async mount({ container, eventBus }) {
    this.container = container;
    this.eventBus = eventBus;
    
    this.render();
    this.initCharts();
    this.bindEvents();
    
    console.log('ğŸ“Š Dashboardåº”ç”¨å·²æŒ‚è½½');
  }
  
  async unmount() {
    this.cleanup();
    console.log('ğŸ“Š Dashboardåº”ç”¨å·²å¸è½½');
  }
  
  render() {
    this.container.innerHTML = `
      <div class="dashboard">
        <div class="dashboard-header">
          <h2>ğŸ“Š æ•°æ®ä»ªè¡¨æ¿</h2>
          <div class="dashboard-controls">
            <button id="refreshBtn" class="control-btn">åˆ·æ–°æ•°æ®</button>
            <select id="timeRange" class="control-select">
              <option value="1h">æœ€è¿‘1å°æ—¶</option>
              <option value="24h" selected>æœ€è¿‘24å°æ—¶</option>
              <option value="7d">æœ€è¿‘7å¤©</option>
              <option value="30d">æœ€è¿‘30å¤©</option>
            </select>
          </div>
        </div>
        
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <h3>ğŸ“ˆ é”€å”®è¶‹åŠ¿</h3>
            <div id="salesChart" class="chart-container"></div>
          </div>
          
          <div class="dashboard-card">
            <h3>ğŸ‘¥ ç”¨æˆ·æ´»è·ƒåº¦</h3>
            <div id="userChart" class="chart-container"></div>
          </div>
          
          <div class="dashboard-card">
            <h3>ğŸ’° æ”¶å…¥ç»Ÿè®¡</h3>
            <div id="revenueChart" class="chart-container"></div>
          </div>
          
          <div class="dashboard-card">
            <h3>ğŸ¯ å…³é”®æŒ‡æ ‡</h3>
            <div class="metrics-container">
              <div class="metric">
                <span class="metric-label">æ€»ç”¨æˆ·æ•°</span>
                <span class="metric-value" id="totalUsers">12,345</span>
              </div>
              <div class="metric">
                <span class="metric-label">æ´»è·ƒç”¨æˆ·</span>
                <span class="metric-value" id="activeUsers">8,901</span>
              </div>
              <div class="metric">
                <span class="metric-label">è½¬åŒ–ç‡</span>
                <span class="metric-value" id="conversionRate">23.4%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    
    this.addStyles();
  }
  
  addStyles() {
    const style = document.createElement('style');
    style.textContent = `
      .dashboard {
        padding: 2rem;
        background: #f8f9fa;
        min-height: 100vh;
      }
      
      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }
      
      .dashboard-header h2 {
        margin: 0;
        color: #2c3e50;
      }
      
      .dashboard-controls {
        display: flex;
        gap: 1rem;
        align-items: center;
      }
      
      .control-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      
      .control-btn:hover {
        background: #0056b3;
      }
      
      .control-select {
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
      }
      
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }
      
      .dashboard-card {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      .dashboard-card h3 {
        margin: 0 0 1rem 0;
        color: #2c3e50;
        font-size: 1.1rem;
      }
      
      .chart-container {
        height: 200px;
        background: #f8f9fa;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-style: italic;
      }
      
      .metrics-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .metric {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        background: #f8f9fa;
        border-radius: 4px;
      }
      
      .metric-label {
        color: #6c757d;
        font-size: 0.9rem;
      }
      
      .metric-value {
        font-weight: bold;
        font-size: 1.2rem;
        color: #2c3e50;
      }
    `;
    
    document.head.appendChild(style);
  }
  
  initCharts() {
    // æ¨¡æ‹Ÿå›¾è¡¨åˆå§‹åŒ–
    const chartContainers = this.container.querySelectorAll('.chart-container');
    chartContainers.forEach((container, index) => {
      const chartTypes = ['ğŸ“ˆ æŠ˜çº¿å›¾', 'ğŸ“Š æŸ±çŠ¶å›¾', 'ğŸ¥§ é¥¼å›¾'];
      container.textContent = `${chartTypes[index] || 'ğŸ“ˆ å›¾è¡¨'} (æ¨¡æ‹Ÿæ•°æ®)`;
    });
  }
  
  bindEvents() {
    const refreshBtn = this.container.querySelector('#refreshBtn');
    const timeRange = this.container.querySelector('#timeRange');
    
    refreshBtn.addEventListener('click', () => {
      this.refreshData();
    });
    
    timeRange.addEventListener('change', (e) => {
      this.updateTimeRange(e.target.value);
    });
    
    // ç›‘å¬å…¨å±€äº‹ä»¶
    this.eventBus.addEventListener('global-notification', (e) => {
      console.log('Dashboardæ”¶åˆ°å…¨å±€é€šçŸ¥:', e.detail);
    });
  }
  
  refreshData() {
    console.log('ğŸ”„ åˆ·æ–°ä»ªè¡¨æ¿æ•°æ®...');
    
    // æ¨¡æ‹Ÿæ•°æ®æ›´æ–°
    const totalUsers = this.container.querySelector('#totalUsers');
    const activeUsers = this.container.querySelector('#activeUsers');
    const conversionRate = this.container.querySelector('#conversionRate');
    
    totalUsers.textContent = (Math.random() * 20000 + 10000).toFixed(0);
    activeUsers.textContent = (Math.random() * 15000 + 5000).toFixed(0);
    conversionRate.textContent = (Math.random() * 30 + 15).toFixed(1) + '%';
    
    // å‘é€äº‹ä»¶é€šçŸ¥å…¶ä»–åº”ç”¨
    this.eventBus.dispatchEvent(new CustomEvent('data-refreshed', {
      detail: {
        timestamp: Date.now(),
        source: 'dashboard'
      }
    }));
  }
  
  updateTimeRange(range) {
    console.log(`ğŸ“… æ›´æ–°æ—¶é—´èŒƒå›´: ${range}`);
    // è¿™é‡Œå¯ä»¥é‡æ–°åŠ è½½å¯¹åº”æ—¶é—´èŒƒå›´çš„æ•°æ®
  }
  
  cleanup() {
    if (this.container) {
      this.container.innerHTML = '';
    }
    this.charts = [];
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function microFrontendDemo() {
  console.log('=== å¾®å‰ç«¯æ¶æ„ç¤ºä¾‹ ===');
  
  // åˆ›å»ºHTMLå®¹å™¨
  if (!document.getElementById('microApp')) {
    const container = document.createElement('div');
    container.id = 'microApp';
    container.innerHTML = `
      <div id="header-container"></div>
      <div id="main-container"></div>
    `;
    document.body.appendChild(container);
  }
  
  // åˆ›å»ºæ³¨å†Œä¸­å¿ƒå’Œè·¯ç”±å™¨
  const registry = new MicroFrontendRegistry();
  const router = new MicroFrontendRouter(registry);
  
  // æ³¨å†ŒHeaderåº”ç”¨ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰
  registry.registerApp({
    name: 'header',
    entry: () => ({ mount: new HeaderApp().mount.bind(new HeaderApp()), unmount: new HeaderApp().unmount.bind(new HeaderApp()) }),
    container: '#header-container',
    activeWhen: () => true // å§‹ç»ˆæ¿€æ´»
  });
  
  // æ³¨å†ŒDashboardåº”ç”¨
  registry.registerApp({
    name: 'dashboard',
    entry: () => ({ mount: new DashboardApp().mount.bind(new DashboardApp()), unmount: new DashboardApp().unmount.bind(new DashboardApp()) }),
    container: '#main-container',
    activeWhen: (location) => location.hash.includes('dashboard')
  });
  
  // å¯åŠ¨è·¯ç”±å™¨
  router.start();
  
  console.log('âœ… å¾®å‰ç«¯åº”ç”¨åˆå§‹åŒ–å®Œæˆï¼');
  console.log('ğŸ”— å°è¯•è®¿é—® #/dashboard æŸ¥çœ‹ä»ªè¡¨æ¿åº”ç”¨');
  
  // è‡ªåŠ¨å¯¼èˆªåˆ°dashboard
  setTimeout(() => {
    router.navigate('#/dashboard');
  }, 1000);
  
  return { registry, router };
}

// å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œè‡ªåŠ¨è¿è¡Œç¤ºä¾‹
if (typeof window !== 'undefined' && typeof document !== 'undefined') {
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', microFrontendDemo);
  } else {
    microFrontendDemo();
  }
}
```

## å››ã€åˆ†å±‚æ¶æ„ï¼šæ¸…æ™°çš„èŒè´£åˆ†ç¦»

### 4.1 åˆ†å±‚æ¶æ„æ¦‚è¿°

åˆ†å±‚æ¶æ„æ˜¯ä¸€ç§å°†åº”ç”¨ç¨‹åºç»„ç»‡æˆæ°´å¹³å±‚çš„æ¶æ„æ¨¡å¼ï¼Œæ¯ä¸€å±‚åªèƒ½ä¸å…¶ç›´æ¥ç›¸é‚»çš„å±‚è¿›è¡Œé€šä¿¡ã€‚è¿™ç§æ¨¡å¼æœ‰åŠ©äºï¼š
- å…³æ³¨ç‚¹åˆ†ç¦»
- ä»£ç å¤ç”¨
- å¯ç»´æŠ¤æ€§
- å¯æµ‹è¯•æ€§

### 4.2 å…¸å‹çš„å‰ç«¯åˆ†å±‚æ¶æ„

```mermaid
graph TD
    A[è¡¨ç¤ºå±‚ Presentation Layer] --> B[ä¸šåŠ¡é€»è¾‘å±‚ Business Logic Layer]
    B --> C[æ•°æ®è®¿é—®å±‚ Data Access Layer]
    C --> D[æ•°æ®å­˜å‚¨å±‚ Data Storage Layer]
    
    A1[ç»„ä»¶/è§†å›¾] --> A
    A2[è·¯ç”±ç®¡ç†] --> A
    A3[çŠ¶æ€ç®¡ç†] --> A
    
    B1[ä¸šåŠ¡è§„åˆ™] --> B
    B2[æ•°æ®éªŒè¯] --> B
    B3[å·¥ä½œæµæ§åˆ¶] --> B
    
    C1[APIè°ƒç”¨] --> C
    C2[æ•°æ®è½¬æ¢] --> C
    C3[ç¼“å­˜ç®¡ç†] --> C
    
    D1[æœ¬åœ°å­˜å‚¨] --> D
    D2[è¿œç¨‹æ•°æ®åº“] --> D
    D3[ç¬¬ä¸‰æ–¹æœåŠ¡] --> D
```

### 4.3 åˆ†å±‚æ¶æ„å®ç°

```javascript
// æ•°æ®å­˜å‚¨å±‚ - è´Ÿè´£æ•°æ®æŒä¹…åŒ–
class DataStorageLayer {
  constructor() {
    this.localStorage = window.localStorage;
    this.sessionStorage = window.sessionStorage;
    this.indexedDB = null;
    this.initIndexedDB();
  }
  
  async initIndexedDB() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open('AppDatabase', 1);
      
      request.onerror = () => reject(request.error);
      request.onsuccess = () => {
        this.indexedDB = request.result;
        resolve(this.indexedDB);
      };
      
      request.onupgradeneeded = (event) => {
        const db = event.target.result;
        
        // åˆ›å»ºç”¨æˆ·å­˜å‚¨
        if (!db.objectStoreNames.contains('users')) {
          const userStore = db.createObjectStore('users', { keyPath: 'id', autoIncrement: true });
          userStore.createIndex('email', 'email', { unique: true });
          userStore.createIndex('username', 'username', { unique: true });
        }
        
        // åˆ›å»ºäº§å“å­˜å‚¨
        if (!db.objectStoreNames.contains('products')) {
          const productStore = db.createObjectStore('products', { keyPath: 'id', autoIncrement: true });
          productStore.createIndex('category', 'category', { unique: false });
          productStore.createIndex('price', 'price', { unique: false });
        }
      };
    });
  }
  
  // æœ¬åœ°å­˜å‚¨æ“ä½œ
  setLocal(key, value) {
    try {
      this.localStorage.setItem(key, JSON.stringify(value));
      return true;
    } catch (error) {
      console.error('æœ¬åœ°å­˜å‚¨å¤±è´¥:', error);
      return false;
    }
  }
  
  getLocal(key) {
    try {
      const value = this.localStorage.getItem(key);
      return value ? JSON.parse(value) : null;
    } catch (error) {
      console.error('æœ¬åœ°å­˜å‚¨è¯»å–å¤±è´¥:', error);
      return null;
    }
  }
  
  removeLocal(key) {
    this.localStorage.removeItem(key);
  }
  
  // IndexedDBæ“ä½œ
  async saveToIndexedDB(storeName, data) {
    if (!this.indexedDB) {
      await this.initIndexedDB();
    }
    
    return new Promise((resolve, reject) => {
      const transaction = this.indexedDB.transaction([storeName], 'readwrite');
      const store = transaction.objectStore(storeName);
      const request = store.add(data);
      
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }
  
  async getFromIndexedDB(storeName, id) {
    if (!this.indexedDB) {
      await this.initIndexedDB();
    }
    
    return new Promise((resolve, reject) => {
      const transaction = this.indexedDB.transaction([storeName], 'readonly');
      const store = transaction.objectStore(storeName);
      const request = store.get(id);
      
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }
  
  async getAllFromIndexedDB(storeName) {
    if (!this.indexedDB) {
      await this.initIndexedDB();
    }
    
    return new Promise((resolve, reject) => {
      const transaction = this.indexedDB.transaction([storeName], 'readonly');
      const store = transaction.objectStore(storeName);
      const request = store.getAll();
      
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }
}

// æ•°æ®è®¿é—®å±‚ - è´Ÿè´£æ•°æ®è·å–å’ŒAPIè°ƒç”¨
class DataAccessLayer {
  constructor(storageLayer) {
    this.storage = storageLayer;
    this.cache = new Map();
    this.cacheTimeout = 5 * 60 * 1000; // 5åˆ†é’Ÿç¼“å­˜
    this.baseURL = 'https://api.example.com';
  }
  
  // HTTPè¯·æ±‚å°è£…
  async request(url, options = {}) {
    const config = {
      headers: {
        'Content-Type': 'application/json',
        ...options.headers
      },
      ...options
    };
    
    // æ·»åŠ è®¤è¯token
    const token = this.storage.getLocal('authToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    
    try {
      const response = await fetch(`${this.baseURL}${url}`, config);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      const data = await response.json();
      return { success: true, data };
      
    } catch (error) {
      console.error('APIè¯·æ±‚å¤±è´¥:', error);
      return { success: false, error: error.message };
    }
  }
  
  // ç¼“å­˜ç®¡ç†
  getCacheKey(key) {
    return `cache_${key}`;
  }
  
  setCache(key, data) {
    const cacheKey = this.getCacheKey(key);
    this.cache.set(cacheKey, {
      data,
      timestamp: Date.now()
    });
  }
  
  getCache(key) {
    const cacheKey = this.getCacheKey(key);
    const cached = this.cache.get(cacheKey);
    
    if (!cached) {
      return null;
    }
    
    // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
    if (Date.now() - cached.timestamp > this.cacheTimeout) {
      this.cache.delete(cacheKey);
      return null;
    }
    
    return cached.data;
  }
  
  clearCache(key) {
    if (key) {
      this.cache.delete(this.getCacheKey(key));
    } else {
      this.cache.clear();
    }
  }
  
  // ç”¨æˆ·æ•°æ®æ“ä½œ
  async getUsers() {
    const cacheKey = 'users';
    let users = this.getCache(cacheKey);
    
    if (!users) {
      const result = await this.request('/users');
      if (result.success) {
        users = result.data;
        this.setCache(cacheKey, users);
        
        // åŒæ—¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        this.storage.setLocal('users', users);
      } else {
        // å¦‚æœAPIå¤±è´¥ï¼Œå°è¯•ä»æœ¬åœ°å­˜å‚¨è·å–
        users = this.storage.getLocal('users') || [];
      }
    }
    
    return users;
  }
  
  async getUserById(id) {
    const cacheKey = `user_${id}`;
    let user = this.getCache(cacheKey);
    
    if (!user) {
      const result = await this.request(`/users/${id}`);
      if (result.success) {
        user = result.data;
        this.setCache(cacheKey, user);
      } else {
        // å°è¯•ä»IndexedDBè·å–
        user = await this.storage.getFromIndexedDB('users', id);
      }
    }
    
    return user;
  }
  
  async createUser(userData) {
    const result = await this.request('/users', {
      method: 'POST',
      body: JSON.stringify(userData)
    });
    
    if (result.success) {
      // æ¸…é™¤ç›¸å…³ç¼“å­˜
      this.clearCache('users');
      
      // ä¿å­˜åˆ°IndexedDB
      await this.storage.saveToIndexedDB('users', result.data);
    }
    
    return result;
  }
  
  async updateUser(id, userData) {
    const result = await this.request(`/users/${id}`, {
      method: 'PUT',
      body: JSON.stringify(userData)
    });
    
    if (result.success) {
      // æ¸…é™¤ç›¸å…³ç¼“å­˜
      this.clearCache('users');
      this.clearCache(`user_${id}`);
    }
    
    return result;
  }
  
  // äº§å“æ•°æ®æ“ä½œ
  async getProducts(filters = {}) {
    const cacheKey = `products_${JSON.stringify(filters)}`;
    let products = this.getCache(cacheKey);
    
    if (!products) {
      const queryParams = new URLSearchParams(filters).toString();
      const url = `/products${queryParams ? `?${queryParams}` : ''}`;
      
      const result = await this.request(url);
      if (result.success) {
        products = result.data;
        this.setCache(cacheKey, products);
      } else {
        products = await this.storage.getAllFromIndexedDB('products');
        
        // åº”ç”¨è¿‡æ»¤å™¨
        if (filters.category) {
          products = products.filter(p => p.category === filters.category);
        }
        if (filters.minPrice) {
          products = products.filter(p => p.price >= filters.minPrice);
        }
        if (filters.maxPrice) {
          products = products.filter(p => p.price <= filters.maxPrice);
        }
      }
    }
    
    return products;
  }
}

// ä¸šåŠ¡é€»è¾‘å±‚ - è´Ÿè´£ä¸šåŠ¡è§„åˆ™å’Œæ•°æ®å¤„ç†
class BusinessLogicLayer {
  constructor(dataAccessLayer) {
    this.dataAccess = dataAccessLayer;
    this.validators = new Map();
    this.businessRules = new Map();
    this.initValidators();
    this.initBusinessRules();
  }
  
  initValidators() {
    // ç”¨æˆ·éªŒè¯å™¨
    this.validators.set('user', {
      email: (email) => {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      },
      
      password: (password) => {
        // è‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
        const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{8,}$/;
        return passwordRegex.test(password);
      },
      
      username: (username) => {
        // 3-20ä½ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿
        const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
        return usernameRegex.test(username);
      },
      
      age: (age) => {
        return Number.isInteger(age) && age >= 0 && age <= 150;
      }
    });
    
    // äº§å“éªŒè¯å™¨
    this.validators.set('product', {
      name: (name) => {
        return typeof name === 'string' && name.trim().length >= 2;
      },
      
      price: (price) => {
        return typeof price === 'number' && price > 0;
      },
      
      category: (category) => {
        const validCategories = ['electronics', 'clothing', 'books', 'home', 'sports'];
        return validCategories.includes(category);
      },
      
      stock: (stock) => {
        return Number.isInteger(stock) && stock >= 0;
      }
    });
  }
  
  initBusinessRules() {
    // ç”¨æˆ·ä¸šåŠ¡è§„åˆ™
    this.businessRules.set('user', {
      canCreateAccount: (userData) => {
        // æ£€æŸ¥å¹´é¾„é™åˆ¶
        if (userData.age < 13) {
          return { valid: false, message: 'ç”¨æˆ·å¹´é¾„å¿…é¡»å¤§äº13å²' };
        }
        
        // æ£€æŸ¥é‚®ç®±åŸŸåé™åˆ¶
        const restrictedDomains = ['tempmail.com', '10minutemail.com'];
        const emailDomain = userData.email.split('@')[1];
        if (restrictedDomains.includes(emailDomain)) {
          return { valid: false, message: 'ä¸å…è®¸ä½¿ç”¨ä¸´æ—¶é‚®ç®±æ³¨å†Œ' };
        }
        
        return { valid: true };
      },
      
      canUpdateProfile: (userId, updateData) => {
        // æ£€æŸ¥æ˜¯å¦å°è¯•ä¿®æ”¹æ•æ„Ÿä¿¡æ¯
        const sensitiveFields = ['id', 'createdAt', 'role'];
        const hasSensitiveUpdate = Object.keys(updateData).some(key => 
          sensitiveFields.includes(key)
        );
        
        if (hasSensitiveUpdate) {
          return { valid: false, message: 'ä¸èƒ½ä¿®æ”¹æ•æ„Ÿå­—æ®µ' };
        }
        
        return { valid: true };
      }
    });
    
    // äº§å“ä¸šåŠ¡è§„åˆ™
    this.businessRules.set('product', {
      canPurchase: (product, quantity) => {
        if (product.stock < quantity) {
          return { valid: false, message: 'åº“å­˜ä¸è¶³' };
        }
        
        if (quantity <= 0) {
          return { valid: false, message: 'è´­ä¹°æ•°é‡å¿…é¡»å¤§äº0' };
        }
        
        if (quantity > 10) {
          return { valid: false, message: 'å•æ¬¡è´­ä¹°æ•°é‡ä¸èƒ½è¶…è¿‡10ä»¶' };
        }
        
        return { valid: true };
      },
      
      calculateDiscount: (product, user) => {
        let discount = 0;
        
        // VIPç”¨æˆ·æŠ˜æ‰£
        if (user.vipLevel === 'gold') {
          discount += 0.1; // 10%æŠ˜æ‰£
        } else if (user.vipLevel === 'silver') {
          discount += 0.05; // 5%æŠ˜æ‰£
        }
        
        // æ‰¹é‡è´­ä¹°æŠ˜æ‰£
        if (product.quantity >= 5) {
          discount += 0.05; // é¢å¤–5%æŠ˜æ‰£
        }
        
        // æœ€å¤§æŠ˜æ‰£é™åˆ¶
        return Math.min(discount, 0.3); // æœ€å¤š30%æŠ˜æ‰£
      }
    });
  }
  
  // éªŒè¯æ•°æ®
  validateData(type, data) {
    const validators = this.validators.get(type);
    if (!validators) {
      return { valid: false, errors: [`æœªçŸ¥çš„éªŒè¯ç±»å‹: ${type}`] };
    }
    
    const errors = [];
    
    for (const [field, validator] of Object.entries(validators)) {
      if (data.hasOwnProperty(field)) {
        if (!validator(data[field])) {
          errors.push(`${field} éªŒè¯å¤±è´¥`);
        }
      }
    }
    
    return {
      valid: errors.length === 0,
      errors
    };
  }
  
  // åº”ç”¨ä¸šåŠ¡è§„åˆ™
  applyBusinessRule(type, ruleName, ...args) {
    const rules = this.businessRules.get(type);
    if (!rules || !rules[ruleName]) {
      return { valid: false, message: `æœªæ‰¾åˆ°ä¸šåŠ¡è§„åˆ™: ${type}.${ruleName}` };
    }
    
    return rules[ruleName](...args);
  }
  
  // ç”¨æˆ·ä¸šåŠ¡é€»è¾‘
  async createUser(userData) {
    console.log('ğŸ”„ åˆ›å»ºç”¨æˆ·ä¸šåŠ¡é€»è¾‘å¤„ç†...');
    
    // æ•°æ®éªŒè¯
    const validation = this.validateData('user', userData);
    if (!validation.valid) {
      return { success: false, errors: validation.errors };
    }
    
    // ä¸šåŠ¡è§„åˆ™æ£€æŸ¥
    const businessRule = this.applyBusinessRule('user', 'canCreateAccount', userData);
    if (!businessRule.valid) {
      return { success: false, message: businessRule.message };
    }
    
    // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
    const existingUsers = await this.dataAccess.getUsers();
    const emailExists = existingUsers.some(user => user.email === userData.email);
    if (emailExists) {
      return { success: false, message: 'é‚®ç®±å·²è¢«æ³¨å†Œ' };
    }
    
    // å¤„ç†å¯†ç åŠ å¯†ï¼ˆæ¨¡æ‹Ÿï¼‰
    const processedData = {
      ...userData,
      password: this.hashPassword(userData.password),
      createdAt: new Date().toISOString(),
      vipLevel: 'bronze', // é»˜è®¤ä¼šå‘˜ç­‰çº§
      status: 'active'
    };
    
    // è°ƒç”¨æ•°æ®è®¿é—®å±‚
    const result = await this.dataAccess.createUser(processedData);
    
    if (result.success) {
      console.log('âœ… ç”¨æˆ·åˆ›å»ºæˆåŠŸ');
      // ç§»é™¤æ•æ„Ÿä¿¡æ¯
      const { password, ...safeUserData } = result.data;
      return { success: true, data: safeUserData };
    }
    
    return result;
  }
  
  async updateUser(userId, updateData) {
    console.log(`ğŸ”„ æ›´æ–°ç”¨æˆ· ${userId} ä¸šåŠ¡é€»è¾‘å¤„ç†...`);
    
    // ä¸šåŠ¡è§„åˆ™æ£€æŸ¥
    const businessRule = this.applyBusinessRule('user', 'canUpdateProfile', userId, updateData);
    if (!businessRule.valid) {
      return { success: false, message: businessRule.message };
    }
    
    // æ•°æ®éªŒè¯ï¼ˆåªéªŒè¯æä¾›çš„å­—æ®µï¼‰
    const validation = this.validateData('user', updateData);
    if (!validation.valid) {
      return { success: false, errors: validation.errors };
    }
    
    // å¤„ç†ç‰¹æ®Šå­—æ®µ
    const processedData = { ...updateData };
    if (processedData.password) {
      processedData.password = this.hashPassword(processedData.password);
    }
    processedData.updatedAt = new Date().toISOString();
    
    const result = await this.dataAccess.updateUser(userId, processedData);
    
    if (result.success) {
      console.log('âœ… ç”¨æˆ·æ›´æ–°æˆåŠŸ');
      const { password, ...safeUserData } = result.data;
      return { success: true, data: safeUserData };
    }
    
    return result;
  }
  
  // äº§å“ä¸šåŠ¡é€»è¾‘
  async getProductsWithDiscount(filters = {}, user = null) {
    console.log('ğŸ”„ è·å–äº§å“åˆ—è¡¨ï¼ˆå«æŠ˜æ‰£è®¡ç®—ï¼‰...');
    
    const products = await this.dataAccess.getProducts(filters);
    
    if (!user) {
      return products;
    }
    
    // ä¸ºæ¯ä¸ªäº§å“è®¡ç®—æŠ˜æ‰£
    const productsWithDiscount = products.map(product => {
      const discount = this.applyBusinessRule('product', 'calculateDiscount', product, user);
      const discountedPrice = product.price * (1 - discount);
      
      return {
        ...product,
        originalPrice: product.price,
        discountedPrice: Math.round(discountedPrice * 100) / 100,
        discount: Math.round(discount * 100),
        savings: Math.round((product.price - discountedPrice) * 100) / 100
      };
    });
    
    return productsWithDiscount;
  }
  
  async purchaseProduct(productId, quantity, user) {
    console.log(`ğŸ”„ è´­ä¹°äº§å“ ${productId} ä¸šåŠ¡é€»è¾‘å¤„ç†...`);
    
    // è·å–äº§å“ä¿¡æ¯
    const products = await this.dataAccess.getProducts({ id: productId });
    const product = products.find(p => p.id === productId);
    
    if (!product) {
      return { success: false, message: 'äº§å“ä¸å­˜åœ¨' };
    }
    
    // æ£€æŸ¥è´­ä¹°è§„åˆ™
    const purchaseRule = this.applyBusinessRule('product', 'canPurchase', product, quantity);
    if (!purchaseRule.valid) {
      return { success: false, message: purchaseRule.message };
    }
    
    // è®¡ç®—æ€»ä»·ï¼ˆå«æŠ˜æ‰£ï¼‰
    const discount = this.applyBusinessRule('product', 'calculateDiscount', { ...product, quantity }, user);
    const unitPrice = product.price * (1 - discount);
    const totalPrice = unitPrice * quantity;
    
    // åˆ›å»ºè®¢å•æ•°æ®
    const orderData = {
      userId: user.id,
      productId,
      quantity,
      unitPrice: Math.round(unitPrice * 100) / 100,
      totalPrice: Math.round(totalPrice * 100) / 100,
      discount: Math.round(discount * 100),
      status: 'pending',
      createdAt: new Date().toISOString()
    };
    
    console.log('âœ… è®¢å•åˆ›å»ºæˆåŠŸ', orderData);
    return { success: true, data: orderData };
  }
  
  // å·¥å…·æ–¹æ³•
  hashPassword(password) {
    // è¿™é‡Œåº”è¯¥ä½¿ç”¨çœŸæ­£çš„åŠ å¯†ç®—æ³•ï¼Œå¦‚bcrypt
    // è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿ
    return `hashed_${password}_${Date.now()}`;
  }
}

// è¡¨ç¤ºå±‚ - è´Ÿè´£ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
class PresentationLayer {
  constructor(businessLogicLayer) {
    this.businessLogic = businessLogicLayer;
    this.currentUser = null;
    this.currentView = null;
    this.eventBus = new EventTarget();
  }
  
  // åˆå§‹åŒ–åº”ç”¨
  init() {
    this.createMainContainer();
    this.bindGlobalEvents();
    this.showLoginView();
    
    console.log('ğŸ¨ è¡¨ç¤ºå±‚åˆå§‹åŒ–å®Œæˆ');
  }
  
  createMainContainer() {
    if (!document.getElementById('layeredApp')) {
      const container = document.createElement('div');
      container.id = 'layeredApp';
      container.innerHTML = `
        <div id="app-header"></div>
        <div id="app-main"></div>
        <div id="app-footer"></div>
        <div id="notification-container"></div>
      `;
      document.body.appendChild(container);
    }
    
    this.addGlobalStyles();
  }
  
  addGlobalStyles() {
    const style = document.createElement('style');
    style.textContent = `
      #layeredApp {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      #app-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      #app-main {
        flex: 1;
        padding: 2rem;
        background: #f8f9fa;
      }
      
      #app-footer {
        background: #2c3e50;
        color: white;
        padding: 1rem 2rem;
        text-align: center;
      }
      
      .form-container {
        max-width: 400px;
        margin: 2rem auto;
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }
      
      .form-group {
        margin-bottom: 1rem;
      }
      
      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #2c3e50;
      }
      
      .form-group input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        transition: border-color 0.3s;
      }
      
      .form-group input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
      }
      
      .btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s;
      }
      
      .btn:hover {
        background: #5a67d8;
        transform: translateY(-1px);
      }
      
      .btn-secondary {
        background: #6c757d;
      }
      
      .btn-secondary:hover {
        background: #5a6268;
      }
      
      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }
      
      .product-card {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s;
      }
      
      .product-card:hover {
        transform: translateY(-2px);
      }
      
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 4px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        animation: slideIn 0.3s ease;
      }
      
      .notification.success {
        background: #28a745;
      }
      
      .notification.error {
        background: #dc3545;
      }
      
      .notification.info {
        background: #17a2b8;
      }
      
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `;
    
    document.head.appendChild(style);
  }
  
  bindGlobalEvents() {
    // ç›‘å¬ä¸šåŠ¡å±‚äº‹ä»¶
    this.eventBus.addEventListener('user-login', (e) => {
      this.currentUser = e.detail.user;
      this.showProductView();
      this.updateHeader();
    });
    
    this.eventBus.addEventListener('user-logout', () => {
      this.currentUser = null;
      this.showLoginView();
      this.updateHeader();
    });
  }
  
  // æ˜¾ç¤ºé€šçŸ¥
  showNotification(message, type = 'info') {
    const container = document.getElementById('notification-container');
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    container.appendChild(notification);
    
    // 3ç§’åè‡ªåŠ¨ç§»é™¤
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 3000);
  }
  
  // æ›´æ–°å¤´éƒ¨
  updateHeader() {
    const header = document.getElementById('app-header');
    
    if (this.currentUser) {
      header.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h1>ğŸª åˆ†å±‚æ¶æ„å•†åº—</h1>
          <div>
            <span>æ¬¢è¿, ${this.currentUser.username}!</span>
            <button id="logoutBtn" class="btn btn-secondary" style="margin-left: 1rem;">é€€å‡ºç™»å½•</button>
          </div>
        </div>
      `;
      
      document.getElementById('logoutBtn').addEventListener('click', () => {
        this.eventBus.dispatchEvent(new CustomEvent('user-logout'));
      });
    } else {
      header.innerHTML = `
        <div style="text-align: center;">
          <h1>ğŸª åˆ†å±‚æ¶æ„å•†åº—</h1>
          <p>è¯·ç™»å½•ä»¥ç»§ç»­</p>
        </div>
      `;
    }
  }
  
  // æ˜¾ç¤ºç™»å½•è§†å›¾
  showLoginView() {
    const main = document.getElementById('app-main');
    main.innerHTML = `
      <div class="form-container">
        <h2 style="text-align: center; margin-bottom: 2rem; color: #2c3e50;">ç”¨æˆ·ç™»å½•</h2>
        
        <form id="loginForm">
          <div class="form-group">
            <label for="email">é‚®ç®±åœ°å€</label>
            <input type="email" id="email" name="email" required>
          </div>
          
          <div class="form-group">
            <label for="password">å¯†ç </label>
            <input type="password" id="password" name="password" required>
          </div>
          
          <div class="form-group">
            <button type="submit" class="btn" style="width: 100%;">ç™»å½•</button>
          </div>
        </form>
        
        <div style="text-align: center; margin-top: 1rem;">
          <p>è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ <a href="#" id="showRegister">ç«‹å³æ³¨å†Œ</a></p>
        </div>
      </div>
    `;
    
    this.bindLoginEvents();
    this.currentView = 'login';
  }
  
  bindLoginEvents() {
    const form = document.getElementById('loginForm');
    const showRegister = document.getElementById('showRegister');
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const email = formData.get('email');
      const password = formData.get('password');
      
      // æ¨¡æ‹Ÿç™»å½•ï¼ˆå®é™…åº”è¯¥è°ƒç”¨ä¸šåŠ¡é€»è¾‘å±‚çš„ç™»å½•æ–¹æ³•ï¼‰
      if (email && password) {
        const mockUser = {
          id: 1,
          username: email.split('@')[0],
          email,
          vipLevel: 'gold'
        };
        
        this.eventBus.dispatchEvent(new CustomEvent('user-login', {
          detail: { user: mockUser }
        }));
        
        this.showNotification('ç™»å½•æˆåŠŸï¼', 'success');
      } else {
        this.showNotification('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', 'error');
      }
    });
    
    showRegister.addEventListener('click', (e) => {
      e.preventDefault();
      this.showRegisterView();
    });
  }
  
  // æ˜¾ç¤ºæ³¨å†Œè§†å›¾
  showRegisterView() {
    const main = document.getElementById('app-main');
    main.innerHTML = `
      <div class="form-container">
        <h2 style="text-align: center; margin-bottom: 2rem; color: #2c3e50;">ç”¨æˆ·æ³¨å†Œ</h2>
        
        <form id="registerForm">
          <div class="form-group">
            <label for="username">ç”¨æˆ·å</label>
            <input type="text" id="username" name="username" required>
          </div>
          
          <div class="form-group">
            <label for="email">é‚®ç®±åœ°å€</label>
            <input type="email" id="email" name="email" required>
          </div>
          
          <div class="form-group">
            <label for="password">å¯†ç </label>
            <input type="password" id="password" name="password" required>
          </div>
          
          <div class="form-group">
            <label for="age">å¹´é¾„</label>
            <input type="number" id="age" name="age" min="13" max="150" required>
          </div>
          
          <div class="form-group">
            <button type="submit" class="btn" style="width: 100%;">æ³¨å†Œ</button>
          </div>
        </form>
        
        <div style="text-align: center; margin-top: 1rem;">
          <p>å·²æœ‰è´¦æˆ·ï¼Ÿ <a href="#" id="showLogin">ç«‹å³ç™»å½•</a></p>
        </div>
      </div>
    `;
    
    this.bindRegisterEvents();
    this.currentView = 'register';
  }
  
  bindRegisterEvents() {
    const form = document.getElementById('registerForm');
    const showLogin = document.getElementById('showLogin');
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const userData = {
        username: formData.get('username'),
        email: formData.get('email'),
        password: formData.get('password'),
        age: parseInt(formData.get('age'))
      };
      
      try {
        const result = await this.businessLogic.createUser(userData);
        
        if (result.success) {
          this.showNotification('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•', 'success');
          this.showLoginView();
        } else {
          const message = result.message || result.errors?.join(', ') || 'æ³¨å†Œå¤±è´¥';
          this.showNotification(message, 'error');
        }
      } catch (error) {
        this.showNotification('æ³¨å†Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'error');
        console.error('æ³¨å†Œé”™è¯¯:', error);
      }
    });
    
    showLogin.addEventListener('click', (e) => {
      e.preventDefault();
      this.showLoginView();
    });
  }
  
  // æ˜¾ç¤ºäº§å“è§†å›¾
  async showProductView() {
    const main = document.getElementById('app-main');
    main.innerHTML = `
      <div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
          <h2>ğŸ›ï¸ äº§å“åˆ—è¡¨</h2>
          <div>
            <select id="categoryFilter" class="form-control" style="margin-right: 1rem;">
              <option value="">æ‰€æœ‰åˆ†ç±»</option>
              <option value="electronics">ç”µå­äº§å“</option>
              <option value="clothing">æœè£…</option>
              <option value="books">å›¾ä¹¦</option>
              <option value="home">å®¶å±…</option>
              <option value="sports">è¿åŠ¨</option>
            </select>
            <button id="refreshProducts" class="btn">åˆ·æ–°</button>
          </div>
        </div>
        
        <div id="productGrid" class="product-grid">
          <div style="text-align: center; padding: 2rem;">åŠ è½½ä¸­...</div>
        </div>
      </div>
    `;
    
    await this.loadProducts();
    this.bindProductEvents();
    this.currentView = 'products';
  }
  
  async loadProducts(filters = {}) {
    try {
      const products = await this.businessLogic.getProductsWithDiscount(filters, this.currentUser);
      this.renderProducts(products);
    } catch (error) {
      console.error('åŠ è½½äº§å“å¤±è´¥:', error);
      this.showNotification('åŠ è½½äº§å“å¤±è´¥', 'error');
    }
  }
  
  renderProducts(products) {
    const grid = document.getElementById('productGrid');
    
    if (products.length === 0) {
      grid.innerHTML = `
        <div style="text-align: center; padding: 2rem; color: #6c757d;">
          <p>æš‚æ— äº§å“</p>
        </div>
      `;
      return;
    }
    
    grid.innerHTML = products.map(product => `
      <div class="product-card">
        <h3>${product.name}</h3>
        <p style="color: #6c757d; margin: 0.5rem 0;">${product.category}</p>
        
        <div style="margin: 1rem 0;">
          ${product.discount > 0 ? `
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <span style="text-decoration: line-through; color: #6c757d;">Â¥${product.originalPrice}</span>
              <span style="font-size: 1.2rem; font-weight: bold; color: #e74c3c;">Â¥${product.discountedPrice}</span>
              <span style="background: #e74c3c; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">
                ${product.discount}% OFF
              </span>
            </div>
            <p style="color: #28a745; font-size: 0.9rem; margin: 0.5rem 0;">èŠ‚çœ Â¥${product.savings}</p>
          ` : `
            <span style="font-size: 1.2rem; font-weight: bold;">Â¥${product.price}</span>
          `}
        </div>
        
        <p style="color: #6c757d; font-size: 0.9rem;">åº“å­˜: ${product.stock}</p>
        
        <div style="margin-top: 1rem;">
          <input type="number" id="quantity_${product.id}" min="1" max="10" value="1" 
                 style="width: 60px; padding: 0.25rem; margin-right: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
          <button class="btn purchase-btn" data-product-id="${product.id}">è´­ä¹°</button>
        </div>
      </div>
    `).join('');
  }
  
  bindProductEvents() {
    const categoryFilter = document.getElementById('categoryFilter');
    const refreshBtn = document.getElementById('refreshProducts');
    const purchaseBtns = document.querySelectorAll('.purchase-btn');
    
    categoryFilter.addEventListener('change', (e) => {
      const filters = {};
      if (e.target.value) {
        filters.category = e.target.value;
      }
      this.loadProducts(filters);
    });
    
    refreshBtn.addEventListener('click', () => {
      this.loadProducts();
    });
    
    purchaseBtns.forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const productId = parseInt(e.target.dataset.productId);
        const quantityInput = document.getElementById(`quantity_${productId}`);
        const quantity = parseInt(quantityInput.value);
        
        try {
          const result = await this.businessLogic.purchaseProduct(productId, quantity, this.currentUser);
          
          if (result.success) {
            this.showNotification(`è´­ä¹°æˆåŠŸï¼æ€»ä»·: Â¥${result.data.totalPrice}`, 'success');
          } else {
            this.showNotification(result.message, 'error');
          }
        } catch (error) {
          this.showNotification('è´­ä¹°è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'error');
          console.error('è´­ä¹°é”™è¯¯:', error);
        }
      });
    });
  }
  
  // æ›´æ–°é¡µè„š
  updateFooter() {
    const footer = document.getElementById('app-footer');
    footer.innerHTML = `
      <p>&copy; 2024 åˆ†å±‚æ¶æ„å•†åº— - æ¼”ç¤ºåº”ç”¨</p>
      <p style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.8;">
        å½“å‰è§†å›¾: ${this.currentView} | ç”¨æˆ·: ${this.currentUser ? this.currentUser.username : 'æœªç™»å½•'}
      </p>
    `;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function layeredArchitectureDemo() {
  console.log('=== åˆ†å±‚æ¶æ„ç¤ºä¾‹ ===');
  
  // åˆ›å»ºå„å±‚å®ä¾‹
  const storageLayer = new DataStorageLayer();
  const dataAccessLayer = new DataAccessLayer(storageLayer);
  const businessLogicLayer = new BusinessLogicLayer(dataAccessLayer);
  const presentationLayer = new PresentationLayer(businessLogicLayer);
  
  // åˆå§‹åŒ–è¡¨ç¤ºå±‚
  presentationLayer.init();
  presentationLayer.updateFooter();
  
  // æ¨¡æ‹Ÿä¸€äº›äº§å“æ•°æ®
  const mockProducts = [
    { id: 1, name: 'iPhone 15 Pro', category: 'electronics', price: 7999, stock: 10 },
    { id: 2, name: 'æ— çº¿è“ç‰™è€³æœº', category: 'electronics', price: 299, stock: 25 },
    { id: 3, name: 'è¿åŠ¨Tæ¤', category: 'clothing', price: 89, stock: 50 },
    { id: 4, name: 'JavaScripté«˜çº§ç¨‹åºè®¾è®¡', category: 'books', price: 79, stock: 30 },
    { id: 5, name: 'æ™ºèƒ½å°ç¯', category: 'home', price: 199, stock: 15 },
    { id: 6, name: 'ç‘œä¼½å«', category: 'sports', price: 128, stock: 20 }
  ];
  
  // ä¿å­˜æ¨¡æ‹Ÿæ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
  storageLayer.setLocal('products', mockProducts);
  
  console.log('âœ… åˆ†å±‚æ¶æ„åº”ç”¨åˆå§‹åŒ–å®Œæˆï¼');
  console.log('ğŸ”— è¯·åœ¨ç•Œé¢ä¸­æ³¨å†Œ/ç™»å½•ä»¥ä½“éªŒå®Œæ•´åŠŸèƒ½');
  
  return {
    storageLayer,
    dataAccessLayer,
    businessLogicLayer,
    presentationLayer
  };
}

// å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œè‡ªåŠ¨è¿è¡Œç¤ºä¾‹
if (typeof window !== 'undefined' && typeof document !== 'undefined') {
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', layeredArchitectureDemo);
  } else {
    layeredArchitectureDemo();
  }
}
```

## äº”ã€æ¶æ„æ¨¡å¼æ€»ç»“

### 5.1 æ¶æ„æ¨¡å¼å¯¹æ¯”

```mermaid
graph TD
    A[é€‰æ‹©æ¶æ„æ¨¡å¼] --> B{åº”ç”¨å¤æ‚åº¦}
    
    B -->|ç®€å•| C[MVC]
    B -->|ä¸­ç­‰| D[MVVM]
    B -->|å¤æ‚| E[å¾®å‰ç«¯]
    B -->|å¤§å‹ä¼ä¸š| F[åˆ†å±‚æ¶æ„]
    
    C --> C1[é€‚ç”¨åœºæ™¯:<br/>- å°å‹åº”ç”¨<br/>- å¿«é€ŸåŸå‹<br/>- å­¦ä¹ é¡¹ç›®]
    
    D --> D1[é€‚ç”¨åœºæ™¯:<br/>- æ•°æ®é©±åŠ¨åº”ç”¨<br/>- å“åº”å¼ç•Œé¢<br/>- ä¸­ç­‰å¤æ‚åº¦]
    
    E --> E1[é€‚ç”¨åœºæ™¯:<br/>- å¤§å‹åº”ç”¨<br/>- å¤šå›¢é˜Ÿåä½œ<br/>- æŠ€æœ¯æ ˆå¤šæ ·åŒ–]
    
    F --> F1[é€‚ç”¨åœºæ™¯:<br/>- ä¼ä¸šçº§åº”ç”¨<br/>- é•¿æœŸç»´æŠ¤<br/>- ä¸¥æ ¼çš„èŒè´£åˆ†ç¦»]
    
    style A fill:#e1f5fe
    style C fill:#c8e6c9
    style D fill:#fff3e0
    style E fill:#f3e5f5
    style F fill:#e8f5e8
```

### 5.2 æ¶æ„æ¨¡å¼é€‰æ‹©æŒ‡å—

| æ¶æ„æ¨¡å¼ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|----------|
| **MVC** | ç®€å•æ˜“æ‡‚ã€å¿«é€Ÿå¼€å‘ã€èŒè´£æ¸…æ™° | æ§åˆ¶å™¨å®¹æ˜“è‡ƒè‚¿ã€è§†å›¾ä¸æ¨¡å‹è€¦åˆ | å°å‹åº”ç”¨ã€åŸå‹å¼€å‘ |
| **MVVM** | æ•°æ®ç»‘å®šã€å“åº”å¼ã€å¯æµ‹è¯•æ€§å¼º | å­¦ä¹ æˆæœ¬é«˜ã€è°ƒè¯•å¤æ‚ | æ•°æ®é©±åŠ¨åº”ç”¨ã€ç°ä»£æ¡†æ¶ |
| **å¾®å‰ç«¯** | ç‹¬ç«‹éƒ¨ç½²ã€æŠ€æœ¯æ ˆè‡ªç”±ã€å›¢é˜Ÿè‡ªæ²» | å¤æ‚åº¦é«˜ã€æ€§èƒ½å¼€é”€ã€é›†æˆæŒ‘æˆ˜ | å¤§å‹åº”ç”¨ã€å¤šå›¢é˜Ÿé¡¹ç›® |
| **åˆ†å±‚æ¶æ„** | èŒè´£åˆ†ç¦»ã€å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ | æ€§èƒ½å¼€é”€ã€è¿‡åº¦è®¾è®¡é£é™© | ä¼ä¸šçº§åº”ç”¨ã€é•¿æœŸé¡¹ç›® |

### 5.3 å®è·µå»ºè®®

1. **æ¸è¿›å¼æ¶æ„æ¼”è¿›**
   - ä»ç®€å•çš„MVCå¼€å§‹
   - æ ¹æ®éœ€æ±‚å¤æ‚åº¦é€æ­¥æ¼”è¿›
   - é¿å…è¿‡åº¦è®¾è®¡

2. **å›¢é˜ŸæŠ€èƒ½åŒ¹é…**
   - è€ƒè™‘å›¢é˜Ÿçš„æŠ€æœ¯æ°´å¹³
   - æä¾›å……åˆ†çš„åŸ¹è®­å’Œæ–‡æ¡£
   - å»ºç«‹ä»£ç å®¡æŸ¥æœºåˆ¶

3. **æ€§èƒ½ä¸å¤æ‚åº¦å¹³è¡¡**
   - ç›‘æ§åº”ç”¨æ€§èƒ½æŒ‡æ ‡
   - å®šæœŸé‡æ„å’Œä¼˜åŒ–
   - ä¿æŒæ¶æ„çš„ç®€æ´æ€§

4. **å·¥å…·é“¾æ”¯æŒ**
   - é€‰æ‹©åˆé€‚çš„å¼€å‘å·¥å…·
   - å»ºç«‹è‡ªåŠ¨åŒ–æµ‹è¯•
   - é…ç½®æŒç»­é›†æˆ/éƒ¨ç½²

## æ€»ç»“

æ¶æ„æ¨¡å¼æ˜¯æ„å»ºå¯æ‰©å±•å‰ç«¯åº”ç”¨çš„åŸºçŸ³ã€‚é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æ·±å…¥äº†è§£äº†å››ç§é‡è¦çš„æ¶æ„æ¨¡å¼ï¼š

- **MVCæ¨¡å¼**ï¼šç»å…¸çš„ä¸‰å±‚æ¶æ„ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘å’Œå­¦ä¹ 
- **MVVMæ¨¡å¼**ï¼šç°ä»£å‰ç«¯æ¡†æ¶çš„æ ¸å¿ƒï¼Œæä¾›å¼ºå¤§çš„æ•°æ®ç»‘å®šèƒ½åŠ›
- **å¾®å‰ç«¯æ¶æ„**ï¼šå¤§å‹åº”ç”¨çš„æ¨¡å—åŒ–è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- **åˆ†å±‚æ¶æ„**ï¼šä¼ä¸šçº§åº”ç”¨çš„æ ‡å‡†æ¶æ„ï¼Œæä¾›æ¸…æ™°çš„èŒè´£åˆ†ç¦»

é€‰æ‹©åˆé€‚çš„æ¶æ„æ¨¡å¼éœ€è¦ç»¼åˆè€ƒè™‘é¡¹ç›®è§„æ¨¡ã€å›¢é˜Ÿèƒ½åŠ›ã€æŠ€æœ¯è¦æ±‚å’Œé•¿æœŸç»´æŠ¤ç­‰å› ç´ ã€‚è®°ä½ï¼Œæ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰æœ€é€‚åˆå½“å‰åœºæ™¯çš„è§£å†³æ–¹æ¡ˆã€‚

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ç»“åˆå¤šç§æ¨¡å¼çš„ä¼˜åŠ¿ï¼Œåˆ›é€ å‡ºé€‚åˆè‡ªå·±é¡¹ç›®çš„æ··åˆæ¶æ„ã€‚å…³é”®æ˜¯è¦ä¿æŒæ¶æ„çš„æ¸…æ™°æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šåšå®çš„åŸºç¡€ã€‚

ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨Vueã€Reactã€Reduxç­‰ä¸»æµæ¡†æ¶çš„æºç ä¸­æ˜¯å¦‚ä½•åº”ç”¨è¿™äº›è®¾è®¡æ¨¡å¼çš„ï¼Œæ•¬è¯·æœŸå¾…ï¼