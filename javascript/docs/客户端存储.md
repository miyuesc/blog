# JavaScript高程笔记——客户端

> 现在越来越多的网站是动态网站，常常需要将后端数据传输给前端保存或者更新到页面中，尤其是用户偏好设置，保存在客户端不仅可以减少请求耗时，也能降低服务端的压力。

客户端（这里一般指浏览器）目前主要包括三类存储方式：cookie， Web Storage 和 IndexedDB。其中 Web Storage 又包含 Local Storage 和 Session Storage。



## 1. cookie

cookie，全名叫 HTTP cookie，是第一个客户端存储解决方案，最初用于在客户端存储回话信息。后来主要用在三个方面：

- 会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）
- 个性化设置（如用户自定义设置、主题等）
- 浏览器行为跟踪（如跟踪分析用户行为等）

### 1.1 组成

Cookie是一段不超过4KB的小型文本数据，主要由以下七个部分组成：

1. Name：cookie的名称
2. Value：cookie的值
3. Path：定义该web站点上可以访问该cookie的目录（或者说路径）
4. Expires：cookie的有效期，有缺省（会话期cookie）和非缺省（持久性cookie）两种状态
5. Domain：服务器域名 
6. Secure：指定是否使用HTTPS安全协议发送Cookie
7. HttpOnly：用于防止客户端脚本通过document.cookie属性访问Cookie

### 1.2 安全策略

Cookie 目前一般用作存储用户的登录信息和登录状态，通常都会设置一个过期时间（如果不设置在浏览器关闭时就会清除该 Cookie），这个时间格式为格林尼治标准时间。但是为了防止信息泄露，这个过期时间一般不会太长，如果用户期间有过再次进入系统，则会更新该过期时间。

> 这一点与后端的 token 过期类似。

Secure 属性和 HttpOnly 属性可以用来确保 Cookie 被正确发送。设置 Secure 属性，可以指定使用 HTTPS 协议来发送加密请求到服务端，因此可以很好的防止"中间人攻击"。而 HttpOnly 属性可以阻止客户端使用 `Document.cookie` 来访问带 HttpOnly 属性的 cookie，该属性可以有效的防止 “XSS 跨站点脚本” 攻击。

> 但是 HttpOnly 无法阻止客户端重新写入新的 cookie（新写入的 cookie 也无法设置 HttpOnly 属性）

Domain 属性和 Path 属性定义了 cookie 的作用域，即 cookie 可以发送给哪些 URL。

Domain 属性指定了可以接受该 cookie（或者说该 cookie 可以发送给哪些）的主机。不指定时默认是 `origin`，并且不包含子域名；如果要指定的话，则一般会包含子域名，例如：设置了 `Domain=mozilla.org`，则 Cookie 也包含在子域名中（如`developer.mozilla.org`）。

Path 属性则定义了主机（服务端）哪些路径可以接受该cookie，并且会包含该路径的所有子路径。

> 目前的所有主流浏览器（除 IE 8 -）之外，都支持了一个新属性 SameSite
>
> `SameSite` Cookie 允许服务器要求某个 cookie 在跨站请求时不会被发送，（其中  [Site](https://developer.mozilla.org/en-US/docs/Glossary/Site) 由可注册域定义），从而可以阻止跨站请求伪造攻击（[CSRF](https://developer.mozilla.org/zh-CN/docs/Glossary/CSRF)）。（MDN 定义）
>
> SameSite 属性可接收3个值： "None", "Strict" 和 "Lax"。
>
> - `None`**。**浏览器会在同站请求、跨站请求下继续发送 cookies，不区分大小写。
> - `Strict`。浏览器将只在访问相同站点时发送 cookie。（在原有 Cookies 的限制条件上的加强，如上文 “Cookie 的作用域” 所述）
> - `Lax`。与 **`Strict`** 类似，但用户从外部站点导航至URL时（例如通过链接）除外